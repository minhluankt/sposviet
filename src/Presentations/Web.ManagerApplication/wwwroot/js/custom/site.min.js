var dataTableOut,dataTable,setTimeoutremoveactiverow,ProductsArrays="ProductsArrays",ListArrNameStyleProduct=(ProductsArrays=[],[]),ListArrNameStyleProductinDb=[],_classremoteTr="remove",_classloadTrDb="readData",_varIdGuidSelectproductAutocomplete="",_classPosEvent={input_searchProduct:$(".search-product"),input_searchCustomer:$(".search-customer")},ua=navigator.userAgent.toLowerCase(),isAndroid=ua.indexOf("android")>-1,CusByOrderIvnoice=null,NoteByOrderIvnoice=null,ListCusByOrderPos=[],ListNoteOrder=[],listport=[8056],NOVATRate=-3,EnumTypePrint={TEST:0,PrintBaoBep:1,RealtimeOrder:2},TypeEventWebSocket={SendTestConnect:-1,SignEInvoice:0,PrintEInvoice:1,PrintInvoice:2,PrintBep:3},EnumTypeValue={BOOL:"BOOL",STRING:"STRING",INT:"INT"},TypeSyncEInvoice={TRANG_THAI_HOA_DON:0,TRANG_THAI_CQT:1},AutocompleteTypeCustomer={NONE:0,CUSCODE:1,CUSNAME:2,BUYER:3,TAXCODE:4},ENumTypeSeri={NONE:0,HSM:1,TOKEN:2,VNPTSmartCA:3},TypeSelectDiscount={Percent:1,Cash:2},TypeThuChi={THU:1,CHI:2},TypeEInvoice={GTGT:1,BANHANG:2,KHAC:5},TypePurchaseOrder={NHAP_HANG:0,TRA_HANG_NHAP:1,TRA_HANG_DON:2},TypeVATRateInv={KHONGVAT:-1},EnumTypeProductCategory={PRODUCT:1,COOKING:2,SERVICE:3,COMBO:4},EnumTypeObjectRevenueExpenditure={KHACHHANG:1,DOITAC:2,DOITUONGKHAC:3},ENumSupplierEInvoice={VNPT:1},EnumStatusRevenueExpenditure={HOANTHANH:0,HUYBO:1},EnumStatusPurchaseOrder={PHIEU_TAM:0,DA_NHAP_HANG:1,DA_TRA_HANG:2,DA_HUY:3},EnumConfigParameters={NONE:0,DELETEINVOICENOPAYMENT:1,ACCEPTPAYMENTDELETEINVOICE:2,ACCEPTSALEOUTOFSTOCK:3,AUTOVATINPAYMENT:4,PUBLISHMERGEINVOICE:5,DELETEIPUBLISHMERGEINVOICEAFTER:6},_TypeUpdatePos={UpdateQuantity:1,RemoveRowItem:2,AddProduct:3,ChangedCustomer:4,RemoveOrder:5,Payment:6,CheckOutOrder:7,AddNoteOrder:8,SplitOrder:9,ReplaceQuantity:10,ConvertInvoice:11,UpdateRoomOrTableInOrder:12,UpdateNoteAndTopping:13,CloneItemOrder:14},_TypeSpitOrderPos={Unknown:0,Separate:1,Graft:2},_TypeSelectTableRadio={All:0,IsActive:1,No:2},_TypeNotifyKitchenOrder={Orocessed:1,UPDATEBYFOOD:2,UPDATEBYTABLE:3,DELETE:4},StatusKitchenOrder={MOI:0,READY:1,DONE:2,CANCEL:3,DELETE:4},EnumTypeSignalRHub={CHITKEN:0,POS:1,UPDATECHITKEN:2,DELETECHITKEN:3,KITCHENTOPOS:4},EnumTypeEventInvoice={Cancel:0,Restore:1,PublishEInvoice:2,CreateEInvoice:3,PublishEInvoiceMerge:4},EnumTypePrinteInvoice={Printer:1,PrintConvert:2},EnumTypeConvertInvoice={INVOICE:1,INVOICE_ORDER:2};const zeroPadInvoice=(t,e)=>String(t).padStart(8,"0");jQuery.extend(jQuery.validator.messages,{required:"Trường dữ liệu bắt buộc nhập",remote:"Please fix this field.",email:"Email không đúng định dạng.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Mật khẩu nhập lại không khớp.",accept:"Please enter a value with a valid extension.",maxlength:jQuery.validator.format("Trường dữ liệu tối đa {0} ký tự."),minlength:jQuery.validator.format("Trường dữ liệu ít nhất {0} ký tự."),rangelength:jQuery.validator.format("Please enter a value between {0} and {1} characters long."),range:jQuery.validator.format("Please enter a value between {0} and {1}."),max:jQuery.validator.format("Please enter a value less than or equal to {0}."),min:jQuery.validator.format("Please enter a value greater than or equal to {0}.")}),typeCurrency="VND",this.fnInitialFormatNumber=function(t){var e=$(t).val();e&&(e=e.replaceAll(",",""),$(t)[0].className.indexOf("quantity")>-1?e.indexOf(",")>-1?$(t).val(parseFloat(e).format0VND(2,3,typeCurrency,!0)):$(t).val(parseFloat(e).format0VND(0,3)):"VND"==typeCurrency?$(t).val(parseFloat(e).format0VND(0,3)):"USD"==typeCurrency&&$(t).val(parseFloat(e).format0VND(2,3,typeCurrency)))},this.fnFocusOut=function(t){var e=$(t).val().replaceAll(",","");if($(t)[0].className.indexOf("quantity")>-1){if(e){var a=(e.indexOf("."),parseFloat(e).format0VND(3,3,typeCurrency,!0));$(t).val(a||"")}}else if(e){a=(e.indexOf("."),parseFloat(e).format0VND(3,3,typeCurrency,!0));$(t).val(a||"")}},this.checkDotComma=function(t,e){if(null!==t&void 0!==t){var a=t.toString().split(",");return 2==a.length?!(a[1].indexOf(".")>0)&&(46!==e&&44!==e):!(a.length>2)}},jQuery.fn.ForceNumericOnly=function(){return this.each((function(){$(this).blur((function(){"NaN"==$(this).val()&&$(this).val(0)})),$(this).keypress((function(t){var e=$(this).attr("class"),a=null;if(window.event){if(a=window.event.keyCode,e.indexOf("number")>-1||e.indexOf("quantity")>-1)return!(a<48&&46!=a&&44!=a&&45!=a||a>57&&189!=a)&&checkDotComma(t.target.value,a)}else{if(8===(a=t.which))return;if(e.indexOf("number")>-1||e.indexOf("quantity")>-1)return!(a<48&&46!=a&&44!=a&&45!=a||a>57&&189!=a)&&checkDotComma(t.target.value,a)}}))}))};var toastrcus={error:function(t){$.toast({text:t,heading:"Error",loader:!1,icon:"error",stack:!1,position:"top-right"})},success:function(t){$.toast({text:t,heading:"Success",loader:!1,icon:"success",stack:!1,position:"top-right"})},warning:function(t){$.toast({text:t,heading:"Warning",loader:!1,icon:"warning",stack:!1,position:"top-right"})}};function secondsToDhms(t){t=Number(t);var e=Math.floor(t/86400),a=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),i=Math.floor(t%60);return(e>0?e.toString().padStart(2,"0")+(1==e?" day, ":" days, "):"00 ")+(a>0?a.toString().padStart(2,"0")+(1==a?" hour, ":" hours, "):"")+(n>0?n.toString().padStart(2,"0")+(1==n?" minute, ":" minutes, "):"")+(i>0?i.toString().padStart(2,"0")+(1==i?" second":" seconds"):"")}function secondsTohms(t){t=Number(t);var e=Math.floor(t/3600),a=Math.floor(t%3600/60),n=Math.floor(t%60);return(e>0?e.toString().padStart(2,"0")+(1==e?" hour, ":"|"):"00|")+(a>0?a.toString().padStart(2,"0")+(1==a?" minute, ":"|"):"00")+(n>0?n.toString().padStart(2,"0")+(1==n?" second":""):"00")}toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!0,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},Number.prototype.format0=function(t,e,a,n){var i;if(n)t=0,e=3;else t=0;if(!isNaN(this.valueOf())){var o=parseFloat(this.toFixed(0));return i="\\d(?=(\\d{"+(e||3)+"})+"+(t>0?"\\.":"$")+")",(o=o.toFixed(Math.max(0,~~t)).replace(new RegExp(i,"g"),"$&,")).toString().replaceAll(",","_").replaceAll(".",",").replaceAll("_",".")}},Number.prototype.format0VND=function(t,e,a,n){var i;if(n)t=3,e=3;else t=3;if(!isNaN(this.valueOf())){var o=parseFloat(this.toFixed(3));if(o.toString().includes(".")){let a=o.toString().split(".");a[1].length<e&&(t=a[1].length)}else t=0;return i="\\d(?=(\\d{"+(e||3)+"})+"+(t>0?"\\.":"$")+")",o=o.toFixed(Math.max(0,~~t)).replace(new RegExp(i,"g"),"$&,")}};var jQueryModal={Show:function(t,e,a="modal-lg"){var n=$('<div id="myModalShowMess" class="modal fade"><div class="modal-dialog modal-custom '+a+'"><div class="modal-content"><div class="modal-header"><h5 class="modal-title w-100">'+t+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body">'+e+'</div><div class="modal-footer"><button class="btn btn-primary" data-dismiss="modal">Đóng</button></div></div></div></div>');n.modal("show"),n.on("hide.bs.modal",(function(){$(this).unbind(),$(this).remove()}))},ShowNotFooter:function(t,e,a="modal-lg"){var n=$('<div id="myModalShowMess" class="modal fade"><div class="modal-dialog modal-custom '+a+'"><div class="modal-content"><div class="modal-header"><h5 class="modal-title w-100">'+t+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body">'+e+"</div></div></div></div>");n.modal("show"),n.on("hide.bs.modal",(function(){$(this).unbind(),$(this).remove()}))}};function confirms(t,e,a,n,i,o=null){var l=$('<div class="modal fade" id="myModalShowMess"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h6 class="modal-title">'+t+'</h6><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span ></button ></div><div class="modal-body"><p>'+e+'</p></div><div class="modal-footer"><button type="button" id="cancelButtonTxt" class="btn btn-secondary" data-dismiss="modal">'+a+'</button><button type="button" id="okButton" class="btn btn-danger">'+n+"</button></div></div></div></div>");l.find("#okButton").click((function(t){i(),l.modal("hide"),$(this).unbind(),$(this).remove()})),l.find("#cancelButtonTxt").click((function(t){null!=o&&o(),l.modal("hide"),$(this).unbind(),$(this).remove()})),l.on("hide.bs.modal",(function(){$("div#myModal").empty(),$(this).unbind(),$(this).remove()})),l.modal("show")}function toggleFullScreen(){var t=window.document,e=t.documentElement,a=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen,n=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||t.msExitFullscreen;t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||t.msFullscreenElement?n.call(t):a.call(e)}function loadeventAddSell(){$("input#isRunPromotion").on("ifChanged",(function(t){1==$(this).prop("checked")?($("#IdPromotionRun").removeAttr("disabled"),$(this).parents("fieldset").find("input.form-control").removeAttr("disabled")):0==$(this).prop("checked")&&($("#IdPromotionRun").attr("disabled",!0),$("#IdPromotionRun").valid(),$(this).parents("fieldset").find("input.form-control").attr("disabled",!0))})),$("input#isPromotion").on("ifChanged",(function(t){1==$(this).prop("checked")?$(this).parents("fieldset").find("input.form-control").removeAttr("disabled"):0==$(this).prop("checked")&&$(this).parents("fieldset").find("input.form-control").attr("disabled",!0)})),$("input#IsAddingOptions").on("ifChanged",(async function(t){1==$(this).prop("checked")?($("#add-option-body").append('<div class="card-style-option" id="items-input-addcontent">\n                    <div class="input-addcontent pr-3 pt-3 pb-3">\n                                                       <div class="header-select mb-3 item-grid-sort">\n                                                            <label for="">Tên tùy chọn<span class="required">(*)</span></label>\n\n                                                            <button type="button" class="Sortable" role="button"><svg viewBox="0 0 20 20" class="Polaris-Icon__Svg_375hu" focusable="false" aria-hidden="true"><path d="M7 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm6-8a2 2 0 1 0-.001-4.001 2 2 0 0 0 .001 4.001zm0 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001z"></path></svg></button>\n                                                              \n                                                                <select class="form-control">\n                                                                    <opiton></opiton>\n                                                                </select>\n                                                            <i class="fa fa-trash"></i>\n                                                        </div>\n                                                        <div class="body-addoption">\n                                                            <div class="tile-option-choose hidden-Sortable">\n                                                                 <label for="">Giá trị tùy chọn<span class="required">(*)</span></label>\n                                                            </div>\n                                                           <div class="item-grid-sort">\n                                                                <button type="button" class="Sortable-body-addoption" role="button"><svg viewBox="0 0 20 20" class="Polaris-Icon__Svg_375hu" focusable="false" aria-hidden="true"><path d="M7 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm6-8a2 2 0 1 0-.001-4.001 2 2 0 0 0 .001 4.001zm0 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001z"></path></svg></button>\n                                                                <input type="text" class="form-control" data-id="" name="" placeholder="Nhập giá trị" />\n                                                                <i class="fa fa-trash"></i>\n                                                            </div>\n                                                        </div>\n                                                        <button class="btn btn-success" type="button" data-style="expand-left">\n                                                            <span class="ladda-label"><i class="fas fa-check"></i> Xong</span>\n                                                        </button>\n                                                    </div>\n                                                   \n                                                </div>'),$(".option-add .card").append('<div class="card-footer">\n                                                    <div class="btn-addoption">\n                                                        <i class="fas fa-solid fa-plus mr-2"></i> Thêm tùy chọn khác\n                                                    </div>\n                                                </div>'),$("#items-input-addcontent .header-select").addClass("new-input-data"),loadEventadmin.eventsortableproduct(),loadEventadmin.event_removerowsortable($(".header-select")),await loadEventadmin.event_loadajaxdataselect2($(".header-select select"))):0==$(this).prop("checked")&&($("#add-option-body").find(".card-style-option").remove(),$(".option-add .card-footer").remove(),loadEventadmin.eventloadremovetablestyleproduct()),loadEventadmin.eventaddstypeoptionproduct($("#items-input-addcontent")),loadEventadmin.eventbtnaddstypeoptionproduct()}))}function LoadDataTable(){dataTable=$("#TableData").DataTable({lengthMenu:[[10,25,50,100,200,-1],[10,25,50,100,200,"All"]],pageLength:10,order:[[0,"desc"]],pagingType:"full_numbers",language:{oPaginate:{sFirst:"Đầu",sPrevious:"Trước",sNext:"Tiếp",sLast:"Cuối"},sSearch:"Tìm kiếm:",sInfoFiltered:"(được lọc từ _MAX_ mục)",lengthMenu:"Hiển thị _MENU_ dòng trên một trang",zeroRecords:"Không tìm thấy kết quả nào",sInfo:"Hiển thị dòng _START_  đến dòng _END_  trên tổng số _TOTAL_ dòng (Trang _PAGE_/_PAGES_)",infoEmpty:"Không có dữ liệu",infoFiltered:"(Lọc được từ _MAX_ tổng số mục )"}})}function LoadDataTableById(t){dataTable=$("#"+t).DataTable({lengthMenu:[[10,25,50,100,200,-1],[10,25,50,100,200,"All"]],pageLength:10,pagingType:"full_numbers",language:{oPaginate:{sFirst:"Đầu",sPrevious:"Trước",sNext:"Tiếp",sLast:"Cuối"},sSearch:"Tìm kiếm:",sInfoFiltered:"(được lọc từ _MAX_ mục)",lengthMenu:"Hiển thị _MENU_ dòng trên một trang",zeroRecords:"Không tìm thấy kết quả nào",sInfo:"Hiển thị dòng _START_  đến dòng _END_  trên tổng số _TOTAL_ dòng (Trang _PAGE_/_PAGES_)",infoEmpty:"Không có dữ liệu",infoFiltered:"(Lọc được từ _MAX_ tổng số mục )"}})}function validateFormUser(){$("#FormValidate").validate({ignore:"input[type=hidden]",rules:{FullName:{required:!0,minlength:4},Email:{required:!0,email:!0},Password:{required:!0,minlength:4},ConfirmPassword:{equalTo:"#Password"}},messages:{FullName:{required:errrequired,minlength:errminlength5},Email:{required:errrequired,email:"Email không đúng định dạng"},Password:{required:errrequired,minlength:errminlength5},ConfirmPassword:{equalTo:"Mật khẩu nhập lại không khớp"}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).addClass("is-valid").removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})}$(document).ajaxStart((function(){$.blockUI({message:$('<div class="loader mx-auto">\n <div class="line-scale-pulse-out">\n   <div class="bg-success"></div>\n <div class="bg-success"></div>\n  <div class="bg-success"></div>\n <div class="bg-success"></div>\n                                <div class="bg-success"></div>\n                            </div>\n                        </div>')})})).ajaxStop((function(){$('[data-toggle="tooltip"]').tooltip(),Ladda.stopAll(),$.unblockUI()})),$("#TableData").DataTable({lengthMenu:[[10,25,50,100,200,-1],[10,25,50,100,200,"All"]],pageLength:10,pagingType:"full_numbers",order:[[0,"asc"]],language:{oPaginate:{sFirst:"Đầu",sPrevious:"Trước",sNext:"Tiếp",sLast:"Cuối"},sSearch:"Tìm kiếm:",sInfoFiltered:"(được lọc từ _MAX_ mục)",lengthMenu:"Hiển thị _MENU_ dòng trên một trang",zeroRecords:"Không tìm thấy kết quả nào",sInfo:"Hiển thị dòng _START_  đến dòng _END_  trên tổng số _TOTAL_ dòng (Trang _PAGE_/_PAGES_)",infoEmpty:"Không có dữ liệu",infoFiltered:"(Lọc được từ _MAX_ tổng số mục )"}});var validateForm={AddPublishInvoiceMerge:function(){$("#create-formProduct").validate({ignore:"input[type=hidden]",rules:{VATAmount:{required:!0,number:!0},Amount:{required:!0,number:!0},Vatrate:{required:!0,number:!0},IdPaymentMethod:{required:!0,number:!0,min:1}},messages:{VATAmount:{required:errrequired,number:errnumber},Amount:{required:errrequired,number:errnumber},Vatrate:{required:errrequired,number:errnumber},IdPaymentMethod:{required:errrequired,number:errnumber}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})},EditAndAddCustomer:function(){$("#create-form").validate({ignore:"input[type=hidden]",rules:{Name:{required:!0,minlength:3}},messages:{Name:{required:errrequired,minlength:errminlength3}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})},EditAndAddRevenueExpenditure:function(){$("#create-form").validate({ignore:"input[type=hidden]",rules:{Name:{required:!0},Amount:{required:!0},IdCategoryCevenue:{required:!0},ObjectRevenueExpenditure:{required:!0},IdPayment:{required:!0},CustomerName:{required:!0},Date:{required:!0}},messages:{Name:{required:errrequired},Amount:{required:errrequired},IdCategoryCevenue:{required:errrequired},ObjectRevenueExpenditure:{required:errrequired},IdPayment:{required:errrequired},CustomerName:{required:errrequired},Date:{required:errrequired}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})},formEivnoiceVNPT:function(){$("#create-form").validate({ignore:"input[disabled=disabled]",ignore:"input[type=hidden]",rules:{DomainName:{required:!0},UserNameService:{required:!0},PassWordService:{required:!0},DomainName:{required:!0},UserNameAdmin:{required:!0},PassWordAdmin:{required:!0}},messages:{DomainName:{required:errrequired},UserNameService:{required:errrequired},PassWordService:{required:errrequired},DomainName:{required:errrequired},UserNameAdmin:{required:errrequired},PassWordAdmin:{required:errrequired}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})},EditAndAddTableRoom:function(){$("#create-form").validate({ignore:"input[type=hidden]",rules:{Name:{required:!0,minlength:3},NameSelect:{required:!0},Fromno:{required:!0,min:1,number:!0},Tono:{required:!0,min:1,number:!0}},messages:{Name:{required:errrequired,minlength:errminlength3},Fromno:{required:errrequired,number:"Vui lòng nhập số",min:"Số phải bắt đầu từ 1"},Tono:{required:errrequired,number:"Vui lòng nhập số",min:"Số phải bắt đầu từ 1"}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})},EditAndAddSupplier:function(){$("#create-form").validate({ignore:"input[type=hidden]",rules:{Name:{required:!0},Address:{required:!0}},messages:{Name:{required:errrequired},Address:{required:errrequired}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})},EditAndAddUnit:function(){$("#create-form").validate({ignore:"input[type=hidden]",rules:{Name:{required:!0}},messages:{Name:{required:errrequired}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})},EditAndAddPaymentMethod:function(){$("#create-form").validate({ignore:"input[type=hidden]",rules:{Name:{required:!0,minlength:3},Code:{required:!0}},messages:{Name:{required:errrequired,minlength:errminlength3},Code:{required:errrequired}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})},EditAndAddTemplateInvoice:function(){$("#create-form").validate({ignore:"input[type=hidden]",rules:{Name:{required:!0,minlength:3},TypeTemplatePrint:{required:!0},Template:{required:!0}},messages:{TypeTemplatePrint:{required:errrequired},Name:{required:errrequired,minlength:errminlength3},Template:{required:errrequired,minlength:errminlength3}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})},addOrEditMangerPatternEInvoice:function(){$("#create-form").validate({ignore:"input[type=hidden]",rules:{Pattern:{required:!0,minlength:3},Serial:{required:!0}},messages:{Serial:{required:errrequired,minlength:errminlength3},Serial:{required:errrequired,minlength:errminlength3}},submitHandler:function(t){}})},EditOrUpdateProduct:function(){$("#create-formProduct").validate({ignore:"input[disabled=disabled]",ignore:"select[disabled=disabled]",rules:{Name:{required:!0,minlength:1},idCategory:{required:!0}},messages:{Name:{required:errrequired,minlength:errminlength5},idCategory:{required:errrequired},idPrice:{required:errrequired},_Price:{minStrict:"Vui lòng nhập đơn giá",required:errrequired},Description:{required:errrequired}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid")},unhighlight:function(t){$(t).removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid")},submitHandler:function(t){}}),$("#create-formProduct .select2_cre").on("change",(function(t){$(this).valid()}))},UpdateConfigSystem_settingsellBannerheader:function(){$("#setting-sellBannerheader").validate({ignore:"input[disabled=disabled]",ignore:"input[type='color']",ignore:"select[disabled=disabled]",rules:{UrlSell:{required:!0,minlength:5},TitleSell:{required:!0,minlength:5},ColorTitle:{required:!0},Color:{required:!0}},messages:{UrlSell:{required:errrequired,minlength:errminlength5},TitleSell:{required:errrequired,minlength:errminlength5},ColorTitle:{required:errrequired},Color:{required:errrequired}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).addClass("is-valid").removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}})}};function loadLadda(){Ladda.bind(".ladda-button",{callback:function(t){$("input#email_send,input#password,input#confirm_password,input#email_to,input#email_cc,input#email_bcc,input#email_name").attr("readonly","readonly")},timeout:2e5})}function loadEventIcheck(){$("input.icheck").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"})}function loadevent(){loadEventIcheck(),$(".select2").select2({placeholder:"Chọn giá trị",allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}})}function loadEventSelect2(t){$(t).select2({placeholder:"Chọn giá trị",allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}})}function getImgURL(t,e){var a=new XMLHttpRequest;a.onload=function(){e(a.response)},a.open("GET",t),a.responseType="blob",a.send()}function loadURLToInputField(t,e,a){getImgURL(t,(t=>{let n=new File([t],""!=e?e:"hasFilename.jpg",{type:""!=a?a:"image/jpeg",lastModified:(new Date).getTime()},"utf-8"),i=new DataTransfer;i.items.add(n),document.querySelector("#elfinderfile").files=i.files}))}function AddProduct(t){var e=t;if(!$("#create-formProduct").valid())return Ladda.stopAll(),!1;if(""==$("#elfinder-input").val()&&0==parseInt($("#Id").val()))return $("#tab-img").click(),toastr.error("Bạn chưa chọn hình ảnh đại diện"),Ladda.stopAll(),!1;try{for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement(),$("#"+instance).val(CKEDITOR.instances[instance].getData());var a=!1,n=$("#IsAddingOptions").prop("checked");if(1==$("#tableStylePrice").length&&n){var i=[],o=[];$("#tableStylePrice").find("tbody").find("tr").each((function(t,e){let n=$(this).attr("class").replaceAll("even","").replaceAll("odd",""),o=$(this).attr("IdOptionsName"),l=$(this).data("id")||0,r=$(this).find(".name").text(),s=$(this).find(".code").val(),d=$(this).find(".price").val().replaceAll(".",""),c=$(this).find(".quantity").val().replaceAll(".","");if(""==d||0==d){return toastr.error("Đơn giá vui lòng không được bỏ trống"),$(this).find(".price").focus(),$(this).find(".price").addClass("error"),$(this).find(".price").after(),$(this).find(".price").keyup((function(){0==this.length||0==this.value?$(this).find(".price").addClass("error"):$(this).find(".price").removeClass("error")})),Ladda.stopAll(),a=!0,!1}var u={};u.IdOptionsName=o,u.Id=l,u.Name=r,u.SKU=s,u.Price=parseFloat(d),u.Quantity=""!=c?parseInt(c):0,u.ClassName=n,i.push(u)})),$("#items-input-addcontent").find(".input-addcontent").each((function(t,e){var a={};styleproduct1=$(this).find("select").val(),a.IdStyleOptionsProduct=styleproduct1,a.Sort=t;var n=[];$(this).find("input").each((function(t,e){var a={};""!=this.value.trim()&&(_id=$(this).data("id")||0,a.Id=_id,a.Name=this.value,a.Sort=t,n.push(a))})),a.OptionsNames=n,o.push(a)}))}if(a)return!1;{let t=JSON.stringify(i),e=JSON.stringify(o);$("#JsonTableByStylePro").val(t),$("#JsonListStylePro").val(e)}return $.ajax({type:"POST",url:e.action,data:new FormData(e),contentType:!1,processData:!1,success:function(t){t.isValid?dataTableOut.ajax.reload(null,!1):Ladda.stopAll()},error:function(t){console.log(t)}}),!1}catch(t){console.log(t)}}function AddPost(t){var e=t;if($("#create-formPost").validate({rules:{Name:{required:!0,minlength:5},idCategory:{required:!0}},messages:{Name:{required:errrequired,minlength:errminlength5},idCategory:{required:errrequired}},errorElement:"span",errorPlacement:function(t,e){if(Ladda.stopAll(),t.addClass("invalid-feedback"),"checkbox"===e.prop("type"))t.insertAfter(e.parent("label")),Ladda.stopAll();else{var a=e.parent();a=a.children().last(),t.insertAfter(a.last()),Ladda.stopAll()}var n=$(e);n.hasClass("select2-hidden-accessible")&&(e=$("#select2-"+n.attr("id")+"-container").parents(".form-group")).append(t)},highlight:function(t){$(t).addClass("is-invalid").removeClass("is-valid"),Ladda.stopAll();var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").addClass("is-invalid").removeClass("is-valid")},unhighlight:function(t){$(t).addClass("is-valid").removeClass("is-invalid");var e=$(t);e.hasClass("select2-hidden-accessible")&&$("#select2-"+e.attr("id")+"-container").parents(".form-group").find("span.select2-selection--single").removeClass("is-invalid").addClass("is-valid")},submitHandler:function(t){}}),$("#create-formPost .select2").on("change",(function(t){$(this).valid()})),!$("#create-formPost").valid())return Ladda.stopAll(),!1;if(""==$("#customFile").val()&&0==parseInt($("#Id").val()))return toastr.error("Bạn chưa chọn hình ảnh đại diện"),Ladda.stopAll(),!1;try{for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement(),$("#"+instance).val(CKEDITOR.instances[instance].getData());return $.ajax({type:"POST",url:e.action,data:new FormData(e),contentType:!1,processData:!1,success:function(t){t.isValid?(t.loadTable?dataTableOut.ajax.reload(null,!1):($("#viewAll").html(t.html),t.loadDataTable&&LoadDataTable()),$("#form-modal").modal("hide"),$("#myModalShowMess").modal("hide"),$("#myModalShowMess").unbind(),$("#myModalShowMess").remove()):Ladda.stopAll(),loadevent()},error:function(t){console.log(t)}}),!1}catch(t){console.log(t)}}function confirmcustom(t,e){var a=t;return confirms("Xác nhận",e,"<i class='far fa-times-circle'></i> Hủy","<i class='fas fa-check-circle'></i> Đồng ý",(function(){$(a).closest("form").submit()})),!1}function priceFormat(){$(".priceFormat").priceFormat({prefix:"",centsLimit:0,centsSeparator:".",thousandsSeparator:","})}function numberFormat(){$(".numberformat").number(!0,3,".",",")}$((function(){var t=window.location;$("#menuAdmin a").filter((function(){return this.href==t})).addClass("active").parents("li.nav-item").addClass("menu-open").children("a").addClass("active")})),Ladda.bind(".ladda-button",{callback:function(t){$("input#email_send,input#password,input#confirm_password,input#email_to,input#email_cc,input#email_bcc,input#email_name").attr("readonly","readonly")},timeout:2e5}),$(document).ready((function(){$('[data-toggle="tooltip"]').tooltip(),$("input.icheck").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"}),$(document).on("click","#ipxChangepass",(function(t){$(this).is(":checked")?($("#changepass").removeClass("d-none"),$("#changepass").find("input").attr("type","password").show()):($("#changepass").addClass("d-none"),$("#changepass").find("input").attr("type","hidden").hide())})),$(document).on("click","#btnsaveUser",(function(t){validateFormUser(),$("#FormValidate").valid()&&$(this).parents("form").submit()})),$(".form-image").click((function(){$("#customFile").trigger("click")})),setTimeout((function(){$("body").addClass("loaded")}),200),jQueryModalGet=(t,e,a=!0,n="modal-lg")=>{try{return $.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){a?t.isValid&&(t.modelFooter?jQueryModal.Show(e,t.html,n):jQueryModal.ShowNotFooter(e,t.html,n),t.loadDataTable&&LoadDataTable()):t.isValid?($("#form-modal .modal-body").html(t.html),$("#form-modal .modal-title").html(e),$("#form-modal .modal-dialog").addClass(n),t.modelFooter&&$("#form-modal .modal-footer").removeClass("d-none"),$("#form-modal").modal("show")):($("#form-modal .modal-body").html(t),$("#form-modal .modal-title").html(e),$("#form-modal").modal("show"))},error:function(t){console.log(t)}}),!1}catch(t){console.log(t)}},jQueryModalGetRightToLeft=(t,e,a="modal-lg")=>{try{return $.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid?($("#form-modal").addClass("right"),$("#form-modal .modal-dialog").removeClass("modal-dialog-centered"),$("#form-modal .modal-body").html(t.html),$("#form-modal .modal-title").html(e),$("#form-modal .modal-dialog").addClass(a),t.modelFooter&&$("#form-modal .modal-footer").removeClass("d-none"),$("#form-modal").modal("show")):($("#form-modal").addClass("right"),$("#form-modal .modal-dialog").removeClass("modal-dialog-centered"),$("#form-modal .modal-body").html(t),$("#form-modal .modal-title").html(e),$("#form-modal").modal("show"))},error:function(t){console.log(t)}}),!1}catch(t){console.log(t)}},jQueryPost=t=>{try{return $.ajax({type:"POST",url:t,contentType:!1,processData:!1,success:function(t){},error:function(t){console.log(t)}}),!1}catch(t){console.log(t)}},jQueryModalPost=t=>{try{if(eventUnFormatTextnumber3(),!$(t).valid())return Ladda.stopAll(),!1;for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement(),$("#"+instance).val(CKEDITOR.instances[instance].getData());return $.ajax({type:"POST",url:t.action,data:new FormData(t),contentType:!1,processData:!1,success:function(t){t.isValid?(t.loadTable?dataTableOut.ajax.reload(null,!1):($("#viewAll").html(t.html),t.loadDataTable&&LoadDataTable()),t.closeSwal&&Swal.close(),$("#form-modal").modal("hide"),$("#myModalShowMess").modal("hide"),$("#myModalShowMess").unbind(),$("#myModalShowMess").remove()):Ladda.stopAll()},error:function(t){console.log(t)}}),!1}catch(t){console.log(t)}},jQueryModalDelete=t=>(confirms("Xác nhận","Bạn có chắc chắn muốn xóa không?","<i class='far fa-times-circle'></i> Hủy","<i class='fas fa-check-circle'></i> Đồng ý",(function(){try{$.ajax({type:"POST",url:t.action,data:new FormData(t),contentType:!1,processData:!1,success:function(t){t.isValid&&(t.loadTable?dataTableOut.ajax.reload(null,!1):t.loadTreeview?loadData():$("#viewAll").html(t.html))},error:function(t){console.log(t)}})}catch(t){console.log(t)}})),!1)})),$((function(){var t=window.location;$(".app-sidebar__inner a").filter((function(){return this.href==t})).addClass("mm-active").parents("ul.mm-collapse").addClass("mm-show").parent("li").addClass("mm-active")})),$("#form-modal").on("hidden.bs.modal",(function(t){$("div.modal-body").html(""),$("div.modal-body").empty()}));var errRegex="Vui lòng nhập đúng định dạng",errrequired="Dữ liệu không được để trống",errminlength5="Trường dữ liệu ít nhất 5 ký tự",errminlength3="Trường dữ liệu ít nhất 3 ký tự",errnumber="Trường dữ liệu định dạng phải là số";function getObjectKey(t,e){return Object.keys(t).find((a=>t[a]===e))}function pushState(t){window.history.pushState({turbolinks:!0,url:t},null,t)}var eventConfigSaleParameters={eventUpdatecheckbox:function(){$(".ConfigSaleParameter input").map((function(t,e){let a=$(this).data("key"),n=$(this).data("parent"),i=$(this).data("type"),o=$(this).data("typevalue");$(this).removeAttr("data-key"),$(this).removeAttr("data-parent"),$(this).removeAttr("data-type"),$(this).removeAttr("data-typevalue"),$(this).data("key",a),$(this).data("parent",n),$(this).data("type",i),$(this).data("typevalue",o)})),$(".ConfigSaleParameter input").click((function(){var t=[];let e={},a=$(this).data("key"),n=$(this).data("parent"),i=$(this).data("type"),o=$(this).data("typevalue"),l=EnumConfigParameters[a];if($(this).prop("checked"))e.Key=a,e.TypeValue=o,e.Type=i,e.Value=!0,e.Parent=n,t.push(e),eventConfigSaleParameters.updatedatachange($(this),t);else{switch(l){case EnumConfigParameters.DELETEINVOICENOPAYMENT:e.Key=getObjectKey(EnumConfigParameters,EnumConfigParameters.ACCEPTPAYMENTDELETEINVOICE),e.Value=!1,e.Parent=getObjectKey(EnumConfigParameters,EnumConfigParameters.DELETEINVOICENOPAYMENT),e.Type=i,e.TypeValue="BOOL",t.push(e),e={};break;case EnumConfigParameters.PUBLISHMERGEINVOICE:e.Key=getObjectKey(EnumConfigParameters,EnumConfigParameters.DELETEIPUBLISHMERGEINVOICEAFTER),e.Value=!1,e.Parent=getObjectKey(EnumConfigParameters,EnumConfigParameters.PUBLISHMERGEINVOICE),e.Type=i,e.TypeValue="BOOL",t.push(e),e={}}e.Key=a,e.TypeValue=o,e.Value=!1,e.Type=i,e.Parent=n,t.push(e),eventConfigSaleParameters.updatedatachange($(this),t)}}))},updatedatachange:function(t,e){$.ajax({type:"POST",url:"/Selling/ConfigSaleParameters/Update",async:!0,data:{ConfigSaleParametersItems:e},success:function(a){a.isValid?$(t).prop("checked")?$(t).parents(".item-col").next().hasClass("childrenconfig")&&$(t).parents(".item-col").next().removeClass("d-none"):$(t).parents(".item-col").next().hasClass("childrenconfig")&&$(t).parents(".item-col").next().addClass("d-none"):e.forEach((function(t,e){t.value,$("input[data-key="+t.Key+"]").prop("checked",!1)}))},error:function(t){console.log(t)}})}},Product={eventbtnAddProduct:function(){$(".lst-action-addproduct a:nth-child(1)").click((function(){Product.Addproduct("/Selling/Product/CreateOrEdit?TypeProductCategory="+EnumTypeProductCategory.PRODUCT,EnumTypeProductCategory.PRODUCT)})),$(".lst-action-addproduct a:nth-child(2)").click((function(){Product.Addproduct("/Selling/Product/CreateOrEdit?TypeProductCategory="+EnumTypeProductCategory.SERVICE,EnumTypeProductCategory.SERVICE)})),$(".lst-action-addproduct a:nth-child(3)").click((function(){Product.Addproduct("/Selling/Product/CreateOrEdit?TypeProductCategory="+EnumTypeProductCategory.COOKING,EnumTypeProductCategory.COOKING)})),$(".lst-action-addproduct a:nth-child(4)").click((function(){Product.Addproduct("/Selling/Product/CreateOrEdit?TypeProductCategory="+EnumTypeProductCategory.COMBO,EnumTypeProductCategory.COMBO)}))},Addproduct:function(t,e){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({title:t.title,html:t.html,position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                              popup-lg\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate popup-lg animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!1,showConfirmButton:!1,showCancelButton:!1,confirmButtonText:"Lưu",cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{null==t.idUnit&&(t.idUnit=0),evetnFormatnumber3(),evetnFormatTextnumber3decimal(),CKEDITOR.replace("Description"),$('[data-toggle="tooltip"]').tooltip(),validateForm.EditOrUpdateProduct(),loaddataSelect2CustomsTempalte("/Api/Handling/GetAllCategoryProduct?IsPos=true","#idCategory",t.idcategory,"Chọn thực đơn"),loaddataSelect2Tempalte("/Api/Handling/GetAllUnit","#IdUnit",t.idUnit,"Chọn đơn vị tính"),loaddaterangepicker(),loadEventIcheck(),loadeventAddSell(),Product.loadCheckDecimal(),t.typeProductCategory==EnumTypeProductCategory.COMBO?(Product.autocompleteproduct(t.typeProductCategory),Product.loadEvnetFormatTable(),Product.loadeventUpdateAmount(),Product.loadEventChangeQuantity(),Product.loadEventRemoveProduct(),Product.loadEventActionQuantity()):t.typeProductCategory==EnumTypeProductCategory.COOKING&&(Product.autocompleteproduct(t.typeProductCategory),Product.loadEvnetFormatTable(),Product.loadEventRemoveProduct()),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){if(t.typeProductCategory==EnumTypeProductCategory.COMBO){if(!($(".table-combo tbody tr:not(.nodata)").length>0))return void toastrcus.error("Chưa có thành phần combo được chọn");Product.GetDataCombo()}$("form#create-formProduct").valid()&&(eventUnFormatTextnumber3(),jQueryModalPost($("form#create-formProduct")[0]))}))}}).then((t=>{if(t.isConfirmed)return $("#create-formProduct").submit(),!1}))},error:function(t){console.log(t)}})},loadCheckDecimal:function(){let t=parseFloat($("#PriceNoVAT").val().replaceAll(",",""));if(-1!=t.toString().indexOf(".")){let e=t.toString().split(".");$(".decimalPrice").val(e[1].length)}else $(".decimalPrice").val(3);Product.loadChangePrice(),Product.loadChangedecimalPrice(),Product.loadChangeVATRate(),Product.loadeEventCheckIsInventory(),Product.loadeEventCheckIsVATProduct()},loadChangePrice:function(){$("#_Price").change((function(){$("#VATRate").trigger("change")}))},loadChangeVATRate:function(){$("#VATRate").change((function(){Product.loadPriceNoVAT()}))},loadChangedecimalPrice:function(){$(".decimalPrice").change((function(){let t=parseInt($(".decimalPrice").val());return t<0?($(".decimalPrice").val(0),void toastrcus.error("Giá trị số lẻ của đơn giá không được nhỏ hơn 0")):t>3?(toastrcus.error("Giá trị số lẻ của đơn giá không được lớn hơn 3"),void $(".decimalPrice").val(3)):void Product.loadPriceNoVAT()}))},loadPriceNoVAT:function(){if(0==$("#IsVAT").prop("checked"))$("#PriceNoVAT").val(0);else{let t=parseInt($(".decimalPrice").val()),e=parseFloat($("#VATRate").val()),a=parseFloat($("#_Price").val().replaceAll(",",""));if(-3==e)return void $("#PriceNoVAT").val(a.format0VND(3,3));let n=parseFloat((a/(e/100+1)).toFixed(t));$("#PriceNoVAT").val(n.format0VND(3,3))}},loadShowVATRate:function(){0==$("#IsVAT").prop("checked")&&($("#VATRate option[value='-3']").prop("selected","selected"),$("#VATRate").attr("disabled","disabled")),$("#VATRate").trigger("change")},GetDataCombo:function(){let t=[],e=!0;$(".table-combo tbody tr").map((function(){let a={};a.Id=parseInt($(this).find(".code").data("id"))||0,a.IdPro=parseInt($(this).find(".code").data("idpro"))||0,a.RetailPrice=parseInt($(this).find(".retailPrice").data("retailPrice"))||0,a.Name=$(this).find(".name").data("name"),$(this).find(".quantity").length>0?a.Quantity=parseFloat($(this).find(".quantity").val().replaceAll(",",""))||0:a.Quantity=0,0==a.IdPro&&(toastrcus.error("Lỗi hàng hóa: "+a.Name+" đã bị xóa khỏi hệ thống, vui lòng tải lại trang để thử lại"),e=!1),t.push(a)})),e||toastrcus.error("Chưa có thành phần combo"),0==t.length&&toastrcus.error("Chưa chọn thành phần combo");let a=JSON.stringify(t);$("#JsonListComboProduct").val(a)},loadeEventCheckIsInventory:function(){$(".checkboxIsInventory").on("ifChecked",(function(t){$("#Quantity").attr("readonly","readonly"),$("#Quantity").parent(".form-group").addClass("d-none")})),$(".checkboxIsInventory").on("ifUnchecked",(function(t){$("#Quantity").removeAttr("readonly","readonly"),$("#Quantity").parent(".form-group").removeClass("d-none")}))},loadeEventCheckIsVATProduct:function(){$("#IsVAT").on("ifChecked",(function(t){$(".elePriceProductNoVAT").toggleClass("d-none"),$("#VATRate").removeAttr("disabled","disabled"),Product.loadShowVATRate()})),$("#IsVAT").on("ifUnchecked",(function(t){Product.loadShowVATRate(),$(".elePriceProductNoVAT").toggleClass("d-none"),$("#VATRate").attr("disabled","disabled")}))},UpdatePriceProduct:function(t){let e=$(t).data("am"),a=$(t).data("id"),n=parseFloat($(t).val().replaceAll(",",""))||0;$.ajax({type:"POST",url:"/Selling/Product/UpdatePrice",async:!0,data:{id:a,price:n},success:function(a){a.isValid?$(t).data("am",n):$(t).val(parseFloat(e).format0VND(3,3,""))},error:function(t){console.log(t)}})},Delete:function(t,e,a){var n=!1;try{$.ajax({type:"POST",url:t,async:!1,data:{id:e,idProduct:a},success:function(t){t.isValid&&(n=!0)},error:function(t){console.log(t)}})}catch(t){console.log(t)}return n},autocompleteproduct:function(t){$(".search-product").autocomplete({appendTo:"#parentautocomplete",autoFocus:!0,minLength:1,delay:0,source:function(e,a){$.ajax({global:!1,url:"/Selling/Pos/SearchProductPos",type:"GET",dataType:"json",data:{text:e.term,iSsell:!1,type:t},success:function(t){return a($.map(t,(function(a){let n=__highlight(a.name,e.term),i="<span class='ton'>Tồn kho: "+parseFloat(a.quantity).format0VND(3,3,"")+"<span>";return(t.isInventory||t.typeProductCategory==EnumTypeProductCategory.COMBO||t.typeProductCategory==EnumTypeProductCategory.SERVICE)&&(i="<span class='ton'>Tồn kho: -- <span>"),{label:"<a href='javascript:void(0)'><div class='search-auto'><div class='img'><img src='../../../"+a.img+"'></div><div class='tk_name'><span>"+n+" ("+a.code+")</span><span class='price'>Giá: "+parseFloat(a.price).format0VND(3,3,"")+"</span>"+i+"</div></div></a>",value:a.code,idProduct:a.id,price:a.price,retailPrice:a.retailPrice,quantity:a.quantity,name:a.name,typeProductCategory:a.typeProductCategory}}))),{label:e.term,value:e.term}}})},html:!0,select:function(t,e){$(this).val(e.item.value),$(this).select(),e.item.typeProductCategory==EnumTypeProductCategory.COMBO||e.item.typeProductCategory==EnumTypeProductCategory.SERVICE?Product.loadeventselectTable(e.item.idProduct,e.item.name,e.item.price,e.item.value,e.item.retailPrice,e.item.typeProductCategory):toastrcus("Dịch vụ chưa hỗ trợ chọn thành phần")},response:function(){}}).focus((function(){$(this).autocomplete("search"),$(this).select()})),$(".search-product").keypress((async function(t){let e=$(this).val();if(13==t.keyCode&&e.length>0){let t=await Product.loadEventEnterInputAddPro(e);if($(this).select(),!t)return void toastrcus.error("Hàng hóa không hợp lệ!")}}))},loadEventEnterInputAddPro:async function(t){let e=!1;return $(".table-combo tbody tr").map((function(){$(this).find(".code").text().trim()==t&&(e=!0,$(this).find(".add-quantity").trigger("click"))})),e},loadeventselectTable:async function(t,e,a,n,i,o){if(!await Product.loadEventEnterInputAddPro(n)){$(".table-combo tbody tr.nodata").remove();let l=$(".table-combo tbody tr").length+1,r="";o==EnumTypeProductCategory.COMBO?r='<tr>\n                          <td><i class="fas fa-trash fa-remove"></i></td>\n                          <td>'+l+'</td>\n                          <td class="code" data-id="0" data-idpro="'+t+'">'+n+'</td>\n                          <td class="name" data-name="'+e+'">'+e+'</td>\n                          <td style="width: 175px;">\n                            <div class="input-group">\n                              <div class="input-group-prepend">\n                                <span class="input-group-text minus-quantity" id="basic-addon1"><i class="fas fa-minus"></i></span>\n                              </div>\n                              <input type="text" class="form-control number3 text-center quantity" data-quantity="1" placeholder="Nhập số lượng" value="1">\n                              <div class="input-group-prepend">\n                                <span class="input-group-text add-quantity" id="basic-addon1"><i class="fas fa-plus"></i></span>\n                              </div>\n                            </div>\n                          </td>\n                           <td class=""><input type="text" readonly disabled class="text-right form-control number3 retailPrice" data-retailPrice="'+parseFloat(i)+'" value="'+parseFloat(i)+'"/></td>\n                          <td class=""><input type="text" readonly disabled class="text-right form-control number3 price" data-price="'+parseFloat(a)+'" value="'+parseFloat(a)+'"/></td>\n                          <td class=""><input type="text" readonly disabled class="text-right number3 form-control amount" data-amount="'+parseFloat(a)+'"  value="'+parseFloat(i)+'"/></td>\n                      </tr>':o==EnumTypeProductCategory.SERVICE&&(r='<tr>\n                          <td><i class="fas fa-trash fa-remove"></i></td>\n                          <td>'+l+'</td>\n                          <td class="code" data-id="0" data-idpro="'+t+'">'+n+'</td>\n                          <td class="name" data-name="'+e+'">'+e+'</td>\n                          <td class=""><input type="text" readonly disabled class="text-right form-control number3 retailPrice" data-retailPrice="'+parseFloat(i)+'" value="'+parseFloat(i)+'"/></td>\n                          <td class=""><input type="text" readonly disabled class="text-right form-control number3 price" data-price="'+parseFloat(a)+'" value="'+parseFloat(a)+'"/></td>\n                      </tr>'),1==l?$(".table-combo tbody").html(r):$(".table-combo tbody tr:last").after(r),Product.loadEvnetFormatTable(),Product.loadEventRemoveProduct(),o==EnumTypeProductCategory.SERVICE||o==EnumTypeProductCategory.COMBO&&(Product.loadeventUpdateAmount(),Product.loadEventChangeQuantity(),Product.loadEventActionQuantity())}},loadEventActionQuantity:function(){$(".table-combo tbody tr .minus-quantity").unbind(),$(".table-combo tbody tr .minus-quantity").click((function(){Product.loadhighlightrow($(this).parents("tr"));let t=$(this).parents("tr").find(".quantity").data("quantity"),e=parseFloat($(this).parents("tr").find(".quantity").val().replaceAll(",",""))||0;if(e-=1,!(e>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(t);{let t=e*(parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0),a=e*(parseFloat($(this).parents("tr").find(".retailPrice").val().replaceAll(",",""))||0);$(this).parents("tr").find(".amount").val(a.format0VND(3,3,"")),$(this).parents("tr").find(".amount").data("amount",t),$(this).parents("tr").find(".quantity").val(e.format0VND(3,3,"")),$(this).data("quantity",e)}Product.loadeventUpdateAmount()})),$(".table-combo tbody tr .add-quantity").unbind(),$(".table-combo tbody tr .add-quantity").click((function(){Product.loadhighlightrow($(this).parents("tr"));let t=$(this).parents("tr").find(".quantity").data("quantity"),e=parseFloat($(this).parents("tr").find(".quantity").val().replaceAll(",",""))||0;if(e+=1,!(e>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(t);{let t=parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0,a=e*(parseFloat($(this).parents("tr").find(".retailPrice").val().replaceAll(",",""))||0),n=e*t;$(this).parents("tr").find(".amount").val(a.format0VND(3,3,"")),$(this).parents("tr").find(".amount").data("amount",n),$(this).parents("tr").find(".quantity").val(e.format0VND(3,3,"")),$(this).parents("tr").find(".quantity").data("quantity",e)}Product.loadeventUpdateAmount()}))},loadhighlightrow:function(t){null!=setTimeoutremoveactiverow&&clearTimeout(setTimeoutremoveactiverow),$(".table-combo tbody tr.active").removeClass("active"),$(t).addClass("active"),setTimeoutremoveactiverow=setTimeout((()=>{$(".table-combo tbody tr.active").removeClass("active")}),1e3)},loadeventUpdateAmount:function(){let t=0,e=0;$(".table-combo tbody tr:not(.nodata)").length>0&&$(".table-combo tbody tr").map((function(){e+=parseFloat($(this).find(".amount").data("amount"))||0,t+=parseFloat($(this).find(".amount").val().replaceAll(",",""))||0})),$("#giavon").html(t.format0VND(3,3,"")),$("#giaban").html(e.format0VND(3,3,""))},loadEventChangeQuantity:function(){$(".table-combo tbody tr input.quantity").unbind(),$(".table-combo tbody tr input.quantity").change((function(){Product.loadhighlightrow($(this).parents("tr"));let t=$(this).data("quantity"),e=parseFloat($(this).val().replaceAll(",",""))||0;if(!(e>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(t);{let t=parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0,a=e*(parseFloat($(this).parents("tr").find(".retailPrice").val().replaceAll(",",""))||0),n=e*t;$(this).parents("tr").find(".amount").val(a.format0VND(3,3,"")),$(this).parents("tr").find(".amount").data("amount",n),$(this).data("quantity",e)}Product.loadeventUpdateAmount()}))},loadEventRemoveProduct:function(){$(".table-combo tbody tr .fa-remove").unbind(),$(".table-combo tbody tr .fa-remove").click((function(){$(this).parents("tr").remove(),Product.loadeventUpdateAmount()}))},loadEvnetFormatTable:function(){$(".table-combo tbody tr input").unbind(),$(".table-combo tbody tr input.number3").each((function(t,e){var a=$(this).val();$(this).val(a.replaceAll(",",""))})),$(".table-combo tbody tr input.number3").each((function(t,e){var a=$(this).val();$(this).val(a.replaceAll(",",".")),fnInitialFormatNumber(this)})).ForceNumericOnly().focus((function(){var t=$(this).val();$(this).val(t.replaceAll(",",""))})).focusout((function(){fnFocusOut(this)}))}},JqueryModal={ViewPDF:function(t){loadingStart();jQueryModal.Show("Thông tin chi tiết",'<div id="ViewPDF"></div>',"modal-70"),setTimeout((function(){PDFObject.embed(t,"#ViewPDF"),loadingStop()}),1e3)},Delete:function(t,e){return confirms("Xác nhận","Bạn có chắc chắn muốn xóa không?","<i class='far fa-times-circle'></i> Hủy","<i class='fas fa-check-circle'></i> Đồng ý",(function(){try{return $.ajax({type:"POST",url:t,async:!1,data:{Id:parseInt(e)},success:function(t){if(t.isValid)return""!=t.html&&$("#viewAll").html(t.html),!0},error:function(t){console.log(t)}}),!1}catch(t){console.log(t)}})),!1},DeleteRemove:function(t,e,a){return confirms("Xác nhận","Bạn có chắc chắn muốn xóa không?","<i class='far fa-times-circle'></i> Hủy","<i class='fas fa-check-circle'></i> Đồng ý",(function(){try{return $.ajax({type:"POST",url:t,async:!1,data:{Id:parseInt(e)},success:function(t){if(t.isValid)return""!=t.html&&$("#viewAll").html(t.html),$(a).parents("tr").remove(),!0},error:function(t){console.log(t)}}),!1}catch(t){console.log(t)}})),!1}};function loadingElementStart(t){$("#"+t).block({message:$('<div class="loader mx-auto">\n<div class="ball-pulse-sync">\n<div class="bg-white"></div>\n<div class="bg-white"></div>\n<div class="bg-white"></div>\n</div>\n</div>')})}function loadingStopElement(t){$("#"+t).unblock()}function loadingStart(){$.blockUI({message:$('<div class="loader mx-auto">\n<div class="ball-pulse-sync">\n<div class=""></div>\n<div class=""></div>\n<div class=""></div>\n</div>\n</div>')})}function loadingStop(){$.unblockUI()}function loadDataAjax(t,e="#viewAll"){$.ajax({global:!1,type:"GET",url:t,beforeSend:function(){$(e).block({message:$('<div class="loader mx-auto">\n<div class="ball-pulse-sync">\n<div class="bg-white"></div>\n<div class="bg-white"></div>\n<div class="bg-white"></div>\n</div>\n</div>')})},success:function(t){void 0!==t.isValid&&t.isValid?($(e).html(t.html),LoadDataTable()):$(e).html(t),$.unblockUI(),Ladda.stopAll()}})}function loaddataSelect2(t,e,a="",n=""){$.ajax({global:!0,type:"GET",url:t,data:{idselectd:a},success:function(t){JSON.parse(t).push(""),$(e).select2({data:JSON.parse(t),placeholder:""!=n?n:"Chọn giá trị",allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}})}})}function sendmail(t,e){$.ajax({type:"POST",url:"/admin/email/SendEmail",async:!1,data:{email:t,id:e},success:function(t){}})}function reSendEmail(t){var e=t;$.ajax({type:"POST",url:"/admin/email/GetById?id="+t,success:function(t){t.isValid&&Swal.fire({title:"Địa chỉ email gửi",input:"text",inputLabel:"Nhập email gửi cách nhau bởi dấu phẩy",inputValue:t.email,showCancelButton:!0,inputValidator:t=>{if(!t)return"Vui lòng nhập email!";var a=/^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i;if(-1!=t.indexOf(","))t.split(",").forEach((function(t){if(!a.test(t))return"Địa chỉ email "+t+" không hợp lệ"}));else if(!a.test(t))return"Địa chỉ email "+t+" không hợp lệ";sendmail(t,e)}})}})}function loaddataSelect2arrPost(t,e,a,n,i=""){$.ajax({global:!1,type:"POST",url:e,async:!0,data:{idselectd:i,code:a,idbrand:n},success:function(e){var a=JSON.parse(e);$(t).select2({data:a,placeholder:"Chọn giá trị",allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}})}})}function loaddataCheckboxGET(t,e=""){var a="";return $.ajax({global:!1,type:"GET",url:t,async:!1,data:{idselectd:e},success:function(t){JSON.parse(t).forEach((function(t,e,n){let i="";t.selected&&(i="checked=checked");a+='<div class="col-md-3 mb-2 flex">\n                            <input name="idModel" class="mr-2" '+i+' value="'+t.id+'" type="checkbox" id="idModel"/> '+t.text+"\n                        </div>"}))}}),a}function loaddaterangepicker(t=!0){var e=new Date,a=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();e=a+"/"+n+"/"+i;let o="DD/MM/YYYY HH:mm";t||(o="DD/MM/YYYY");try{$(".fc-datetimepicker").daterangepicker({singleDatePicker:!0,showDropdowns:!0,showTodayButton:!0,minDate:0,autoApply:!0,todayHighlight:!0,autoUpdateInput:!1,timePicker:t,timePicker24Hour:t,format:o,locale:{format:o,separator:" - ",applyLabel:"Đồng ý",cancelLabel:"Hủy bỏ",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",weekLabel:"W",daysOfWeek:["CN","T2","T3","T4","T5","T6","T7"],monthNames:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],firstDay:1}});var l=0;$(window).on("click",(function(){l=0}));var r=$(".fc-datetimepicker");$(r).on("apply.daterangepicker",(function(t,e){l=0,$(this).val(e.startDate.format(o))})),$(".js-btn-calendar").on("click",(function(t){t.stopPropagation(),1===l?l=0:0===l&&(l=1),1===l&&r.focus()})),$(r).on("click",(function(t){t.stopPropagation(),l=1})),$(".daterangepicker").on("click",(function(t){t.stopPropagation()}))}catch(t){console.log(t)}try{$(".fc-datepicker").daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoUpdateInput:!1,todayHighlight:!0,locale:{format:"DD/MM/YYYY",separator:" - ",applyLabel:"Apply",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",weekLabel:"W",daysOfWeek:["CN","T2","T3","T4","T5","T6","T7"],monthNames:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],firstDay:1}});l=0;$(window).on("click",(function(){l=0}));r=$(".fc-datepicker");$(r).on("apply.daterangepicker",(function(t,e){l=0,$(this).val(e.startDate.format("DD/MM/YYYY"))})),$(".js-btn-calendar").on("click",(function(t){t.stopPropagation(),1===l?l=0:0===l&&(l=1),1===l&&r.focus()})),$(r).on("click",(function(t){t.stopPropagation(),l=1})),$(".daterangepicker").on("click",(function(t){t.stopPropagation()}))}catch(t){console.log(t)}}function loaddatetimerangepicker(){try{$(".fc-datepicker").daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoUpdateInput:!1,todayHighlight:!0,timePicker:!0,timePicker24Hour:!0,locale:{format:"DD/MM/YYYY HH:mm:ss",separator:" - ",applyLabel:"Đồng ý",cancelLabel:"Hủy bỏ",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",weekLabel:"W",daysOfWeek:["CN","T2","T3","T4","T5","T6","T7"],monthNames:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],firstDay:1}});var t=0;$(window).on("click",(function(){t=0}));var e=$(".fc-datepicker");$(e).on("apply.daterangepicker",(function(e,a){t=0,$(this).val(a.startDate.format("DD/MM/YYYY HH:mm:ss"))})),$(".js-btn-calendar").on("click",(function(a){a.stopPropagation(),1===t?t=0:0===t&&(t=1),1===t&&e.focus()})),$(e).on("click",(function(e){e.stopPropagation(),t=1})),$(".daterangepicker").on("click",(function(t){t.stopPropagation()}))}catch(t){console.log(t)}}function loadcheckall(){$("#checkall").click((function(){$("#tableselect input.item-check").not(this).prop("checked",this.checked)})),$(".item-check").change((function(){$(".item-check:checked").length==$(".item-check").length?$("#checkall").prop("checked",!0):$("#checkall").prop("checked",!1)}))}function loadeventcheckall(){var t=[];$(".saveEvent").click((function(){if($("input#checkall").is(":checked")||$("table#tableselect > tbody tr input[type=checkbox]:checked").each((function(e,a){let n=$(a).data("id");t.push(parseInt(n))})),t.length>0){let e=JSON.stringify(t);$("#JsonProduct").val(e)}$(this).parents("form").submit()}))}$(".btn-save-setting-inCustome-genager").click((function(){loadingElementStart("col-setting-genager"),$.ajax({type:"POST",data:$("#setting-genager").serialize(),url:"/admin/ConfigSystem/UpdateSettingGeneral",success:function(t){loadingStopElement("col-setting-genager"),Ladda.stopAll()}})})),$(".btn-save-setting-sell").click((function(){$("#setting-sellBannerheader").valid()&&(loadingElementStart("col-setting-sell"),$.ajax({type:"POST",data:$("#setting-sellBannerheader").serialize(),url:"/admin/ConfigSystem/UpdateSettingSell",success:function(t){loadingStopElement("col-setting-sell"),Ladda.stopAll()}}))})),$(".btn-save-setting-headerlayout").click((function(){loadingElementStart("col-setting-genagerBannerheader"),$.ajax({type:"POST",data:$("#setting-genagerBannerheader").serialize(),url:"/admin/ConfigSystem/UpdateSettingGeneral",success:function(t){loadingStopElement("col-setting-genagerBannerheader"),Ladda.stopAll()}})})),$(".btn-save-setting-category-home").click((function(){const t=$("#treeview").dxTreeView("getSelectedNodes");if(0==t.length)toastr.error("Vui lòng chọn ít nhất 1 chuyên mục cha"),Ladda.stopAll();else{loadingElementStart("treeview");var e=new Array;t.forEach((function(t,a){e.push(t.itemData)}));var a=JSON.stringify(e);$.ajax({type:"POST",data:{jsonData:a},url:"/admin/ConfigSystem/UpdateSettingCategoryInHome",success:function(t){loadingStopElement("treeview"),Ladda.stopAll()}})}}));var btnsaveStatus=$("#btnsaveStatus"),btncancelorder=$("#btn-cancelorder"),iunpxChangepass=$("#ipxChangepass"),search="#btnSearch",addevincoie=$(".btn-addeinvoice"),editeinvoice=$(".btn-editeinvoice");$(document).on("click","#btn-cancelorder",(function(t){let e=$(this).data("id");return confirms("Xác nhận","Bạn có chắc chắn hủy đơn hàng không?","<i class='far fa-times-circle'></i> Hủy","<i class='fas fa-check-circle'></i> Đồng ý",(function(){try{$.ajax({type:"GET",url:"/admin/order/Cancel?id="+e,success:function(t){$("#form-modal .modal-body").html(t.html),$("#form-modal .modal-title").html("Hủy đơn hàng"),$("#form-modal").modal("show"),loadeventnotecontetn()},error:function(t){console.log(t)}})}catch(t){console.log(t)}})),!1}));var eventCreate={viewSupplier:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({title:"Chi tiết nhà cung cấp",html:t.html,position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                              popup-lg\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate popup-lg animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{}})},error:function(t){console.log(t)}})},addOrEditSupplier:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({title:t.title,html:t.html,showClass:{popup:"\n                              popup-formcreate\n                                popup-formleft-500\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate popup-formleft-500 animate__animated animate__fadeOutRight animate__faster"},footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{validateForm.EditAndAddSupplier(),evetnFormatnumber3(),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){$("form#create-form").valid()&&jQueryModalPost($("form#create-form")[0])}))}})},error:function(t){console.log(t)}})},addOrEditArea:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({title:t.title,html:t.html,showClass:{popup:"popup-formcreate"},footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{validateForm.EditAndAddTableRoom(),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){$("form#create-form").valid()&&jQueryModalPost($("form#create-form")[0])}))}})},error:function(t){console.log(t)}})},addOrEditUnit:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({title:t.title,html:t.html,showClass:{popup:"popup-formcreate"},footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{validateForm.EditAndAddUnit(),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){$("form#create-form").valid()&&jQueryModalPost($("form#create-form")[0])}))}})},error:function(t){console.log(t)}})},addOrEditRoomTable:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,title:"Thêm/Chỉnh sửa phòng/bàn",html:t,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{validateForm.EditAndAddTableRoom(),$("#create-form .SelectListArea").select2({placeholder:{text:"Chọn giá trị"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){$("form#create-form").valid()&&jQueryModalPost($("form#create-form")[0])})),$("#IsCreateMuti").click((function(){$(".fromMutitable").toggleClass("d-none"),$(".fromMutitable").hasClass("d-none")?$(".fromMutitable").find("input").attr("type","hidden"):$(".fromMutitable").find("input").attr("type","text"),$(".fromOnetable").toggleClass("d-none"),$(".fromOnetable").hasClass("d-none")?$(".fromOnetable").find("input").attr("type","hidden"):$(".fromOnetable").find("input").attr("type","text")}))}})},error:function(t){console.log(t)}})},addOrEditCustomer:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({title:t.title,html:t.html,showClass:{popup:"popup-formcreate popup-formcreate-600"},footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{loadEventIcheck(),validateForm.EditAndAddCustomer(),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){jQueryModalPost($("form#create-form")[0])}))}})},error:function(t){console.log(t)}})},addOrEditTemplateInvoice:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({title:t.title,html:t.html,position:"center",showClass:{popup:"popup-formcreate"},customClass:{container:"eventpublisinvoice90p",footer:"footer-Swal"},footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{validateForm.EditAndAddTemplateInvoice(),$(".btn-continue").click((function(){Swal.close()})),CKEDITOR.replace("Template",{height:"500px"}),loadEventSelect2("#SelectListTypeTemplatePrint"),$("#SelectListTypeTemplatePrint").on("change",(function(t){$(this).valid()})),$(".btn-save").click((function(){tinymce.triggerSave(),$("form#create-form").valid()&&jQueryModalPost($("form#create-form")[0])}))}})},error:function(t){console.log(t)}})},addOrEditPaymentmethod:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                                popup-formleft-500\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate popup-formleft-500 animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,title:t.title,html:t.html,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{validateForm.EditAndAddPaymentMethod(),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){$("form#create-form").valid()&&jQueryModalPost($("form#create-form")[0])}))}})},error:function(t){console.log(t)}})},addOrEditUser:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                                popup-formleft-500\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate popup-formleft-500 animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,title:"Cập nhật nhân viên",html:t.html,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{validateFormUser(),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){$("form#FormValidate").valid()&&jQueryModalPost($("form#FormValidate")[0])}))}})},error:function(t){console.log(t)}})},editTableInOrder:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                              popup-formleft-500\n                              animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate popup-formleft-500 animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,title:"Thay đổi bàn",html:t.html,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$("#lstroomselect").append("<option selected></option>").select2({placeholder:{id:"",text:"Chọn bàn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$("input.icheck-table").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"}),$("input.mangve").on("ifChanged",(function(t){$(".tabtachdon").hasClass("d-none")||($(".tabtachdon").addClass("d-none"),$("#lstroomselect").select2("close"))})),$("input.bankhac").on("ifChanged",(function(t){$(".tabtachdon").hasClass("d-none")&&$(".tabtachdon").removeClass("d-none")})),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){loadeventPos.updateChangetableOrder()}))}})},error:function(t){console.log(t)}})},addOrEditRevenueExpenditure:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                                popup-formleft-500\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate popup-formleft-500 animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,title:t.title,html:t.html,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),loadFormatnumber(),validateForm.EditAndAddRevenueExpenditure(),$("#formObjectRevenueExpenditures").select2({dropdownParent:$("#create-form"),placeholder:"Chọn đối tượng nộp",allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}).on("change",(async function(t){var e=$(this).val();if(e==EnumTypeObjectRevenueExpenditure.KHACHHANG){let t=await axios.get("/Selling/Customer/GetJsonDataCustomer");html='<select name="CustomerName" id="CustomerName" class="form-control" style="width: 100%;" required\'>\n                                                <option selected></option>\n                                                </select>',$("#fomrCustomerName").html(html),$("#fomrCustomerName select").select2({dropdownParent:$("#create-form"),data:t.data,placeholder:{id:"",text:"Chọn khách hàng"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}})}else if(e==EnumTypeObjectRevenueExpenditure.DOITAC){let t=await axios.get("/Selling/Suppliers/GetJsonDataSuppliers");html='<select name="CustomerName" id="CustomerName" class="form-control" style="width: 100%;" required\'>\n                                                <option selected></option>\n                                                </select>',$("#fomrCustomerName").html(html),$("#fomrCustomerName select").select2({dropdownParent:$("#create-form"),data:t.data,placeholder:{id:"",text:"Chọn khách hàng"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}})}else e==EnumTypeObjectRevenueExpenditure.DOITUONGKHAC&&$("#fomrCustomerName").html('<input type="text" name="CustomerName" id="CustomerName" placeholder="Tên người nộp" class="form-control">')})),$("#formselectCategoryCevenues").select2({dropdownParent:$("#create-form"),placeholder:"Chọn loại phiếu "+t.typeNme,allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$("#formPaymentMethod").select2({dropdownParent:$("#create-form"),placeholder:"Chọn hình thức thanh toán",allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),loaddaterangepicker(!1),t.isEditCategoryCevenue&&$("#create-form").find("#Code").attr("readonly","readonly"),t.isEditRevenueExpenditure&&($("#create-form").find("#Amount").attr("readonly","readonly"),$("#create-form").find("#formselectCategoryCevenues").prop("disabled",!0),$("#create-form").find("#formObjectRevenueExpenditures").prop("disabled",!0),$("#create-form").find("#CustomerName").attr("readonly","readonly"),$("#create-form").find("#formPaymentMethod").prop("disabled",!0)),$(".btn-save").click((function(){$(".number3").each((function(){let t=$(this).val().replaceAll(",","");$(this).val(parseFloat(t))})),$("form#create-form").valid()&&jQueryModalPost($("form#create-form")[0])}))}})},error:function(t){console.log(t)}})}},loadeventProduct={loadEventbtnaction:function(){$(".btn-removeprouct").click((async function(){await Swal.fire({icon:"warning",title:"Bạn có chắc chắn muốn xóa các hóa đơn đã chọn không?",showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Đóng"}).then((t=>{if(t.isConfirmed){var e=new Array;dataTableOut.column(0).checkboxes.selected().each((function(t,a){e.push(parseInt(t))})),$.ajax({type:"POST",async:!0,url:"/Selling/Product/Delete",traditional:!0,dataType:"json",data:{lstid:e},success:function(t){t.isValid&&(dataTableOut.columns().checkboxes.deselectAll(!0),dataTableOut.ajax.reload(null,!1))},error:function(t){console.log(t)}})}}))})),$(".btn-stopbusiness").click((function(){var t=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(e,a){t.push(parseInt(e))})),0==t.length){let t="Vui lòng chọn sản phẩm";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}$.ajax({type:"POST",async:!0,url:"/Selling/Product/StopBusiness",traditional:!0,dataType:"json",data:{lstid:t},success:function(e){e.isValid&&(dataTableOut.ajax.reload(null,!1),title="Kết quả cập nhật",html="Cập nhật thành công: "+e.data+" sản phẩm",parseInt(e.data)!=t.length&&(html="<br/> Cập nhật thất bại "+(t.length-parseInt(e.data))+" sản phẩm"),Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:title,html:html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()}))}}))},error:function(t){console.log(t)}})})),$(".btn-unstopbusiness").click((function(){var t=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(e,a){t.push(parseInt(e))})),0==t.length){let t="Vui lòng chọn sản phẩm";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}$.ajax({type:"POST",async:!0,url:"/Selling/Product/UnStopBusiness",traditional:!0,dataType:"json",data:{lstid:t},success:function(e){e.isValid&&(dataTableOut.ajax.reload(null,!1),title="Kết quả cập nhật",html="Cập nhật thành công: "+e.data+" sản phẩm",parseInt(e.data)!=t.length&&(html="<br/> Cập nhật thất bại "+(t.length-parseInt(e.data))+" sản phẩm"),Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:title,html:html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()}))}}))},error:function(t){console.log(t)}})})),$(".btn-printbarcode").click((async function(){var t=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(e,a){t.push(parseInt(e))})),0==t.length){let t="Vui lòng chọn sản phẩm";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}$.ajax({type:"POST",async:!0,url:"/Selling/Product/PrintBarCode",traditional:!0,dataType:"json",data:{lstid:t},success:function(t){t.isValid&&printDiv(t.html)},error:function(t){console.log(t)}})}))}};function savefile(t,e){var a=e,n=t,i=document.createElement("a");if(i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),i.setAttribute("download",a),document.createEvent){var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!0),i.dispatchEvent(o)}else i.click()}function Base64ToBytes(t){for(var e=window.atob(t),a=new Uint8Array(e.length),n=0;n<e.length;n++)a[n]=e.charCodeAt(n);return a}var loadeventEinvoice={exportXML:function(t){$.ajax({type:"GET",url:t,success:function(t){t.isValid&&savefile(t.data,"data.xml")},error:function(){alert("Error occured!!")}})},exportPDF:function(t){$.ajax({type:"POST",url:t,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(t.isValid){var e=Base64ToBytes(t.base64),a=new Blob([e],{type:"application/octetstream"});if(!!document.documentMode)window.navigator.msSaveBlob(a,fileName);else{var n=window.URL||window.webkitURL;link=n.createObjectURL(a);var i=$("<a id='downloadfile' />");i.attr("download","invoice.pdf"),i.attr("href",link),$("body").append(i),i[0].click(),$("body").remove(i),$("body").find("a#downloadfile").remove()}}}})},printInvoice:function(t){$.ajax({type:"GET",async:!0,url:t,data:{},success:function(t){t.isValid&&printDiv(t.html)},error:function(t){console.log(t)}})},viewInvoice:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                              popup-lg\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate popup-lg animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,title:"Chi tiết hóa đơn điện tử",html:t.html,footer:"<button class='btn btn-warning btn-continue mr-3'><i class='fas fa-times mr-2'></i>Đóng</button><button type='button' class='btn btn-info btn-print mr-2'><i class='fas fa-print mr-2'></i> In hóa đơn</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$("#invoiceid").val();let e=$("#Status").val();EnumTypeEventInvoice.Cancel;let a="Bạn có chắc chắn muốn xóa đơn không?";"HUY_BO"==e&&(EnumTypeEventInvoice.Restore,a="Bạn có chắc chắn muốn khôi phục đơn không?",$(".btn-cancelinvoice").html("<i class='fas fa-undo mr-2'> Khôi phục hóa đơn")),$(".btn-continue").click((function(){Swal.close()})),console.log(t.fkey),$(".btn-print").click((function(){$.ajax({type:"GET",async:!0,url:"/Selling/EInvoice/PrintInvoice?id="+t.fkey,data:{},success:function(t){t.isValid&&(Swal.close(),printDiv(t.html))},error:function(t){console.log(t)}})}))}})},error:function(t){console.log(t)}})},loadSupllerEinvoice:function(t){$.ajax({global:!0,type:"GET",url:"/API/Handling/GetAllSupplierEInvoice",data:{idselectd:t},success:function(t){var e=JSON.parse(t);$("#supplereinvoice").select2({data:JSON.parse(t),placeholder:"Chọn giá trị",allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}).on("select2:select",(function(t){null!=t.params.data?$(".btn-sendCQT").data("typesignature",t.params.data.type):$(".btn-sendCQT").data("typesignature",-1)})).on("select2:clear",(function(t){toastrcus.error("Vui lòng chọn nhà cung cấp"),$(".btn-sendCQT").data("typesignature",-1)}));let a=null;e.map((function(t,e){0==e&&(a=t),t.selected&&(a=t)})),$("#supplereinvoice").trigger({type:"select2:select",params:{data:a}})}})},loadEventbtnaction:function(){$(".lstbtnaction .btn-printeinvoice:first").data("id",EnumTypePrinteInvoice.Printer),$(".lstbtnaction .btn-printeinvoice:last").data("id",EnumTypePrinteInvoice.PrintConvert),$(".btn-printeinvoice").click((function(){let t=$(this).data("id");var e=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(t,a){e.push(parseInt(t))})),e.length>20){let t="Số lượng hóa đơn của bạn chọn "+e.length+" quá nhiều, trình duyệt không thể tải để in được, vui lòng chọn ít hơn 20 hóa đơn";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}$.ajax({type:"GET",async:!0,url:"/Selling/EInvoice/PrintMutiEInvoice",traditional:!0,dataType:"json",data:{lstid:e,typePrint:t},success:function(t){t.isValid&&printDiv(t.html)},error:function(t){console.log(t)}})})),$(".btn-SyncEinvoice").click((function(){let t=parseInt($(this).data("type"))||0;var e=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(t,a){e.push(parseInt(t))})),0==e.length){let t="Vui lòng chọn hóa đơn";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}$.ajax({type:"GET",async:!0,url:"/Selling/EInvoice/SyncInvoice",traditional:!0,dataType:"json",data:{lstid:e,type:t},success:function(t){t.isValid&&(dataTableOut.ajax.reload(null,!1),dataTableOut.columns().checkboxes.deselectAll(!0),Swal.close(),title="Đồng bộ hóa đơn điện tử",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:title,html:t.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#accordionkqpubinv a.text-dark").click((function(){alert("ok")}))}}))},error:function(t){console.log(t)}})})),$(".btn-cancelinvoice").click((async function(){let t="Bạn có chắc chắn muốn hủy hóa đơn điện tử đã chọn không?";await Swal.fire({icon:"warning",title:t,showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Đóng"}).then((e=>{if(e.isConfirmed){var a=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(t,e){a.push(parseInt(t))})),0==a.length){let t="Vui lòng chọn hóa đơn";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}$.ajax({type:"GET",async:!0,url:"/Selling/EInvoice/CancelEInvoice",traditional:!0,dataType:"json",data:{lstid:a},success:function(e){e.isValid&&(dataTableOut.ajax.reload(null,!1),dataTableOut.columns().checkboxes.deselectAll(!0),Swal.close(),t="Hủy hóa đơn điện tử",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:t,html:e.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#accordionkqpubinv a.text-dark").click((function(){alert("ok")}))}}))},error:function(t){console.log(t)}})}}))})),$(".btn-sendCQT").click((async function(){let t=$(".btn-sendCQT").data("typesignature");if(-1==t){let t="Vui lòng chọn nhà cung cấp!";return Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'}),!1}parseInt(t)==ENumTypeSeri.TOKEN?(url="/Selling/EInvoice/GetHashToken",loadeventEinvoice.GetHashToken(url)):parseInt(t)==ENumTypeSeri.VNPTSmartCA?(url="/Selling/EInvoice/GetHashSmartCA",loadeventEinvoice.GetHashToken(url)):loadeventEinvoice.SendCQT(ENumTypeSeri.HSM)})),$(".btn-removeinvoice").click((async function(){let t="Bạn có chắc chắn muốn xóa hóa đơn tạo mới đã chọn không?";await Swal.fire({icon:"warning",title:t,showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Đóng"}).then((e=>{if(e.isConfirmed){var a=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(t,e){a.push(parseInt(t))})),0==a.length){let t="Vui lòng chọn hóa đơn";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}$.ajax({type:"GET",async:!0,url:"/Selling/EInvoice/RemoveEInvoice",traditional:!0,dataType:"json",data:{lstid:a},success:function(e){e.isValid&&(dataTableOut.ajax.reload(null,!1),dataTableOut.columns().checkboxes.deselectAll(!0),Swal.close(),t="Hủy hóa đơn điện tử",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:t,html:e.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#accordionkqpubinv a.text-dark").click((function(){alert("ok")}))}}))},error:function(t){console.log(t)}})}}))})),$(".btn-publishEinvoice").click((function(){var t=new Array;dataTableOut.column(0).checkboxes.selected().each((function(e,a){t.push(parseInt(e))})),$.ajax({type:"POST",url:"/Selling/EInvoice/PublishEInvoice",traditional:!0,dataType:"json",data:{lstid:t},success:function(t){t.isValid&&(dataTableOut.ajax.reload(null,!1),Swal.close(),title="Phát hành hóa đơn điện tử",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:title,html:t.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#accordionkqpubinv a.text-dark").click((function(){alert("ok")}))}}))},error:function(t){console.log(t)}})}))},loadDashboardEinvoice:function(){$.ajax({type:"GET",async:!0,url:"/Selling/EInvoice/DashboardEinvoice",data:{},success:function(t){t.isValid&&($(".dashboardEinvoice .SignedInv").html(t.data.signedInv),$(".dashboardEinvoice .UnSendInv").html(t.data.unSendInv),$(".dashboardEinvoice .SentInv").html(t.data.sentInv),$(".dashboardEinvoice .AcceptedInv").html(t.data.acceptedInv),$(".dashboardEinvoice .RejectedInv").html(t.data.rejectedInv))},error:function(t){console.log(t)}})},GetHashToken:async function(t){await Swal.fire({icon:"warning",title:"Bạn có chắc chắn muốn gửi hóa đơn đã chọn lên cơ quản thuế không?",showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Đóng"}).then((e=>{if(e.isConfirmed){var a=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(t,e){a.push(parseInt(t))})),0==a.length){let t="Vui lòng chọn hóa đơn";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}$.ajax({type:"GET",async:!0,url:t,traditional:!0,dataType:"json",data:{lstid:a},success:function(t){t.isValid&&(Swal.close(),loadingStart(),dataObject={},dataObject.type=TypeEventWebSocket.SignEInvoice,dataObject.hash=t.hash,sposvietplugin.sendConnectSocket(listport[0]).then((function(){loadingStart(),sposvietplugin.connectSignatureWebSocket(listport[0],JSON.stringify(dataObject)).then((function(t){"-1"==t?loadingStop():loadeventEinvoice.SendCQTToken(a,t)}))})))},error:function(t){console.log(t)}})}}))},SendCQTToken:function(t,e){$.ajax({type:"GET",async:!0,url:"/Selling/EInvoice/SendCQTToken",traditional:!0,dataType:"json",data:{lstid:t,data:e},success:function(t){loadingStop(),t.isValid&&(dataTableOut.ajax.reload(null,!1),Swal.close(),title="Kết quả gửi CQT",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:title,html:t.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#accordionkqpubinv a.text-dark").click((function(){alert("ok")}))}}))},error:function(t){console.log(t)}})},SendCQT:async function(t){let e="Bạn có chắc chắn muốn gửi hóa đơn đã chọn lên cơ quản thuế không?";await Swal.fire({icon:"warning",title:e,showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Đóng"}).then((t=>{if(t.isConfirmed){var a=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(t,e){a.push(parseInt(t))})),0==a.length){let t="Vui lòng chọn hóa đơn";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}$.ajax({type:"GET",async:!0,url:"/Selling/EInvoice/SendCQT",traditional:!0,dataType:"json",data:{lstid:a},success:function(t){t.isValid&&(dataTableOut.ajax.reload(null,!1),Swal.close(),e="Kết quả gửi CQT",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:e,html:t.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#accordionkqpubinv a.text-dark").click((function(){alert("ok")}))}}))},error:function(t){console.log(t)}})}}))}},eventInvocie={loadEventMutiaction:function(){$(".lstbtnaction .btn-publishinvoice").data("id",EnumTypeEventInvoice.PublishEInvoice),$(".lstbtnaction .btn-createinvoice").data("id",EnumTypeEventInvoice.CreateEInvoice),$(".lstbtnaction .btn-publishinvoice").click((async function(){let t=EnumTypeEventInvoice.PublishEInvoice;$.ajax({type:"GET",url:"/Selling/Invoice/SuppliersEInvoice",contentType:!1,processData:!1,success:function(e){e.isValid&&(footer="<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",e.nodata||(footer="<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Đã hiểu</button>"),Swal.fire({title:e.title,html:e.html,showClass:{popup:"popup-formcreate"},footer:footer,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#ManagerPatternEInvoices").select2({placeholder:{id:"",text:"Chọn mẫu số và ký hiệu hóa đơn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$("#Vatrate").select2({placeholder:{id:"",text:"Chọn thuế suất"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$(".btn-save").click((function(){let e=$(".selectSupplerInoice").find("#ManagerPatternEInvoices").val(),a=$(".selectSupplerInoice").find("#Vatrate").val();if(""!=e)if(""!=a){var n=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(t,e){n.push(parseInt(t))})),0!=n.length)$.ajax({type:"POST",url:"/Selling/Invoice/PublishEInvoice",traditional:!0,dataType:"json",data:{lstid:n,idPattern:e,Vatrate:a,TypeEventInvoice:t},success:function(t){dataTableOut.ajax.reload(null,!1),t.isValid&&(Swal.close(),title="Tạo mới và phát hành hóa đơn điện tử",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:title,html:t.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#accordionkqpubinv a.text-dark").click((function(){alert("ok")}))}}))},error:function(t){console.log(t)}});else{let t="Vui lòng chọn hóa đơn";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}}else toastrcus.error("Vui lòng chọn thuế suất");else toastrcus.error("Vui lòng chọn mẫu số ký hiệu hóa đơn")}))}}))},error:function(t){console.log(t)}})})),$(".lstbtnaction .btn-createinvoice").click((async function(){let t=EnumTypeEventInvoice.CreateEInvoice;$.ajax({type:"GET",url:"/Selling/Invoice/SuppliersEInvoice",contentType:!1,processData:!1,success:function(e){e.isValid?(footer="<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",e.nodata||(footer="<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Đã hiểu</button>"),Swal.fire({title:e.title,html:e.html,showClass:{popup:"popup-formcreate"},footer:footer,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#ManagerPatternEInvoices").select2({placeholder:{id:"",text:"Chọn mẫu số và ký hiệu hóa đơn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$("#Vatrate").select2({placeholder:{id:"",text:"Chọn mẫu số và ký hiệu hóa đơn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$(".btn-save").click((function(){let e=$(".selectSupplerInoice").find("#ManagerPatternEInvoices").val(),a=$(".selectSupplerInoice").find("#Vatrate").val();if(""!=e)if(""!=a){var n=new Array;if(dataTableOut.column(0).checkboxes.selected().each((function(t,e){n.push(parseInt(t))})),0!=n.length)$.ajax({type:"POST",url:"/Selling/Invoice/PublishEInvoice",traditional:!0,dataType:"json",data:{lstid:n,idPattern:e,Vatrate:a,TypeEventInvoice:t},success:function(t){dataTableOut.ajax.reload(null,!1),t.isValid&&(Swal.close(),title="Tạo mới và phát hành hóa đơn điện tử",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:title,html:t.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#accordionkqpubinv a.text-dark").click((function(){alert("ok")}))}}))},error:function(t){console.log(t)}});else{let t="Vui lòng chọn hóa đơn";Swal.fire({icon:"error",title:"Thông báo",html:t,showCloseButton:!0,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đã hiểu'})}}else toastrcus.error("Vui lòng chọn thuế suất");else toastrcus.error("Vui lòng chọn mẫu số ký hiệu hóa đơn")}))}})):Swal.close()},error:function(t){console.log(t)}})})),$(".btn-cancelinvoice").click((async function(){let t="Bạn có chắc chắn muốn hủy hóa đơn không?";var{value:e}=await Swal.fire({icon:"warning",title:t,showCancelButton:!0,confirmButtonText:"Đồng ý",input:"text",inputPlaceholder:"Vui lòng nhập lý do",cancelButtonText:"Đóng",inputValidator:t=>{if(!t)return"Vui lòng nhập lý do!"}}).then((async e=>{if(e.isConfirmed){var a=new Array;dataTableOut.column(0).checkboxes.selected().each((function(t,e){a.push(parseInt(t))}));var n=e.value;await Swal.fire({icon:"warning",title:"Bạn có muốn hủy phiếu thu liên quan không!",showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Không, chỉ hủy hóa đơn"}).then((e=>{let i=!1;e.isConfirmed&&(i=!0),$.ajax({type:"POST",url:"/Selling/Invoice/CancelInvoiceList",data:{lstid:a,Note:n,IsDeletePT:i},success:function(e){e.isValid&&(dataTableOut.ajax.reload(null,!1),Swal.close(),t="Hủy hóa đơn",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:t,html:e.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#accordionkqpubinv a.text-dark").click((function(){alert("ok")}))}}))},error:function(t){console.log(t)}})}))}}))})),$.ajax({type:"GET",url:"/Selling/ConfigSaleParameters/GetConfigSell?key="+getObjectKey(EnumConfigParameters,EnumConfigParameters.DELETEINVOICENOPAYMENT),success:function(t){if(t.isValid&&"true"==t.data.value){let e=0,a=getObjectKey(EnumConfigParameters,EnumConfigParameters.ACCEPTPAYMENTDELETEINVOICE);t.data.configSystems.forEach((function(t,n){a.toLocaleUpperCase()==t.key.toLocaleUpperCase()&&"false"==t.value&&(e=1)})),html='<button type="button" disabled data-removereport="'+e+'" class="btn btn-danger btn-deleteInvoice" data-toggle="tooltip" data-placement="top" title="Tính năng xóa hóa đơn khỏi hệ thống">Xóa hóa đơn</button>',$(".btn-cancelinvoice").after(html),$(".btn-deleteInvoice").click((async function(){let t="Bạn có chắc chắn muốn xóa hóa đơn khỏi hệ thống không?",a="Bạn đang cấu hình <b class='text-primary'> ghi nhận doanh thu </b> cho các hóa đơn này!";1==e&&(a="Lưu ý: bạn đang cấu hình <b class='text-danger'> xóa hóa đơn nhưng không ghi nhận doanh thu</b>, bạn có chắc chắn muốn tiếp tục không?");var{value:n}=await Swal.fire({icon:"warning",title:t,html:a,showCancelButton:!0,confirmButtonText:"Đồng ý",input:"text",inputPlaceholder:"Bạn hãy cho biết lý do xóa hóa đơn?",cancelButtonText:"Đóng",inputValidator:t=>{if(!t)return"Vui lòng nhập lý do!"}}).then((a=>{if(a.isConfirmed){var n=new Array;dataTableOut.column(0).checkboxes.selected().each((function(t,e){n.push(parseInt(t))})),$.ajax({type:"POST",url:"/Selling/Invoice/DeleteInvoiceList",data:{lstid:n,Note:a.value,IsDelete:1==e},success:function(e){e.isValid&&(dataTableOut.ajax.reload(null,!1),Swal.close(),t="Hủy hóa đơn",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:t,html:e.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()}))}}))},error:function(t){console.log(t)}})}}))}))}},error:function(){alert("Error occured!!")}}),$.ajax({type:"GET",url:"/Selling/ConfigSaleParameters/GetConfigSell?key="+getObjectKey(EnumConfigParameters,EnumConfigParameters.PUBLISHMERGEINVOICE),success:function(t){if(t.isValid&&"true"==t.data.value){let e=0,a=getObjectKey(EnumConfigParameters,EnumConfigParameters.DELETEIPUBLISHMERGEINVOICEAFTER);t.data.configSystems.forEach((function(t,n){a.toLocaleUpperCase()==t.key.toLocaleUpperCase()&&"true"==t.value&&(e=1)})),html='<a class="dropdown-item btn-publishinvoicemerge" data-type="0" href="javascript:void(0)" data-toggle="tooltip" data-placement="top" title="Ghi chú: lựa chọn hóa đơn để phát hành gộp, nhiều hóa đơn bán hàng tương ứng một hóa đơn điện tử"><i class="fas fa-plus mr-2"></i> Phát hành gộp hóa đơn điện tử</a>',$(".lst-action-buttonpublishinvoice .btn-publishinvoice").after(html),$(".btn-publishinvoicemerge").click((async function(){var t=new Array;dataTableOut.column(0).checkboxes.selected().each((function(e,a){t.push(parseInt(e))})),htmlfooter="<button class='btn btn-primary btn-continue mr-3'><i class='fas fa-power-off mr-2'></i>Hủy bỏ giao dịch</button><button class='btn btn-save btn-success mr-2'><i class='fas fa-save mr-2'></i>Phát hành không xóa đơn gộp</button><button class='btn btn-saveAndDelete btn-success'><i class='fas fa-share mr-2'></i>Phát hành và xóa đơn gộp</button>",1==e&&(htmlfooter="<button class='btn btn-primary btn-continue mr-3'><i class='fas fa-power-off mr-2'></i>Hủy bỏ giao dịch</button><button class='btn btn-save btn-success mr-2'><i class='fas fa-save mr-2'></i>Phát hành và xóa đơn gộp</button>"),$.ajax({type:"GET",traditional:!0,url:"/Selling/Invoice/PublishEInvoiceMerge",data:{lstid:t,IsDelete:1==e},success:function(e){e.isValid&&(dataTableOut.ajax.reload(null,!1),Swal.close(),title="Phát hành hóa đơn điện tử gộp từ nhiều hóa đơn bán hàng ("+t.length+" hóa đơn)",Swal.fire({position:"center",showClass:{popup:"popup-formcreate"},customClass:{container:"eventpublisinvoice90p",footer:"footer-Swal"},showCloseButton:!0,title:title,html:e.html,footer:htmlfooter,allowOutsideClick:!1,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{evetnFormatnumber3(),evetnFormatTextnumber3decimal(),eventInvocie.eventChanegVATrate(),$("#Vatrate").trigger("change"),$("#ManagerPatternEInvoices").select2({placeholder:{id:"",text:"Chọn mẫu số và ký hiệu hóa đơn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$("#Vatrate").select2({placeholder:{id:"",text:"Chọn thuế suất"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),loaddataSelect2("/API/Handling/GetAllPaymentMethod",".PaymentMethod",e.idPayment,"Chọn hình thức thanh toán"),loadEventIcheck(),eventInvocie.eventAutocomplete(),eventInvocie.eventChangeKhachle(),$('[data-toggle="tooltip"]').tooltip(),validateForm.AddPublishInvoiceMerge(),$("#create-formProduct .PaymentMethod").on("change",(function(t){$(this).valid()})),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){if($("#IsDelete").val($("#IsDelete").data("value")),eventInvocie.eventSaveInvoice(),$("form#create-formProduct").valid()){if(""==$("#CusName").val().trim()&&""==$("#Buyer").val().trim()&&0==$("#IsRetailCustomer").prop("checked"))return void toastrcus.error("Tên đơn vị mua hàng hoặc tên người hàng phải nhập một trong hai.");eventInvocie.savePublishEInvoiceMeger()}})),$(".btn-saveAndDelete").click((function(){if($("#IsDelete").val("true"),eventInvocie.eventSaveInvoice(),$("form#create-formProduct").valid()){if(""==$("#CusName").val().trim()&&""==$("#Buyer").val().trim()&&0==$("#IsRetailCustomer").prop("checked"))return void toastrcus.error("Tên đơn vị mua hàng hoặc tên người hàng phải nhập một trong hai.");eventInvocie.savePublishEInvoiceMeger()}}))}}))},error:function(t){console.log(t)}})}))}},error:function(){alert("Error occured!!")}})},savePublishEInvoiceMeger:function(){try{for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement(),$("#"+instance).val(CKEDITOR.instances[instance].getData());return form=$("#create-formProduct")[0],$.ajax({type:"POST",url:form.action,data:new FormData(form),contentType:!1,processData:!1,success:function(t){t.isValid&&(dataTableOut.ajax.reload(null,!1),dataTableOut.columns().checkboxes.deselectAll(!0),$('[data-toggle="tooltip"]').tooltip(),title="Phát hành gộp hóa đơn",Swal.fire({position:"center",showClass:{popup:"popup-formcreate eventpublisinvoice"},showCloseButton:!0,title:title,html:t.html,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()}))}}))},error:function(t){console.log(t)}}),!1}catch(t){console.log(t)}},eventAutocomplete:function(){$("#CusName").blur((function(){$("#parentautocomplete").css({height:"0",top:"0","z-index":"0"})})),$("#Buyer").blur((function(){$("#parentautocomplete").css({height:"0",top:"0","z-index":"0"})})),$("#CusCode").blur((function(){$("#parentautocomplete").css({height:"0",top:"0","z-index":"0"})})),$("#Taxcode").blur((function(){$("#parentautocomplete").css({height:"0",top:"0","z-index":"0"})})),eventInvocie.Autocompletedata($("#CusName"),AutocompleteTypeCustomer.CUSNAME),eventInvocie.Autocompletedata($("#Buyer"),AutocompleteTypeCustomer.BUYER),eventInvocie.Autocompletedata($("#CusCode"),AutocompleteTypeCustomer.CUSCODE),eventInvocie.Autocompletedata($("#Taxcode"),AutocompleteTypeCustomer.TAXCODE)},Autocompletedata:function(t,e){$(t).autocomplete({appendTo:"#parentautocomplete",autoFocus:!0,minLength:3,delay:0,source:function(t,a){$.ajax({global:!1,url:"/Selling/Customer/SearchCustomerPos",type:"GET",dataType:"json",data:{text:t.term,type:e},success:function(n){return a($.map(n,(function(a){let n="",i="",o="";switch(e){case AutocompleteTypeCustomer.BUYER:i=a.buyer,""!=a.buyer&&null!=a.buyer&&(n=__highlight(a.buyer,t.term),o+="<span>"+n+"</span>",""!=a.name&&null!=a.name&&(o+="<span>"+a.name+"</span>"));break;case AutocompleteTypeCustomer.CUSNAME:i=a.name,""!=a.name&&null!=a.name&&(n=__highlight(a.name,t.term),o+="<span>"+n+"</span>",""!=a.buyer&&null!=a.buyer&&(o+="<span class='code'>Tên KH: "+a.buyer+"</span>"));break;case AutocompleteTypeCustomer.CUSCODE:i=a.code,n=__highlight(a.code,t.term),o+="<span class='code'>Mã KH: "+n+" </span>",""!=a.name&&null!=a.name&&(o+="<span>"+a.name+"</span>"),""!=a.buyer&&null!=a.buyer&&(o+="<span>"+a.buyer+"</span>");break;case AutocompleteTypeCustomer.TAXCODE:i=a.taxcode,n=__highlight(a.taxcode,t.term),o+="<span>Mã số thuế: "+n+" </span>",""!=a.name&&null!=a.name&&(o+="<span>"+a.name+"</span>"),""!=a.buyer&&null!=a.buyer&&(o+="<span>"+a.buyer+"</span>")}return""!=a.address&&null!=a.address&&(o+="Địa chỉ: "+a.address+" <br/>"),e!=AutocompleteTypeCustomer.TAXCODE&&""!=a.taxcode&&null!=a.taxcode&&(o+=" Mã số thuế: "+a.taxcode+" <br/>"),e!=AutocompleteTypeCustomer.CUSCODE&&(o+="Mã KH: "+a.code+" <br/>"),""!=a.phoneNumber&&null!=a.phoneNumber&&(o+=" SĐT: "+a.phoneNumber),{label:"<a href='javascript:void(0)'><div class='search-auto'><div class='img'><img src='../"+a.img+"'></div><div class='tk_name'>"+o+"</div></div></a>",value:i,name:a.name,buyer:a.buyer,code:a.code,address:a.address,taxcode:a.taxcode,phoneNumber:a.phoneNumber,email:a.email,cccd:a.cccd,cusBankNo:a.cusBankNo,cusBankName:a.cusBankName,idCus:a.id}}))),{label:t.term,value:t.term}}})},html:!0,select:function(t,e){eventInvocie.eventResetinput(),$(this).val(""),$("#CusName").val(e.item.name),$("#Address").val(e.item.address),$("#Buyer").val(e.item.buyer),$("#Taxcode").val(e.item.taxcode),$("#CCCD").val(e.item.cccd),$("#PhoneNumber").val(e.item.phoneNumber),$("#Email").val(e.item.email),$("#CusCode").val(e.item.code),$("#CusBankNo").val(e.item.cusBankNo),$("#CusBankName").val(e.item.cusBankName)}}).focus((function(){$("#parentautocomplete").css({height:"calc(100vh - 100px)",top:"52px","z-index":"5"}),$(this).autocomplete("search"),$(this).select()}))},eventResetinput:function(){$("#CusName").val(""),$("#Address").val(""),$("#Buyer").val(""),$("#Taxcode").val(""),$("#CCCD").val(""),$("#PhoneNumber").val(""),$("#Email").val(""),$("#CusCode").val(""),$("#CusBankNo").val(""),$("#CusBankName").val("")},eventChangeKhachle:function(){$("input#IsRetailCustomer").on("ifChanged",(function(t){1==$(this).prop("checked")?($("#IsCreateCustomer").iCheck("uncheck"),$("#IsCreateCustomer").iCheck("disable"),$(".form-publishmegerinvoice").find("input").attr("disabled",!0),$(".form-publishmegerinvoice").find("input").attr("readonly",!0)):0==$(this).prop("checked")&&($("#IsCreateCustomer").iCheck("enable"),$(".form-publishmegerinvoice").find("input").removeAttr("disabled"),$(".form-publishmegerinvoice").find("input").removeAttr("readonly"))})),$("input#IsCreateCustomer").on("ifChanged",(function(t){if(1==$(this).prop("checked")&&$("#IsRetailCustomer").prop("checked"))return toastrcus.error("Không thể thêm khách hàng khi bạn đã chọn là khách lẻ"),!1}))},eventSaveInvoice:function(){var t=[],e=[];return $(".number3").each((function(t,e){let a=parseInt($(this).val().replaceAll(",",""))||0;$(this).val(a)})),$(".codeinvoiceold").each((function(t,a){let n=$(a).data("invoice");if(""==n)return alert("Các hóa đơn liên quan đã không còn tồn tại!"),Swal.close(),!1;e.push(n)})),0==e.length?(alert("Các hóa đơn liên quan đã không còn tồn tại!"),Swal.close(),!1):($("#JsonInvoiceOld").val(JSON.stringify(e)),$("#tableinvoicemerge").find("tbody").find("tr").each((function(e,a){let n=parseInt($(this).find(".name").data("typeProductCategory"))||EnumTypeProductCategory.PRODUCT,i=$(this).find(".code").text(),o=$(this).find(".name").text(),l=$(this).find(".unit").text(),r=$(this).find(".price").text().replaceAll(",","")||0,s=$(this).find(".quantity").text().replaceAll(",","")||0,d=$(this).find(".total").text().replaceAll(",","")||0;var c={};if(c.TypeProductCategory=n,c.Code=i,c.Unit=l,c.Price=parseFloat(r),c.Total=parseFloat(d),c.Quantity=parseFloat(s),""==i)return alert("Sản phẩm: "+o+" không hợp lệ!"),Swal.close(),!1;t.push(c)})),0==t.length?(alert("Không tìm thấy sản phẩm, vui lòng thực hiện lại!"),Swal.close(),!1):void $("#JsonProduct").val(JSON.stringify(t)))},eventChanegVATrate:function(){$("#Vatrate").change((function(){let t=parseFloat($(".Total").val().replaceAll(",",""))||0,e=parseFloat($(".DiscountAmount").val().replaceAll(",",""))||0;e>0&&(t-=e);let a=parseInt($(this).val())||0,n=Math.round(t*(a/100)),i=t+n;$(".VATAmount").val(n.format0VND(0,3)),$(".Amount").val(i.format0VND(0,3))})),$(".Total").keyup((function(){$("#Vatrate").trigger("change")})),$(".DiscountAmount").keyup((function(){$("#Vatrate").trigger("change")})),$(".VATAmount").keyup((function(){let t=(parseFloat($(".Total").val().replaceAll(",",""))||0)-(parseFloat($(".DiscountAmount").val().replaceAll(",",""))||0)+(parseFloat($(this).val().replaceAll(",",""))||0);$(".Amount").val(t.format0VND(0,3))}))},CancelInvoice:async function(t,e){let a="Bạn có chắc chắn muốn hủy hóa đơn không?";e==EnumTypeEventInvoice.Restore&&(a="Bạn có chắc chắn muốn khôi phục đơn không?");const{value:n}=await Swal.fire({icon:"warning",title:a,showCancelButton:!0,confirmButtonText:"Đồng ý",input:"text",inputPlaceholder:"Vui lòng nhập lý do",cancelButtonText:"Đóng",inputValidator:t=>{if(!t)return"Vui lòng nhập lý do!"}}).then((a=>{a.isConfirmed&&$.ajax({type:"POST",url:"/Selling/Invoice/CancelInvoice?secret="+t,data:{TypeEventInvoice:e,Note:a.value},success:function(t){t.isValid&&dataTableOut.ajax.reload(null,!1)},error:function(t){console.log(t)}})}))},DeleteIsMerge:async function(t){const{value:e}=await Swal.fire({icon:"warning",title:"Bạn có chắc chắn muốn xóa các hóa đơn đã gộp cho hóa đơn này không?",showCancelButton:!0,confirmButtonText:"Đồng ý xóa",cancelButtonText:"Hủy bỏ"}).then((e=>{e.isConfirmed&&$.ajax({type:"POST",url:"/Selling/Invoice/DeleteIsMerge?secret="+t,data:{},success:function(t){t.isValid&&dataTableOut.ajax.reload(null,!1)},error:function(t){console.log(t)}})}))},printInvoice:function(t){$.ajax({type:"GET",async:!0,url:t,data:{},success:function(t){t.isValid&&printDiv(t.html)},error:function(t){console.log(t)}})},viewInvoice:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                              popup-lg\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate popup-lg animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,title:"Thêm/Chỉnh sửa phòng/bàn",html:t,footer:"<button class='btn btn-warning btn-continue mr-3'><i class='fas fa-times mr-2'></i>Đóng</button><button type='button' class='btn btn-info btn-print mr-2'><i class='fas fa-print mr-2'></i> In hóa đơn</button><button type='button' class='btn btn-danger btn-cancelinvoice'><i class='fas fa-power-off mr-2'></i>Hủy đơn</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{evetnFormatTextnumber3(!0);var t=$("#invoiceid").val();let e=$("#Status").val();var a=EnumTypeEventInvoice.Cancel;let n="Bạn có chắc chắn muốn xóa đơn không?";"HUY_BO"==e&&(a=EnumTypeEventInvoice.Restore,n="Bạn có chắc chắn muốn khôi phục đơn không?",$(".btn-cancelinvoice").html("<i class='fas fa-undo mr-2'> Khôi phục hóa đơn")),$(".btn-continue").click((function(){Swal.close()})),$(".btn-cancelinvoice").click((async function(){eventInvocie.CancelInvoice(t,a)})),$(".btn-print").click((function(){$.ajax({type:"GET",async:!0,url:"/Selling/Invoice/PrintInvoice?secret="+t,data:{},success:function(t){t.isValid&&(Swal.close(),printDiv(t.html))},error:function(t){console.log(t)}})}))}})},error:function(t){console.log(t)}})}},commonEventpost={addOrEditPostOnePgae:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({title:t.title,html:t.html,showClass:{popup:"popup-formcreate-post"},footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{loadEventadmin.eventShowformAddPostOne()}})},error:function(t){console.log(t)}})}},loadcentChitkent={loadeventacceptAllnotify:function(){$("#next-allneworder").click((function(){let t=[];$("#dataChitkenNew .tab-pane.active .tab-Priorities li").map((function(){t.push($(this).data("id"))})),$.ajax({type:"POST",url:"/Selling/PosKitchen/NotifyOrderOrocessed",data:{TypeNotifyKitchenOrder:_TypeNotifyKitchenOrder.Orocessed,UpdateFull:!0,Status:StatusKitchenOrder.MOI,ListIdChitken:t},dataType:"json",success:function(t){t.isValid},error:function(t){console.log(t)}})}))},loadeventacceptAllreadynotify:function(){$("#next-allreadyorder").click((function(){let t=[];$("#dataOrderReady .tab-pane.active .tab-Priorities li").map((function(){t.push($(this).data("id"))})),$.ajax({type:"POST",url:"/Selling/PosKitchen/NotifyOrderOrocessed",data:{TypeNotifyKitchenOrder:_TypeNotifyKitchenOrder.Orocessed,UpdateFull:!0,Status:StatusKitchenOrder.READY,ListIdChitken:t},dataType:"json",success:function(t){t.isValid},error:function(t){console.log(t)}})}))},loadeventtimeago:function(){var t;$("time.timeago").each((function(e,a){t=moment($(a).html(),"DD-MM-YYYY hh:mm:ss"),$(a).attr("datetime",t.toISOString())})),$("time.timeago").timeago()},loadDataFoodReady:async function(t=!0){var e=await axios.get("/Selling/PosKitchen/DataFoodReady");if(e.data.isValid){$("#dataOrderReady").html(e.data.data);let a=$(".tab-notifychitkenready a.active").attr("href");$("#dataOrderReady").find(".tab-pane").removeClass("active"),$("#dataOrderReady").find(a).addClass("active"),loadcentChitkent.loadeventtimeago(),t&&(loadcentChitkent.loadeventhideshoworderrooom($("#dataOrderReady")),loadcentChitkent.loadeventnextorder($("#dataOrderReady")),loadcentChitkent.loadeventacceptAllreadynotify())}},loadDataFoodNew:async function(t=!0){$.ajax({type:"GET",global:!1,url:"/Selling/PosKitchen/DataFoodNew",dataType:"json",success:function(e){if(e.isValid){$("#dataChitkenNew").html(e.data);let a=$(".tab-notifychitk a.active").attr("href");$("#dataChitkenNew").find(".tab-pane").removeClass("active"),$("#dataChitkenNew").find(a).addClass("active"),loadcentChitkent.loadeventtimeago(),t&&(loadcentChitkent.loadeventhideshoworderrooom($("#dataChitkenNew")),loadcentChitkent.loadeventnextorder($("#dataChitkenNew")),loadcentChitkent.loadeventacceptAllnotify())}},error:function(t){console.log(t)}})},loadeventhideshoworderrooom:function(t){$(t).find(".tab-viewtable").find(".table-name").click((function(){$(this).children("i").hasClass("fa-minus")?($(this).children("i").removeClass("fa-minus"),$(this).children("i").addClass("fa-plus")):($(this).children("i").removeClass("fa-plus"),$(this).children("i").addClass("fa-minus")),$(this).parents("li").children("ul").toggleClass("d-none")})),$(t).find(" .item-data").map((function(){let t=$(this).data("id");""!=t&&($(this).removeAttr("data-id"),$(this).data("id",t))}))},loadeventnextorder:function(t){$(t).find(".tab-pane").find(".lst-action").find("button.btn-next").click((function(){$(this).attr("disabled","disabled");let t=$(this).parent().parent().data("id"),e=$(this).parent().parent().data("id"),a=$(this).parent().parent("li").hasClass("item-ready")?StatusKitchenOrder.DONE:StatusKitchenOrder.READY;$(this).parents(".tab-pane").hasClass("viewfood")?(t="",loadcentChitkent.eventNotifyOrderOrocessed(t,true,"",e,_TypeNotifyKitchenOrder.UPDATEBYFOOD,a)):loadcentChitkent.eventNotifyOrderOrocessed(t,true,"",e,_TypeNotifyKitchenOrder.Orocessed,a),$(this).removeAttr("disabled")})),$(t).find(".tab-pane").find(".lst-action").find("button.btn-nextAll").click((function(){$(this).attr("disabled","disabled");let t=$(this).parent().parent().data("id"),e=$(this).parent().parent().data("order"),a=!1,n=$(this).parents("li.item-product").data("id"),i=$(this).parent().parent("li").hasClass("item-ready")?StatusKitchenOrder.DONE:StatusKitchenOrder.READY;$(this).parents(".tab-pane").hasClass("viewfood")?(t="",loadcentChitkent.eventNotifyOrderOrocessed(t,a,"",n,_TypeNotifyKitchenOrder.UPDATEBYFOOD,i)):void 0!==e?loadcentChitkent.eventNotifyOrderOrocessed("",a,e,n,_TypeNotifyKitchenOrder.UPDATEBYTABLE,i):loadcentChitkent.eventNotifyOrderOrocessed(t,a,e,n,_TypeNotifyKitchenOrder.Orocessed,i),$(this).removeAttr("disabled")})),$(t).find(".tab-pane").find(".lst-action").find("button.btn-delete").click((function(){$(this).attr("disabled","disabled");let t=$(this).parent().parent().data("id");loadcentChitkent.eventDeleteKitchen(t,_TypeNotifyKitchenOrder.DELETE),$(this).removeAttr("disabled")}))},eventDeleteKitchen:function(t,e){$.ajax({type:"POST",url:"/Selling/PosKitchen/DeleteKitchen",dataType:"json",global:!1,async:!1,data:{TypeNotifyKitchenOrder:e,idChitken:t},success:function(t){t.isValid},error:function(t){console.log(t)}})},eventNotifyOrderOrocessed:function(t,e,a,n,i,o){$.ajax({type:"POST",url:"/Selling/PosKitchen/NotifyOrderOrocessed",dataType:"json",global:!1,async:!1,data:{TypeNotifyKitchenOrder:i,Status:o,UpdateOne:e,IdOrder:a,IdProduct:n,idChitken:t},success:function(t){t.isValid},error:function(t){console.log(t)}})}},thuchipos={loadEventCategoryTabThuChi:function(){$("#tabthuchi li a").click((function(){if($(this).hasClass("active"))return;let t=$(this).data("id");thuchipos.loadDataCategoryTabThuChi(t)}))},loadDataCategoryTabThuChi:function(t){url="/Selling/CategoryCevenue/CreateReceipts",t==TypeThuChi.CHI&&(url="/Selling/CategoryCevenue/CreatePayment"),html=' <div class="card">\n                        <div class="col-sm-12 pt-2">\n                            <a onclick="eventCreate.addOrEditRevenueExpenditure(\''+url+'\')" class="btn bg-success text-white">\n                                <i class="fas fa-plus-circle"> </i> Thêm mới\n                            </a>\n                            <button class="ladda-button mr-2 btn btn-primary" id="reload" data-style="expand-left">\n                                <span class="ladda-label"><i class="fa fas fa-bolt"></i>  Reload</span>\n                                <span class="ladda-spinner"></span>\n                            </button>\n                        </div>\n                        <div id="viewAll" class="card-body">\n                            <table class="table table-bordered table-striped" style=" " id="dataTable">\n                                <thead>\n                                    <tr>\n                                        <th>Mã nguồn</th>\n                                        <th>Tên nguồn</th>\n                                        <th>Mô tả</th>\n                                        <th>Ngày tạo</th>\n                                        <th>Người tạo</th>\n                                        <th>Hành động</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>',$(".tab-datacontent").html(html),dataTableOut=$("#dataTable").DataTable({responsive:!0,processing:!0,stateSave:!0,pagingType:"full_numbers",serverSide:!0,filter:!0,rowId:"id",orderMulti:!1,ordering:!1,language:{info:"Hiển thị _START_ đến _END_ dòng của tổng _TOTAL_ dòng",infoEmpty:"Hiển thị 0 đến 0 dòng của tổng 0 dòng",zeroRecords:"Không tìm thấy dữ liệu nào",emptyTable:"Không có dữ liệu",search:"Tìm kiếm:",processing:"Đang xử lý...",lengthMenu:"Hiển thị _MENU_ dòng",loadingRecords:"Vui lòng chờ...",paginate:{first:"Đầu tiên",last:"Cuối cùng",next:"Tiếp theo",previous:"Về trước"}},pageLength:10,lengthMenu:[[10,25,50,100,200,-1],[10,25,50,100,200,"All"]],buttons:[{text:"Reload",action:function(t,e,a,n){dataTableOut.ajax.reload()}}],columnDefs:[{responsivePriority:4,targets:[-1,0]},{targets:[1,2,3,4,-1],className:"text-center"},{searchable:!1,orderable:!1,targets:[-1,0]},{width:"100px",targets:-1}],ajax:{url:"/Selling/CategoryCevenue/LoadAll",type:"POST",datatype:"json",data:{Name:function(){return $("#Code").val().trim()},Code:function(){return $("#Code").val().trim()},Type:function(){return t}}},columns:[{data:"code",name:"code",autoWidth:!0},{data:"name",name:"name",autoWidth:!0},{data:"content",name:"content",autoWidth:!0},{data:"createdOn",name:"createdOn",autoWidth:!0,render:function(t,e,a,n){return null!=a.createdOn?moment(a.createdOn).format("DD/MM/YYYY HH:MM:SS"):""}},{data:"createdBy",name:"createdBy",autoWidth:!0},{data:null,name:"",render:function(t,e,a,n){return'<div class="btn-group dropleft"><button class="btn btn-light btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button><div class="dropdown-menu"><a class="dropdown-item" href="javascript:void(0)" onclick="eventCreate.addOrEditRevenueExpenditure(\'/Selling/CategoryCevenue/edit?secret='+a.idString+'\')"><i class="fas fa-edit mr-2"></i> Sửa</a></a><form id="form_delete_'+a.id+'" action="/Selling/CategoryCevenue/Delete?secret='+a.idString+'"  asp-controller="RevenueExpenditure" asp-area="Selling" method="post" asp-action="Delete" onsubmit="return jQueryModalDelete(this)" class="d-inline"><a  class="dropdown-item"  href="javascript:$(\'#form_delete_'+a.id+'\').submit();"><i class="fas fa-trash-alt mr-2"></i> Xóa</a></form></div></div>'}}]}),$("#reload").on("click",(function(){dataTableOut.ajax.reload(null,!1)})),$("input").keyup((function(t){13==t.keyCode&&dataTableOut.ajax.reload(null,!1)}))},loadEventRevenueExpenditure:function(){$("#tabthuchi li a").click((function(){if($(this).hasClass("active"))return;let t=$(this).data("id");thuchipos.loadDataRevenueExpenditure(t)}))},loadEventQuyDauKy:function(){$.ajax({url:"/Selling/RevenueExpenditure/GetDashboard",type:"GET",dataType:"json",data:{RangesDate:function(){return""==$("#rangesDate").val().trim()?moment(new Date).format("DD/MM/YYYY")+"-"+moment(new Date).format("DD/MM/YYYY"):$("#rangesDate").val().trim()}},success:function(t){t.isValid&&($(".dashboardRevenueexpenditure ul li:nth-child(1)").find(".content").children("span").html(t.data.beginningFund.format0VND(0,3)),$(".dashboardRevenueexpenditure ul li:nth-child(2)").find(".content").children("span").html(t.data.totalRevenue.format0VND(0,3)),$(".dashboardRevenueexpenditure ul li:nth-child(3)").find(".content").children("span").html(t.data.totalExpenditure.format0VND(0,3)),$(".dashboardRevenueexpenditure ul li:nth-child(4)").find(".content").children("span").html(t.data.fundsBalance.format0VND(0,3)))}})},loadDataRevenueExpenditure:function(t){url="/Selling/RevenueExpenditure/CreateReceipts",t==TypeThuChi.CHI&&(url="/Selling/RevenueExpenditure/CreatePayment"),html=' <div class="card">\n                        <div class="col-sm-12 pt-2">\n                            <a onclick="eventCreate.addOrEditRevenueExpenditure(\''+url+'\')" class="btn bg-success text-white">\n                                <i class="fas fa-plus-circle"> </i> Thêm mới\n                            </a>\n                            <button class="ladda-button mr-2 btn btn-primary" id="reload" data-style="expand-left">\n                                <span class="ladda-label"><i class="fa fas fa-bolt"></i>  Reload</span>\n                                <span class="ladda-spinner"></span>\n                            </button>\n                        </div>\n                        <div id="viewAll" class="card-body">\n                            <table class="table table-bordered table-striped" style=" " id="dataTable">\n                                <thead>\n                                    <tr>\n                                        <th>Ngày tạo</th>\n                                        <th>Mã phiếu</th>\n                                        <th>Loại phiếu</th>\n                                        \n                                        <th>Số tiền</th>\n                                        <th>Hình thức thanh toán</th>\n                                        <th>Người nộp</th>\n                                        <th>Mã chứng từ</th>\n                                        <th>Trạng thái</th>\n                                        <th>Hành động</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>',$(".tab-datacontent").html(html),dataTableOut=$("#dataTable").DataTable({responsive:!0,processing:!0,stateSave:!0,pagingType:"full_numbers",serverSide:!0,filter:!0,rowId:"id",orderMulti:!1,ordering:!1,language:{info:"Hiển thị _START_ đến _END_ dòng của tổng _TOTAL_ dòng",infoEmpty:"Hiển thị 0 đến 0 dòng của tổng 0 dòng",zeroRecords:"Không tìm thấy dữ liệu nào",emptyTable:"Không có dữ liệu",search:"Tìm kiếm:",processing:"Đang xử lý...",lengthMenu:"Hiển thị _MENU_ dòng",loadingRecords:"Vui lòng chờ...",paginate:{first:"Đầu tiên",last:"Cuối cùng",next:"Tiếp theo",previous:"Về trước"}},pageLength:10,lengthMenu:[[10,25,50,100,200,-1],[10,25,50,100,200,"All"]],buttons:[{text:"Reload",action:function(t,e,a,n){dataTableOut.ajax.reload()}}],columnDefs:[{responsivePriority:4,targets:[-1,0]},{targets:[1,2,3,4,-1],className:"text-center"},{searchable:!1,orderable:!1,targets:[-1,0]},{width:"100px",targets:-1}],ajax:{url:"/Selling/RevenueExpenditure/LoadAll",type:"POST",datatype:"json",data:{Name:function(){return $("#Code").val().trim()},RangesDate:function(){return""==$("#rangesDate").val().trim()?moment(new Date).format("DD/MM/YYYY")+"-"+moment(new Date).format("DD/MM/YYYY"):$("#rangesDate").val().trim()},Type:function(){return t}}},columns:[{data:"date",name:"date",autoWidth:!0},{data:"code",name:"code",autoWidth:!0},{data:"categoryCevenueName",name:"categoryCevenueName",autoWidth:!0},{data:"amount",name:"amount",autoWidth:!0,render:$.fn.dataTable.render.number(",",".",0)},{data:"paymentName",name:"paymentName",autoWidth:!0},{data:"customerName",name:"customerName",autoWidth:!0,render:function(t,e,a,n){switch(a.objectRevenueExpenditure){case EnumTypeObjectRevenueExpenditure.KHACHHANG:return"<div><span>"+a.customerName+"</span><br/><i>Khách hàng</i></div>";case EnumTypeObjectRevenueExpenditure.DOITAC:return"<div><span>"+a.customerName+"</span><br/><i>Nhà cung cấp</i></div>";case EnumTypeObjectRevenueExpenditure.DOITUONGKHAC:return"<div><span>"+a.customerName+"</span><br/><i>Đối tượng khác</i></div>";default:return""}}},{data:"codeOriginaldocument",name:"codeOriginaldocument",autoWidth:!0},{data:"status",name:"status",autoWidth:!0,render:function(t,e,a,n){switch(a.status){case EnumStatusRevenueExpenditure.HUYBO:return'<span class="badge badge-danger"><i class="fas fa-ban"></i> Đã hủy</span>';case EnumStatusRevenueExpenditure.HOANTHANH:return'<span class="badge badge-success"><i class="fas fa-check-circle"></i> Hoàn thành</span>  ';default:return""}}},{data:null,name:"",render:function(t,e,a,n){return'<div class="btn-group dropleft"><button class="btn btn-light btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button><div class="dropdown-menu"><a class="dropdown-item" href="javascript:void(0)" onclick="eventCreate.addOrEditRevenueExpenditure(\'/Selling/RevenueExpenditure/edit?secret='+a.idString+'\')"><i class="fas fa-edit mr-2"></i> Sửa</a></a><form id="form_delete_'+a.id+'" action="/Selling/RevenueExpenditure/Delete?secret='+a.idString+'"  asp-controller="RevenueExpenditure" asp-area="Selling" method="post" asp-action="Delete" onsubmit="return jQueryModalDelete(this)" class="d-inline"><a  class="dropdown-item"  href="javascript:$(\'#form_delete_'+a.id+'\').submit();"><i class="fas fa-trash-alt mr-2"></i> Xóa</a></form></div></div>'}}]}),$("#reload").on("click",(function(){dataTableOut.ajax.reload(null,!1)})),$("input").keyup((function(t){13==t.keyCode&&dataTableOut.ajax.reload(null,!1)}))}},posStaff={orderTable:function(t){$.ajax({type:"POST",url:"/Selling/OrderTable/AddOrderTable",dataType:"json",data:t,success:async function(e){if(e.isValid){if(e.isbaobep&&posStaff.eventKitchenNotice(e.dataHtml),0==e.data.orderTableItems.length)e.data.isBringBack&&(e.data.idRoomAndTableGuid="-1"),await posStaff.getdatataorderbytable(e.data.idRoomAndTableGuid);else{let t=" ";e.data.orderTableItems.forEach((function(e,a){a+=1,t+='<tr data-id="'+e.idGuid+'" data-idpro="'+e.idProduct+'" data-slNotify="'+e.quantityNotifyKitchen.toString().replaceAll(",",".")+'" data-sl="'+e.quantity.toString().replaceAll(",",".")+'">\n                                            <td>\n                                                <div class="leftfood">\n                                                    <i class="fas fa-trash-alt"></i>\n                                                    <div class="content">\n                                                        <span class="name">'+a+". "+e.name+'</span>\n                                                         <div class="eventaddnote">\n                                                           <i class="number3">'+e.price.toString().replaceAll(",",".")+'</i> \n                                                           <button class="note '+(null!=e.note?"active":"")+'" data-note="'+(null!=e.note?e.note:"")+'"><i class="far fa-sticky-note"></i> <span class="text">'+(""!=e.note&&null!=e.note?e.note:"Thêm ghi chú")+'</span></button>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                            <td>\n                                                <div class="actionaddfood">\n                                                    <i class="fas fa-minus"></i>\n                                                    <input type="text" class="quantitynew number3" value="'+parseFloat(e.quantity.toString().replaceAll(",","."))+'" />\n                                                    <i class="fas fa-plus"></i>\n                                                </div>\n                                            </td>\n                                        </tr>'})),$(".bodybill table .itemorderbody").html(t),$(".bodybill table .ordercode").html("Mã đơn:"+e.data.orderCode),$("#id-order").data("id",e.data.idGuid),posStaff.loadeventAddNote(),posStaff.loadeventUpdatedataidtable(),posStaff.loadAmoutAndQuantity(e.data.amount,e.data.quantity),posStaff.loadeventadditemorder(),posStaff.eventCheckBtnNotifyOrder(),posStaff.eventCheckActivetable(),evetnFormatTextnumber3()}parseFloat(t.QuantityFloat)>0?toastrcus.success("Thêm món thành công"):toastrcus.warning("Hủy món thành công")}else toastrcus.success("Cập nhật thất bại vui lòng kiểm tra lại internet")},error:function(t){console.log(t)}})},loadeventAddNote:function(){$(".bodybill table .itemorderbody").find("tr").find("button.note").unbind(),$(".bodybill table .itemorderbody").find("tr").find("button.note").click((function(){if(parseFloat($(this).parents("tr").data("slnotify").toString().replaceAll(",",""))>0)return void toastrcus.error("Món đã thông báo chế biến, không thể điều chỉnh ghi chú");var t=$(this);let e=$(this).parents("tr").data("id"),a=$("#id-order").data("id"),n=$(this).data("note");htmlcontent=' <textarea class="form-control addnoteitem"  placeholder="Nhập ghi chú">'+n+"</textarea>",Swal.fire({title:'Nhập ghi chú cho sản phẩm: <b class="red">'+$(this).parents("tr").find(".name").html()+"</b>",customClass:{container:"Swalcontainer-small",title:"title-swal-small"},allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,confirmButtonText:"Lưu",html:htmlcontent,cancelButtonText:"Hủy bỏ",footer:"<button class='swal2-cancel swal2-styled btn-cancel mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='swal2-styled btn btn-success btn-save'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",showLoaderOnConfirm:!0,didRender:()=>{$(".addnoteitem").select(),$(".btn-cancel").click((function(){Swal.close()})),$(".btn-save").click((function(){""!=$(".addnoteitem").val().trim()?$.ajax({type:"POST",url:"/Selling/OrderTable/AddNoteAndToppingItemOrder",data:{IdOrderItem:e,IdOrder:a,Note:$(".addnoteitem").val().trim()},success:function(e){e.isValid&&(t.data("note",$(".addnoteitem").val().trim()),t.find("span.text").html($(".addnoteitem").val().trim()),Swal.close())},error:function(t){console.log(t)}}):toastrcus.error("Vui lòng nhập ghi chú")}))},preConfirm:t=>{console.log(t)},allowOutsideClick:()=>!Swal.isLoading()})}))},eventKitchenNotice:function(t){connection.invoke("Printbaobep",t,"IN")},eventCheckActivetable:function(){let t=$(".topbuton button:first").data("idtable");void 0!==t&&$(".bodybill table .itemorderbody").find("tr").not(".tr-nodata").length>0&&$("#lst-roomandtable li").map((function(e,a){$(a).data("id")==t&&$(a).addClass("active")}))},NotifyChitken:function(){let t=$("#id-order").data("id");void 0!==t?($(".btn-notif").attr("disabled","disabled"),$.ajax({type:"POST",traditional:!0,async:!1,url:"/Selling/OrderTable/NotifyKitChen",data:{IdOrder:t},success:function(t){t.isValid?(console.log("Thông báo ok"),posStaff.eventUpdateQuantityItemMonOrder(),t.isNotPrint||connection.invoke("Printbaobep",t.html,"IN")):$(".btn-notif").removeAttr("disabled")},error:function(t){console.log(t)}})):toastrcus.error("Chưa có đơn cần báo")},loadEventNoitfyStaff:function(){$(".btn-notif").unbind(),$(".btn-notif").click((function(){posStaff.NotifyChitken(),event.preventDefault()}))},loadeventadditemorder:function(){$(".bodybill table tbody tr i.fa-minus").click((function(){let t=$(this).parents("tr").data("id"),e=$(".topbuton button:first").data("idtable"),a="",n=$(this).parents("tr").data("sl"),i=$(this).parents("tr").data("slnotify"),o="";if(o=$("#searchcustomer").data("id"),a=$("#searchcustomer").data("code"),parseFloat(i)>parseFloat(n)-1){let n='\n                            <div class="form-confirmremoveitem">\n                                <span>Bạn có chắc chắn muốn hủy món <b>'+$(this).parents("li").find(".name").find("b").html()+'</b> không?</span>\n                                <div class="slminus">\n                                    <span>Số lượng hủy/giảm</span>\n                                    <div class="item_action"><i class="fas fa-minus"></i><span data-slhuy="1" class="quantitynew">1</span><span class="quantityold">/'+i+'</span> <i class="fas fa-plus"></i></div>\n                                </div>\n                                <div class="input-note">\n                                    <span class="text">Lý do: </span>\n                                     <input type="text" id="noteminus" class="form-control"/>\n                                </div>\n                            </div>\n                            ';Swal.fire({title:"Xác nhận giảm / Hủy món",html:n,showClass:{popup:"popup-formcreate"},footer:"<button class='swal2-cancel swal2-styled btn-cancel mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='swal2-styled btn btn-success btn-save'><i class='icon-cd icon-doneAll icon'></i>Đồng ý</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".form-confirmremoveitem select").prepend("<option selected></option>").select2({placeholder:{id:"",text:"Chọn bàn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$(".form-confirmremoveitem .item_action i:first-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t=parseDecimal(t>=0&&t<1?t-.1:t-1),t<=0)return toastr.error("Sô lượng hủy/giảm phải lớn hơn 0"),!1;$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".form-confirmremoveitem .item_action i:last-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t>=parseFloat(i))return toastr.error("Sô lượng hủy/giảm không vượt quá số lượng gốc"),!1;t=parseDecimal(t>=0&&t<1?t+.1:t+1),$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".btn-cancel").click((function(){Swal.close()})),$(".btn-save").click((function(){let n=parseFloat($(".form-confirmremoveitem .item_action").children(".quantitynew").data("slhuy"));var i={Note:$(".form-confirmremoveitem").find("#noteminus").val(),IsCancel:!0,IdOrderItem:t,CusCode:a,IdCustomer:o,QuantityFloat:(-1*n).toString(),TypeUpdate:_TypeUpdatePos.UpdateQuantity,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#id-order").data("id")};posStaff.orderTable(i),Swal.close()}))}})}else{var l={IdOrderItem:t,CusCode:a,IdCustomer:o,QuantityFloat:-1,TypeUpdate:_TypeUpdatePos.UpdateQuantity,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#id-order").data("id")};posStaff.orderTable(l)}})),$(".bodybill table tbody tr i.fa-plus").click((function(){let t=$(this).parents("tr").data("id"),e=$(".topbuton button:first").data("idtable"),a="",n=($(this).parents("tr").data("sl"),$(this).parents("tr").data("slnotify"),"");n=$("#searchcustomer").data("id"),a=$("#searchcustomer").data("code");var i={IdOrderItem:t,CusCode:a,IdCustomer:n,QuantityFloat:1,TypeUpdate:_TypeUpdatePos.UpdateQuantity,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#id-order").data("id")};posStaff.orderTable(i)})),$(".bodybill table tbody tr input.quantitynew").change((function(){let t=$(this).parents("tr").data("id"),e=$(".topbuton button:first").data("idtable"),a="",n=$(this).parents("tr").data("sl"),i=$(this).parents("tr").data("slnotify"),o="",l=$(this).val();if(o=$("#searchcustomer").data("id"),a=$("#searchcustomer").data("code"),parseFloat(l)<=0)return $(this).val(n),void toastrcus.error("Số lượng không hợp lệ phải lớn hơn 0");if(parseFloat(i)>parseFloat(l)){let r=parseFloat((parseFloat(n)-parseFloat(l)).toFixed(3)),s='\n                            <div class="form-confirmremoveitem">\n                                <span>Bạn có chắc chắn muốn hủy món <b>'+$(this).parents("li").find(".name").find("b").html()+'</b> không?</span>\n                                <div class="slminus">\n                                    <span>Số lượng hủy/giảm</span>\n                                    <div class="item_action"><i class="fas fa-minus"></i><span data-slhuy="'+r+'" class="quantitynew">'+r+'</span><span class="quantityold">/'+i+'</span> <i class="fas fa-plus"></i></div>\n                                </div>\n                                <div class="input-note">\n                                    <span class="text">Lý do: </span>\n                                    <input type="text" id="noteminus" class="form-control"/>\n                                </div>\n                            </div>\n                            ';Swal.fire({title:"Xác nhận giảm / Hủy món",html:s,showClass:{popup:"popup-formcreate"},footer:"<button class='swal2-cancel swal2-styled btn-cancel mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='swal2-styled btn btn-success btn-save'><i class='icon-cd icon-doneAll icon'></i>Đồng ý</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".form-confirmremoveitem .item_action i:first-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t=parseDecimal(t>=0&&t<1?t-.1:t-1),t<=0)return toastr.error("Số lượng hủy/giảm còn ít nhất là 0"),!1;$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".form-confirmremoveitem .item_action i:last-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t>=parseFloat(i))return toastr.error("Sô lượng hủy/giảm không vượt quá số lượng gốc"),!1;t=parseDecimal(t>=0&&t<1?t+.1:t+1),$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".btn-cancel").click((function(){$(sel).val(n),Swal.close()})),$(".btn-save").click((function(){let n=parseFloat($(".form-confirmremoveitem .item_action").children(".quantitynew").data("slhuy"));var i={Note:$(".form-confirmremoveitem").find("#noteminus").val(),IsCancel:!0,IdOrderItem:t,CusCode:a,IdCustomer:o,QuantityFloat:(-1*n).toString(),TypeUpdate:_TypeUpdatePos.UpdateQuantity,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#id-order").data("id")};posStaff.orderTable(i),Swal.close()}))}})}else{let i=parseFloat((parseFloat(l)-parseFloat(n)).toFixed(3));if(0!=i){var r={IdOrderItem:t,CusCode:a,IdCustomer:o,QuantityFloat:i.toString(),TypeUpdate:_TypeUpdatePos.UpdateQuantity,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#id-order").data("id")};posStaff.orderTable(r)}else 0==i||toastrcus.warning("Số lượng không hợp lệ")}})),$(".bodybill table tbody tr .leftfood i").click((function(){let t=$(this).parents("tr").data("id"),e=$(".topbuton button:first").data("idtable"),a=parseFloat($(this).parents("tr").data("sl"))||0,n=parseFloat($(this).parents("tr").data("sl"))||0,i=parseFloat($(this).parents("tr").data("slnotify"))||0;if(parseFloat(i)>0){let a='\n                            <div class="form-confirmremoveitem">\n                                <span>Bạn có chắc chắn muốn hủy không?</span>\n                                <div class="slminus">\n                                    <span>Số lượng hủy/giảm</span>\n                                    <div class="item_action"><i class="fas fa-minus"></i><span data-slhuy="'+i+'" data-goc="'+n+'" data-slnotify="'+i+'" class="quantitynew">'+n+'</span><span class="quantityold">/'+n+'</span> <i class="fas fa-plus"></i></div>\n                                </div>\n                                <div class="input-note">\n                                    <span class="text">Lý do: </span>\n                                     <input type="text" id="noteminus" class="form-control"/>\n                                </div>\n                            </div>\n                            ';Swal.fire({title:"Xác nhận giảm / Hủy món",html:a,showClass:{popup:"popup-formcreate"},footer:"<button class='swal2-cancel swal2-styled btn-cancel mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='swal2-styled btn btn-success btn-save'><i class='icon-cd icon-doneAll icon'></i>Đồng ý</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".form-confirmremoveitem .item_action i:first-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t=parseDecimal(t>=0&&t<1?t-.1:t-1),t<=0)return toastr.error("Sô lượng hủy/giảm phải lớn hơn 0"),!1;$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".form-confirmremoveitem .item_action i:last-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t>=parseFloat(i))return toastr.error("Sô lượng hủy/giảm không vượt quá số lượng gốc"),!1;t=parseDecimal(t>=0&&t<1?t+.1:t+1),$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".btn-cancel").click((function(){Swal.close()})),$(".btn-save").click((function(){let a=parseFloat($(".form-confirmremoveitem .item_action").children(".quantitynew").data("slgoc")),n=parseFloat($(".form-confirmremoveitem .item_action").children(".quantitynew").data("slhuy")),i=parseFloat($(".form-confirmremoveitem .item_action").children(".quantitynew").data("slnotify")),o=$(".form-confirmremoveitem").find("#noteminus").val(),l=a-i,r=_TypeUpdatePos.UpdateQuantity,s=!1;n==a&&(r=_TypeUpdatePos.RemoveRowItem),l!=n&&(s=!0);var d={Note:o,IsCancel:s,IdOrderItem:t,QuantityFloat:-1*n,TypeUpdate:r,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#id-order").data("id")};posStaff.orderTable(d),Swal.close()}))}})}else{var o={QuantityFloat:a,IdOrderItem:t,TypeUpdate:_TypeUpdatePos.RemoveRowItem,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#id-order").data("id")};posStaff.orderTable(o)}}))},loadeventremoveOrder:function(){$(".btn-removerOrder").click((function(){let t=$("#id-order").data("id");Swal.fire({icon:"warning",title:"Bạn có chắc chắn muốn xóa đơn không?",showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Đóng"}).then((e=>{e.isConfirmed&&$.ajax({type:"POST",url:"/Selling/OrderTable/RemoveOder",data:{TypeUpdate:_TypeUpdatePos.RemoveOrder,IdOrder:t},success:function(t){t.isValid&&(posStaff.checkHighlightTableInOrder(),html='<table class="table">\n                                        <thead>\n                                            <tr>\n                                                <th class="ordercode">Mã đơn: </th>\n                                                <th style="    width: 123px;" class="text-center"></th>\n                                            </tr>\n                                        </thead>\n                                        <tbody class="itemorderbody">\n                                            <tr class="tr-nodata">\n                                                <td colspan="2">\n                                                    <div class="no-order">\n                                                        <img src="../images/ristorante_old.png" />\n                                                        <b>Chưa có món nào được chọn</b>\n                                                        <span>Vui lòng chọn món trong thực đơn</span>\n                                                    </div>\n                                                </td>\n                                            </tr>\n                                        </tbody>\n                                    </table>',$(".bodybill").html(html),$(".actionstaff").find(".btn-addNeworderStaff").remove(),$(".actionstaff").find(".btn-removerOrder").remove())},error:function(t){console.log(t)}})}))}))},checkHighlightTableInOrder:function(){$("#lst-roomandtable li").map((function(t,e){$(e).hasClass("CurentOrder")&&($(e).removeClass("active"),$(e).find(".ribbon-two").remove())}))},loadAmoutAndQuantity:function(t=null,e=null,a=""){null!=t&&null!=e?($(".amountFull").html(t),$(".fullQuantity").html(parseFloat(e.toString().replaceAll(",",".")))):(t=0,e=0,$(".amountFull").html(t),$(".fullQuantity").html(0))},loadeventUpdatedataidtable:function(){$(".bodybill table > tbody  > tr").each((function(t,e){let a=$(this).data("id"),n=$(this).data("idpro"),i=$(this).data("slNotify"),o=$(this).data("sl");$(this).removeAttr("id"),$(this).removeAttr("idpro"),$(this).removeAttr("slNotify"),$(this).removeAttr("sl"),$(this).data("id",a),$(this).data("idpro",n),$(this).data("slNotify",i),$(this).data("sl",o)}))},loadeventClickThucDon:function(){$("#lstfood li").click((function(){let t=$(".topbuton button:first").data("idtable"),e=$("#id-order").data("id");void 0===t&&toastrcus.error("Vui lòng chọn bàn/phòng");var a={CusCode:"",QuantityFloat:1,TypeUpdate:_TypeUpdatePos.AddProduct,IdRoomAndTableGuid:"-1"!=t?t:"",IsBringBack:"-1"==t,IdGuid:e,IdProduct:$(this).data("id")};posStaff.orderTable(a)}))},updateDataAttr:function(){let t=$("#id-order").data("id");$("#id-order").removeAttr("data-id"),$("#id-order").data("id",t)},getdatataorderbytable:async function(t){var e=await axios.get("/Selling/OrderTable/LoadDataOrderStaff?idtable="+t);if(!e.data.isValid)return!1;$(".bodybill").html(e.data.data),posStaff.updateDataAttr(),posStaff.loadeventUpdatedataidtable(),posStaff.loadEventNoitfyStaff(),posStaff.loadeventAddNote(),posStaff.loadeventadditemorder(),$(".actionstaff").find(".btn-addNeworderStaff").remove(),$(".actionstaff").find(".btn-removerOrder").remove(),$(".actionstaff").find(".btn-historyOrder").remove(),e.data.active?($(".actionstaff").append('<button type="button" class="btn-addNeworderStaff btn btn-primary"><i class="fas fa-plus"></i></button>'),$(".actionstaff").append('<button type="button" class="btn-removerOrder btn btn-danger ml-2"><i class="fas fa-trash"></i></button>'),$(".actionstaff").append('<button type="button" class="btn-historyOrder btn btn-info ml-2"><i class="fas fa-history"></i></button>'),posStaff.loadeventremoveOrder(),posStaff.loadShowHistoryOrder(),$("#lst-roomandtable li.active").addClass("active"),$(".topbuton button:first").trigger("click")):$(".topbuton button:last").trigger("click"),posStaff.eventCheckBtnNotifyOrder(),evetnFormatTextnumber3()},loadShowHistoryOrder:function(){$("button.btn-historyOrder").click((async function(){const t="/Selling/OrderTable/GetHistoryOrder?IdOrder="+$("#id-order").data("id");var e=await axios.get(t);e.data.isValid&&Swal.fire({title:"Lịch sử gọi món đã báo bếp",customClass:{container:"Swalcontainer-small SwalHistoryOrderChitken",title:"title-swal-small"},allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,confirmButtonText:"Lưu",html:e.data.html,cancelButtonText:"Hủy bỏ",footer:"<button class='swal2-cancel swal2-styled btn-cancel mr-3'><i class='icon-cd icon-add_cart icon'></i>Đóng</button>",showLoaderOnConfirm:!0,didRender:()=>{$(".addnoteitem").select(),$(".btn-cancel").click((function(){Swal.close()}))},preConfirm:t=>{console.log(t)},allowOutsideClick:()=>!Swal.isLoading()})}))},eventUpdateQuantityItemMonOrder:function(){$(".bodybill table > tbody  > tr").each((function(t,e){let a=$(this).data("sl");$(this).data("slnotify",a)})),$(".btn-notif").attr("disabled","disabled")},eventCheckBtnNotifyOrder:function(){let t=!1;$(".bodybill table > tbody  > tr").each((function(e,a){let n=$(this).data("sl");$(this).data("slnotify")!=n&&(t=!0)})),t?$(".btn-notif").removeAttr("disabled"):$(".btn-notif").attr("disabled","disabled")},eventactiveTableloca:function(t){"undefined"!=typeof Storage?localStorage.setItem("activeTableStaff",t):alert("Liên hệ đội ngủ hỗ  trợ lỗi trình duyệt của bạn không hỗ  trợ Storage")},eventIntwindow:function(){$(".bottomFix").remove(),posStaff.loadDanhSachBan()},loadDanhSachBan:function(){$(".topbuton button:first").attr("disabled","disabled"),$("#dataListFood").hasClass("d-none")||$("#dataListFood").addClass("d-none"),$("#dataTableRoom").hasClass("d-none")?(0==$("#dataTableRoom .litstbale li").length&&$.ajax({type:"GET",async:!1,url:"/Selling/RoomTable/GetTableJson",data:{},success:function(t){t.isValid&&(htmlcate='<ul class="litstbale">',htmlcate+='<li class="active" data-id="0">\n                                   <a href="javascript:void(0)" data-id="0">\n                                        <span>'+t.jsonPro.length+"</span> Tất cả\n                                    </a>\n                                 </li>",t.jsoncate.forEach((function(t,e){htmlcate+='<li>\n                                         <a href="javascript:void(0)" data-id="'+t.id+'">\n                                             <span>'+t.countpro+"</span> "+t.name+"\n                                         </a>\n                                      </li>"})),htmlcate+="</ul>",$("#dataTableRoom .dataArea").html(htmlcate),htmlcate='<ul id="lst-roomandtable" class="ul-nonestyle">',htmlcate+='<li class="mangve" style="display: flex;" data-id="-1" data-idcategory="-1">\n                                        <i class="fas fa-baby-carriage"></i>\n                                        <b>Mang về</b>\n                                    </li>',t.jsonPro.forEach((function(t,e){htmlMac=' <li class="" style="display: flex;"  data-id="'+t.idtable+'" data-idcategory="'+t.idArea+'">',t.numberProduct>0&&(htmlMac='<li class="active" style="display: flex;"  data-id="'+t.idtable+'" data-idcategory="'+t.idArea+'"> <div class="ribbon-two ribbon-two-primary"><span>'+t.numberProduct+"</span></div>"),htmlcate+=htmlMac+'\n                                            <i class="fas fa-utensils"></i>\n                                            <b>'+t.tableName+"</b>\n                                        </li>"})),htmlcate+="</ul>",$("#dataTableRoom .datatable").html(htmlcate),$("#dataTableRoom .dataArea ul li").map((function(){let t=$(this).children("a").data("id");$(this).children("a").removeAttr("data-id"),$(this).children("a").data("id",t)})),$("#dataTableRoom .datatable ul li").map((function(){let t=$(this).data("id"),e=$(this).data("idcategory");$(this).removeAttr("data-idcategory"),$(this).removeAttr("data-id"),$(this).data("idcategory",e),$(this).data("id",t)})),$("#dataTableRoom .dataArea a").click((function(){let t=$(this).data("id");$("#dataTableRoom #lst-roomandtable li").filter((function(){var e=$(this);let a=$(this).data("idcategory");t==a||0==t?e.css("display","flex"):e.css("display","none")})),$(this).parents("ul.litstbale").find("li.active").removeClass("active"),$(this).parent("li").addClass("active")})),posStaff.evntSelectTabel(),posStaff.eventCheckLoaddatatableOld())},error:function(t){console.log(t)}}),$("#dataTableRoom").toggleClass("d-none")):$("#dataTableRoom").toggleClass("d-none"),$(".topbuton button:first").removeAttr("disabled")},loadeventClickbtnFood:function(){$(".topbuton button:last").click((function(){$("#dataTableRoom").hasClass("d-none")||$("#dataTableRoom").addClass("d-none"),$(this).attr("disabled","disabled"),$("#dataListFood").hasClass("d-none")?(0==$("#dataListFood .lstcategoryfood li").length&&$.ajax({type:"GET",url:"/Selling/Product/GetProductJson",data:{},success:function(t){t.isValid&&(htmlcate='<ul class="lstcategoryfood">',htmlcate+='<li class="active" data-id="0">\n                                           <a href="javascript:void(0)" data-id="0">\n                                                <span>'+t.jsonPro.length+"</span> Tất cả\n                                            </a>\n                                         </li>",t.jsoncate.forEach((function(t,e){htmlcate+='<li>\n                                         <a href="javascript:void(0)" data-id="'+t.id+'">\n                                             <span>'+t.countpro+"</span> "+t.name+"\n                                         </a>\n                                      </li>"})),htmlcate+="</ul>",$("#dataListFood .dataCategoryleft").html(htmlcate),htmlcate='<ul id="lstfood" class="ul-nonestyle">',t.jsonPro.forEach((function(t,e){htmlimg="./images/no-img.png",""!=t.img&&(htmlimg="../"+t.img),htmlcate+=' <li class="" style="display: flex;"  data-id="'+t.id+'" data-idcategory="'+t.idCategory+'">\n                                                <div class="ribbon ribbon-primary float-end number3"> '+t.retailPrice+'</div>\n                                                <img src="'+htmlimg+'" />\n                                                <div class="conent-botom">\n                                                    <span>'+t.name+"</span>\n                                                </div>\n                                        </li>"})),htmlcate+="</ul>",$("#dataListFood .datatable").html(htmlcate),$("#dataListFood .dataCategoryleft ul li").map((function(){let t=$(this).children("a").data("id");$(this).children("a").removeAttr("data-id"),$(this).children("a").data("id",t)})),$("#dataListFood .datatable ul li").map((function(){let t=$(this).data("id"),e=$(this).data("idcategory");$(this).removeAttr("data-idcategory"),$(this).removeAttr("data-id"),$(this).data("idcategory",e),$(this).data("id",t)})),$("#dataListFood .dataCategoryleft a").click((function(){let t=$(this).data("id");$("#dataListFood #lstfood li").filter((function(){var e=$(this);let a=$(this).data("idcategory");t==a||0==t?e.css("display","flex"):e.css("display","none")})),$(this).parents("ul.lstcategoryfood").find("li.active").removeClass("active"),$(this).parent("li").addClass("active")})),evetnFormatTextnumber3decimal(),posStaff.loadeventClickThucDon())},error:function(t){console.log(t)}}),$("#dataListFood").toggleClass("d-none")):$("#dataListFood").toggleClass("d-none"),$(this).removeAttr("disabled")}))},loadeventSelectttable:function(){$(".topbuton button:first").data("id",0),$(".topbuton button:first").click((function(){posStaff.loadDanhSachBan()}))},eventCheckLoaddatatableOld:function(){if("undefined"!=typeof Storage){var t=localStorage.getItem("activeTableStaff");if(!isNaN(parseInt(t))){t=parseInt(t)+1,$("#lst-roomandtable li").length<t&&(t=1);let e=$("#lst-roomandtable li:nth-child("+t+")");e.addClass("CurentOrder"),posStaff.getdatataorderbytable(e.data("id")),posStaff.eventloadShownametable($(e))}}else alert("Liên hệ đội ngủ hỗ  trợ lỗi trình duyệt của bạn không hỗ  trợ Storage")},eventloadShownametable:function(t){let e=$(t).data("id"),a=$(t).children("b").html();$(".topbuton button:first").data("idtable",e),$(".topbuton button:first").children(".tablename").html(a),$(".topbuton button:first").children(".tablename").removeClass("required")},evntSelectTabel:function(){$("#lst-roomandtable li").click((async function(){$(".bottomFix").remove(),$("#lst-roomandtable").find("li.CurentOrder").not($(this)).removeClass("CurentOrder"),$(this).addClass("CurentOrder");let t=$(this).data("id");await posStaff.getdatataorderbytable(t),posStaff.eventloadShownametable($(this)),posStaff.eventactiveTableloca($(this).index())}))}},PurchaseReturns={loadEvnetFormatTable:function(){$("#tablePurchaseOrder tbody tr input").unbind(),$("#tablePurchaseOrder tbody tr input.number3").each((function(t,e){var a=$(this).val();$(this).val(a.replaceAll(",",""))})),$("#tablePurchaseOrder tbody tr input.number3").each((function(t,e){var a=$(this).val();$(this).val(a.replaceAll(",",".")),fnInitialFormatNumber(this)})).ForceNumericOnly().focus((function(){var t=$(this).val();$(this).val(t.replaceAll(",",""))})).focusout((function(){fnFocusOut(this)}))},autocompleteproduct:function(){$("#txtPurchaseOrderSearch").autocomplete({appendTo:"#parentautocomplete",autoFocus:!0,minLength:1,delay:0,source:function(t,e){$.ajax({global:!1,url:"/Selling/Pos/SearchProductPos",type:"GET",dataType:"json",data:{text:t.term},success:function(a){return e($.map(a,(function(e){let n=__highlight(e.name,t.term),i="<span class='ton'>Tồn kho: "+parseFloat(e.quantity).format0VND(3,3,"")+"<span>";return(a.isInventory||a.typeProductCategory==EnumTypeProductCategory.COMBO||a.typeProductCategory==EnumTypeProductCategory.SERVICE)&&(i="<span class='ton'>Tồn kho: -- <span>"),{label:"<a href='javascript:void(0)'><div class='search-auto'><div class='img'><img src='../../../"+e.img+"'></div><div class='tk_name'><span>"+n+" ("+e.code+")</span><span class='price'>Giá: "+parseFloat(e.price).format0VND(3,3,"")+"</span>"+i+" </div></div></a>",value:e.code,idProduct:e.id,price:e.price,quantity:e.quantity,name:e.name}}))),{label:t.term,value:t.term}}})},html:!0,select:function(t,e){$(this).val(e.item.value),$(this).select(),PurchaseReturns.loadeventselectTable(e.item.name,e.item.price,e.item.value,e.item.quantity)},response:function(){}}).focus((function(){$(this).autocomplete("search"),$(this).select()})),$("#txtPurchaseOrderSearch").keypress((async function(t){let e=$(this).val();if(13==t.keyCode&&e.length>0){let t=await PurchaseOrder.loadEventEnterInputAddPro(e);if($(this).select(),!t){return void(0==(parseInt($("#iddataPurchaseReturns").data("id"))||0)?toastrcus.error("Mã sản phẩm không hợp lệ!"):toastrcus.error("Hàng hóa không nằm trong đơn hàng nhập không thể trả hàng!"))}}}))},loadeventselectTable:async function(t,e,a,n=0){if(!await PurchaseOrder.loadEventEnterInputAddPro(a)){if(parseInt($("#iddataPurchaseReturns").data("id"))>0)return toastrcus.error("Hàng hóa không nằm trong đơn hàng nhập không thể trả hàng!"),!1;$("#tablePurchaseOrder tbody tr.nodata").remove();let i=$("#tablePurchaseOrder tbody tr").length+1,o="<tr>\n                          <td>"+i+'</td>\n                          <td class="code">'+a+'</td>\n                          <td class="name" data-name="'+t+'">'+t+'</td>\n                          <td style="width: 175px;">\n                            <div class="input-group">\n                              <div class="input-group-prepend">\n                                <span class="input-group-text minus-quantity" id="basic-addon1"><i class="fas fa-minus"></i></span>\n                              </div>\n                              <input type="text" class="form-control number3 text-center quantity" data-quanold="0" data-tonkho="'+parseFloat(n.replaceAll(",","."))+'" data-quantity="1" placeholder="Nhập số lượng" value="1">\n                              <div class="input-group-prepend">\n                                <span class="input-group-text add-quantity" id="basic-addon1"><i class="fas fa-plus"></i></span>\n                              </div>\n                            </div>\n                          </td>\n                          <td class=""><input type="text" class="text-right form-control number3 price" data-price="'+parseFloat(e)+'" value="'+parseFloat(e)+'"/></td>\n                          <td class=""><input type="text" class="text-right form-control number3 discountpro" data-discount="0" value="0"/></td>\n                          <td class=""><input type="text" readonly disabled class="text-right number3 form-control amount" value="'+parseFloat(e)+'"/></td>\n                      </tr>';1==i?$("#tablePurchaseOrder tbody").html(o):$("#tablePurchaseOrder tbody tr:last").after(o),PurchaseReturns.loadEvnetFormatTable(),PurchaseReturns.loadeventUpdateAmount(),PurchaseReturns.loadEventChangeQuantity(),PurchaseReturns.loadEventChangePrice(),PurchaseReturns.loadEventChangediscountProduct(),PurchaseReturns.loadEventActionQuantity()}},loadeventbutonSubmit:function(){$(".btn-saves").click((function(){PurchaseReturns.loadeventSave(EnumStatusPurchaseOrder.DA_TRA_HANG)})),$(".btn-temporarySave").click((function(){PurchaseReturns.loadeventSave(EnumStatusPurchaseOrder.PHIEU_TAM)}))},loadEventChangeDisCount:function(){$(".discount").change((function(){let t=$(this).data("discount"),e=parseFloat($(this).val().replaceAll(",",""))||0;if(!(e>=0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(parseFloat(t).format0VND(3,3,""));$(this).data("discount",e),PurchaseReturns.loadeventUpdateAmount()})),$(".paymentSupplier").change((function(){$(this).data("payment",1);let t=parseFloat($(this).val().replaceAll(",",""))||0;$(this).data("value",t),$(".discount").trigger("change")}))},loadeventSave:function(t){let e=[];if(0==$("#tablePurchaseOrder tbody tr:not(.nodata)").length)Swal.fire({title:"Đơn trả hàng đang trống vui lòng chọn hàng hóa?",text:"Bạn có muốn tiếp tục nhập đơn hàng không?",icon:"error",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Trở về danh sách trả hàng!",cancelButtonText:"Đồng ý"}).then((t=>{t.isConfirmed&&(location.href="/selling/purchaseorder/PurchaseReturns")}));else{if($("#tablePurchaseOrder tbody tr").map((function(){let t=$(this).find(".code").text(),a=$(this).find(".name").data("name"),n=parseFloat($(this).find(".quantity").val().replaceAll(",","")),i=parseFloat($(this).find(".price").val().replaceAll(",","")),o=parseFloat($(this).find(".discountpro").val().replaceAll(",","")),l=parseFloat($(this).find(".amount").val().replaceAll(",",""));if(n<=0)return void toastrcus.error("Số lượng phải lớn hơn không của hàng hóa: "+a);let r={};r.Code=t,r.Name=a,r.Quantity=n,r.Price=i,r.DiscountAmount=o,r.Total=l,e.push(r)})),0==e.length)return void toastrcus.error("Vui lòng lựa chọn hàng hóa cần nhập hàng");let a=$("form#create-formProduct"),n=parseFloat(a.find(".totalAll").data("value"))||0,i=parseFloat(a.find(".amountAll").data("value"))||0,o=parseFloat(a.find(".discount").data("discount"))||0,l=parseFloat(a.find(".quantityAll").data("value"))||0,r=parseFloat(a.find(".paymentSupplier").data("value"))||0,s=parseFloat(a.find(".paydebt").data("value"))||0,d=a.find(".notePurchaseOrder").val(),c=TypePurchaseOrder.TRA_HANG_NHAP,u=$("#iddataPurchaseReturns").data("id"),p=$("#CreateDate").val();$.ajax({type:"POST",url:"/Selling/PurchaseOrder/Create",data:{IdPayment:$(".PaymentMethod").val(),IdSuppliers:$(".Suppliersid").val(),JsonItem:JSON.stringify(e),Quantity:l,Total:n,DiscountAmount:o,Amount:i,AmountSuppliers:r,DebtAmount:s,Note:d,Type:c,IdPurchaseOrder:u,CreateDate:p,Status:t},success:function(t){t.isValid&&Swal.fire({title:"Trả hàng thành công?",text:"Bạn có muốn tạo đơn trả hàng mới không?",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Trở về danh sách trả hàng!",cancelButtonText:"Đồng ý"}).then((t=>{t.isConfirmed?location.href="/selling/purchaseorder/indexreturn":location.href="/selling/purchaseorder/PurchaseReturns"}))},error:function(t){console.log(t)}})}},loadCheckTrahangNhap:function(){0==$("#tablePurchaseOrder tbody tr:not(.nodata)").length&&parseInt($("#iddataPurchaseReturns").data("id"))>0&&Swal.fire({title:"Đơn hàng rỗng?",text:"Đơn hàng hiện đã trả hết hàng, không có sản phẩm nào cần trả?",icon:"error",allowOutsideClick:!1,showCancelButton:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Trở về danh sách nhập hàng!",cancelButtonText:"Đồng ý"}).then((t=>{t.isConfirmed&&(location.href="/selling/purchaseorder")}))},loadEventActionQuantity:function(){$("#tablePurchaseOrder tbody tr .minus-quantity").click((function(){let t=$(this).parents("tr").find(".quantity").data("quantity"),e=parseFloat($(this).parents("tr").find(".quantity").val().replaceAll(",",""))||0;if(e-=1,!(e>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(t);{let t=e*(parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0)-(parseFloat($(this).parents("tr").find(".discountpro").val().replaceAll(",",""))||0);$(this).parents("tr").find(".amount").val(t.format0VND(3,3,"")),$(this).parents("tr").find(".quantity").val(e.format0VND(3,3,"")),$(this).data("quantity",e)}PurchaseReturns.loadeventUpdateAmount()})),$("#tablePurchaseOrder tbody tr .add-quantity").click((function(){let t=$(this).parents("tr").find(".quantity").data("quantity"),e=$(this).parents("tr").find(".name").data("name"),a=parseInt($("#iddataPurchaseReturns").data("id")),n=parseInt($(this).parents("tr").find(".quantity").data("quanold").toString().replaceAll(",",".")),i=parseFloat($(this).parents("tr").find(".quantity").val().replaceAll(",",""))||0;if(i+=1,a>0&&i>n)return toastrcus.error("Vui lòng nhập số lượng hàng trả không vượt quá số lượng hàng nhập"),void $(this).val(t);if(!(i>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(t);{if(i>parseInt($(this).parents("tr").find(".quantity").data("tonkho")))return toastrcus.error("Sản phẩm "+e+" không đủ số lượng tồn kho để trả hàng, vui lòng kiểm tra lại"),void $(this).val(t);let a=i*(parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0)-(parseFloat($(this).parents("tr").find(".discountpro").val().replaceAll(",",""))||0);$(this).parents("tr").find(".amount").val(a.format0VND(3,3,"")),$(this).parents("tr").find(".quantity").val(i.format0VND(3,3,"")),$(this).parents("tr").find(".quantity").data("quantity",i)}PurchaseReturns.loadeventUpdateAmount()}))},loadeventUpdateAmount:function(){let t=0,e=0;$("#tablePurchaseOrder tbody tr:not(.nodata)").length>0&&$("#tablePurchaseOrder tbody tr").map((function(){t+=parseFloat($(this).find(".quantity").val().replaceAll(",",""))||0,e+=parseFloat($(this).find(".amount").val().replaceAll(",",""))||0})),$(".quantityAll").html(t.format0VND(3,3,"")),$(".quantityAll").data("value",t),$(".totalAll").html(e.format0VND(3,3,"")),$(".totalAll").data("value",e);let a=parseFloat($(".discount").val().replaceAll(",",""))||0,n=e-a;if($(".amountAll").html(n.format0VND(3,3,"")),$(".amountAll").data("value",n),0==parseInt($(".paymentSupplier").data("payment")))n*=-1,$(".paydebt").html(n.format0VND(3,3,"")),$(".paydebt").data("value",n),$(".paymentSupplier").val(0),$(".paymentSupplier").data("value",0);else{let t=parseFloat($(".paymentSupplier").val().replaceAll(",",""))||0;$(".paydebt").html((t-n).format0VND(3,3,"")),$(".paydebt").data("value",t-n)}},loadEventChangeQuantity:function(){$("#tablePurchaseOrder tbody tr input.quantity").change((function(){let t=$(this).data("quantity"),e=parseFloat($(this).data("quanold").toString().replaceAll(",",".")),a=parseFloat($(this).val().replaceAll(",",""))||0;if(!(a>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(t);if(a>e)return toastrcus.error("Số lượng hàng trả không vượt quá số lượng hàng nhập"),void $(this).val(t);{let t=a*(parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0)-(parseFloat($(this).parents("tr").find(".discountpro").val().replaceAll(",",""))||0);$(this).parents("tr").find(".amount").val(t.format0VND(3,3,"")),$(this).data("quantity",a)}PurchaseReturns.loadeventUpdateAmount()}))},loadEventChangePrice:function(){$("#tablePurchaseOrder tbody tr input.price").change((function(){let t=$(this).data("price"),e=parseFloat($(this).val().replaceAll(",",""))||0;if(!(e>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(parseFloat(t).format0VND(3,3,""));{let t=(parseFloat($(this).parents("tr").find(".quantity").val().replaceAll(",",""))||0)*e-(parseFloat($(this).parents("tr").find(".discountpro").val().replaceAll(",",""))||0);$(this).parents("tr").find(".amount").val(t.format0VND(3,3,"")),$(this).data("price",e)}PurchaseReturns.loadeventUpdateAmount()}))},loadEventChangediscountProduct:function(){$("#tablePurchaseOrder tbody tr input.discountpro").change((function(){let t=$(this).data("discount"),e=parseFloat($(this).val().replaceAll(",",""))||0;if(!(e>=0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(parseFloat(t).format0VND(3,3,""));{let a=(parseFloat($(this).parents("tr").find(".quantity").val().replaceAll(",",""))||0)*(parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0)-e;$(this).parents("tr").find(".amount").val(a.format0VND(3,3,"")),$(this).data("discount",t)}PurchaseReturns.loadeventUpdateAmount()}))},loadeventShowdetail:function(t,e){$.ajax({type:"GET",url:"/Selling/purchaseorder/View?secret="+t+"&Type="+e,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                                popupform-payment\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate animate__animated popupform-payment animate__fadeOutRight animate__faster"},showCloseButton:!0,title:"Chi tiết đơn hàng nhập",html:t.html,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='fas fa-cancel'></i>Đóng</button><button class='mr-3 btn btn-purchaseorder btn-warning'><i class='fas fa-check mr-2'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{loaddaterangepicker(!0),$(".number3").each((function(){let t=$(this).text().replaceAll(".","");$(this).html(parseFloat(t).format0VND(0,3,""))})),null!=t.purchaseOrderCode&&""!=t.purchaseOrderCode||loaddataSelect2("/API/Handling/GetAllSupller",".Suppliersid",t.idSuppliers,"Chọn nhà cung cấp"),loaddataSelect2("/API/Handling/GetAllPaymentMethod",".PaymentMethod",t.idPayment,"Chọn hình thức thanh toán"),$(".btn-purchaseorder").data("id",t.idData),$(".btn-continue").click((function(){Swal.close()})),$(".btn-purchaseorder").click((function(){PurchaseReturns.eventSaveIndetailt($(this).data("id"))}))}})},error:function(t){console.log(t)}})},eventSaveIndetailt:function(t){let e=$("#CreateDate").val();if(""==e.trim())return void toastrcus.error("Vui lòng chọn ngày trả hàng");let a=$("#NotePurchaseReturns").val(),n=TypePurchaseOrder.TRA_HANG_NHAP;$.ajax({type:"POST",url:"/Selling/PurchaseOrder/Update",data:{IdPayment:$(".PaymentMethod").val(),IdSuppliers:$(".Suppliersid").val(),Id:t,Note:a,CreateDate:e,Type:n},success:function(t){t.isValid&&Swal.fire({title:"Cập nhật thành công?",text:"Bạn có muốn tiếp tục chỉnh sửa không?",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Trở về danh sách trả hàng!",cancelButtonText:"Đồng ý"}).then((t=>{t.isConfirmed&&(dataTableOut.draw("page"),Swal.close())}))},error:function(t){console.log(t)}})}},PurchaseOrder={autocompleteproduct:function(){$("#txtPurchaseOrderSearch").autocomplete({appendTo:"#parentautocomplete",autoFocus:!0,minLength:1,delay:0,source:function(t,e){$.ajax({global:!1,url:"/Selling/Pos/SearchProductPos",type:"GET",dataType:"json",data:{text:t.term},success:function(a){return e($.map(a,(function(e){let n=__highlight(e.name,t.term),i="<span class='ton'>Tồn kho: "+parseFloat(e.quantity).format0VND(3,3,"")+"<span>";return(a.isInventory||a.typeProductCategory==EnumTypeProductCategory.COMBO||a.typeProductCategory==EnumTypeProductCategory.SERVICE)&&(i="<span class='ton'>Tồn kho: -- <span>"),{label:"<a href='javascript:void(0)'><div class='search-auto'><div class='img'><img src='../../"+e.img+"'></div><div class='tk_name'><span>"+n+" ("+e.code+")</span><span class='price'>Giá: "+parseFloat(e.price).format0VND(3,3,"")+"</span>"+i+"</div></div></a>",value:e.code,idProduct:e.id,price:e.price,quantity:e.quantity,name:e.name}}))),{label:t.term,value:t.term}}})},html:!0,select:function(t,e){$(this).val(e.item.value),$(this).select(),PurchaseOrder.loadeventselectTable(e.item.name,e.item.price,e.item.value)},response:function(){}}).focus((function(){$(this).autocomplete("search"),$(this).select()})),$("#txtPurchaseOrderSearch").keypress((function(t){let e=$(this).val();13==t.keyCode&&e.length>0?(PurchaseOrder.loadEventEnterInputAddPro(e),$(this).select()):0==e.length&&(idProductAutocom=0)}))},loadEventEnterInputAddPro:async function(t){let e=!1;return $("#tablePurchaseOrder tbody tr").map((function(){$(this).find(".code").text().trim()==t&&(e=!0,$(this).find(".add-quantity").trigger("click"))})),e},loadEvnetFormatTable:function(){$("#tablePurchaseOrder tbody tr input").unbind(),$("#tablePurchaseOrder tbody tr input.number3").each((function(t,e){var a=$(this).val();$(this).val(a.replaceAll(",",""))})),$("#tablePurchaseOrder tbody tr input.number3").each((function(t,e){var a=$(this).val();$(this).val(a.replaceAll(",",".")),fnInitialFormatNumber(this)})).ForceNumericOnly().focus((function(){var t=$(this).val();$(this).val(t.replaceAll(",",""))})).focusout((function(){fnFocusOut(this)}))},loadeventselectTable:async function(t,e,a){$("#tablePurchaseOrder tbody tr.nodata").remove();let n=$("#tablePurchaseOrder tbody tr").length+1;if(!await PurchaseOrder.loadEventEnterInputAddPro(a)){let i="<tr>\n                          <td>"+n+'</td>\n                          <td class="code">'+a+'</td>\n                          <td class="name" data-name="'+t+'">'+t+'</td>\n                          <td style="width: 175px;">\n                            <div class="input-group">\n                              <div class="input-group-prepend">\n                                <span class="input-group-text minus-quantity" id="basic-addon1"><i class="fas fa-minus"></i></span>\n                              </div>\n                              <input type="text" class="form-control number3 text-center quantity" data-quantity="1" placeholder="Nhập số lượng" value="1">\n                              <div class="input-group-prepend">\n                                <span class="input-group-text add-quantity" id="basic-addon1"><i class="fas fa-plus"></i></span>\n                              </div>\n                            </div>\n                          </td>\n                          <td class=""><input type="text" class="text-right form-control number3 price" data-quantity="'+parseFloat(e)+'" value="'+parseFloat(e)+'"/></td>\n                          <td class=""><input type="text" class="text-right form-control number3 discountpro" data-discount="0" value="0"/></td>\n                          <td class=""><input type="text" readonly disabled class="text-right number3 form-control amount" value="'+parseFloat(e)+'"/></td>\n                    </tr>';1==n?$("#tablePurchaseOrder tbody").html(i):$("#tablePurchaseOrder tbody tr:last").after(i),PurchaseOrder.loadEvnetFormatTable(),PurchaseOrder.loadeventUpdateAmount(),PurchaseOrder.loadEventChangeQuantity(),PurchaseOrder.loadEventChangePrice(),PurchaseOrder.loadEventChangediscountProduct(),PurchaseOrder.loadEventActionQuantity()}},loadEventActionQuantity:function(){$("#tablePurchaseOrder tbody tr .minus-quantity").click((function(){let t=$(this).parents("tr").find(".quantity").data("quantity"),e=parseFloat($(this).parents("tr").find(".quantity").val().replaceAll(",",""))||0;if(e-=1,!(e>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(t);{let t=e*(parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0)-(parseFloat($(this).parents("tr").find(".discountpro").val().replaceAll(",",""))||0);$(this).parents("tr").find(".amount").val(t.format0VND(3,3,"")),$(this).parents("tr").find(".quantity").val(e.format0VND(3,3,"")),$(this).data("quantity",e)}PurchaseOrder.loadeventUpdateAmount()})),$("#tablePurchaseOrder tbody tr .add-quantity").click((function(){let t=$(this).parents("tr").find(".quantity").data("quantity"),e=parseFloat($(this).parents("tr").find(".quantity").val().replaceAll(",",""))||0;if(e+=1,!(e>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(t);{let t=e*(parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0)-(parseFloat($(this).parents("tr").find(".discountpro").val().replaceAll(",",""))||0);$(this).parents("tr").find(".amount").val(t.format0VND(3,3,"")),$(this).parents("tr").find(".quantity").val(e.format0VND(3,3,"")),$(this).parents("tr").find(".quantity").data("quantity",e)}PurchaseOrder.loadeventUpdateAmount()}))},loadEventChangeQuantity:function(){$("#tablePurchaseOrder tbody tr input.quantity").change((function(){let t=$(this).data("quantity"),e=parseFloat($(this).val().replaceAll(",",""))||0;if(!(e>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(t);{let t=e*(parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0)-(parseFloat($(this).parents("tr").find(".discountpro").val().replaceAll(",",""))||0);$(this).parents("tr").find(".amount").val(t.format0VND(3,3,"")),$(this).data("quantity",e)}PurchaseOrder.loadeventUpdateAmount()}))},loadEventChangePrice:function(){$("#tablePurchaseOrder tbody tr input.price").change((function(){let t=$(this).data("price"),e=parseFloat($(this).val().replaceAll(",",""))||0;if(!(e>0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(parseFloat(t).format0VND(3,3,""));{let t=(parseFloat($(this).parents("tr").find(".quantity").val().replaceAll(",",""))||0)*e-(parseFloat($(this).parents("tr").find(".discountpro").val().replaceAll(",",""))||0);$(this).parents("tr").find(".amount").val(t.format0VND(3,3,"")),$(this).data("price",e)}PurchaseOrder.loadeventUpdateAmount()}))},loadEventChangediscountProduct:function(){$("#tablePurchaseOrder tbody tr input.discountpro").change((function(){let t=$(this).data("discount"),e=parseFloat($(this).val().replaceAll(",",""))||0;if(!(e>=0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(parseFloat(t).format0VND(3,3,""));{let a=(parseFloat($(this).parents("tr").find(".quantity").val().replaceAll(",",""))||0)*(parseFloat($(this).parents("tr").find(".price").val().replaceAll(",",""))||0)-e;$(this).parents("tr").find(".amount").val(a.format0VND(3,3,"")),$(this).data("discount",t)}PurchaseOrder.loadeventUpdateAmount()}))},loadEventChangeDisCount:function(){$(".discount").change((function(){let t=$(this).data("discount"),e=parseFloat($(this).val().replaceAll(",",""))||0;if(!(e>=0))return toastrcus.error("Vui lòng nhập số lượng lớn hơn 0"),void $(this).val(parseFloat(t).format0VND(3,3,""));$(this).data("discount",e),PurchaseOrder.loadeventUpdateAmount()})),$(".paymentSupplier").change((function(){$(this).data("payment",1);let t=parseFloat($(this).val().replaceAll(",",""))||0;$(this).data("value",t),$(".discount").trigger("change")}))},loadeventUpdateAmount:function(){let t=0,e=0;$("#tablePurchaseOrder tbody tr:not(.nodata)").length>0&&$("#tablePurchaseOrder tbody tr").map((function(){t+=parseFloat($(this).find(".quantity").val().replaceAll(",",""))||0,e+=parseFloat($(this).find(".amount").val().replaceAll(",",""))||0})),$(".quantityAll").html(t.format0VND(3,3,"")),$(".quantityAll").data("value",t),$(".totalAll").html(e.format0VND(3,3,"")),$(".totalAll").data("value",e);let a=parseFloat($(".discount").val().replaceAll(",",""))||0,n=e-a;if($(".amountAll").html(n.format0VND(3,3,"")),$(".amountAll").data("value",n),0==parseInt($(".paymentSupplier").data("payment")))$(".paymentSupplier").val(n.format0VND(3,3,"")),$(".paymentSupplier").data("value",n),$(".paydebt").data("value",0);else{let t=parseFloat($(".paymentSupplier").val().replaceAll(",",""))||0;$(".paydebt").html((t-n).format0VND(3,3,"")),$(".paydebt").data("value",t-n)}},loadeventbutonSubmit:function(){$(".btn-saves").click((function(){PurchaseOrder.loadeventSave(EnumStatusPurchaseOrder.DA_NHAP_HANG)})),$(".btn-temporarySave").click((function(){PurchaseOrder.loadeventSave(EnumStatusPurchaseOrder.PHIEU_TAM)}))},loadeventSave:function(t){let e=[];if(0==$("#tablePurchaseOrder tbody tr:not(.nodata)").length)Swal.fire({title:"Đơn nhập hàng đang trống vui lòng chọn hàng hóa?",text:"Bạn có muốn tiếp tục nhập đơn hàng không?",icon:"error",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Trở về danh sách nhập hàng!",cancelButtonText:"Đồng ý"}).then((t=>{t.isConfirmed&&(location.href="/selling/purchaseorder")}));else{if(""==$(".PaymentMethod").val())return void toastrcus.error("Vui lòng chọn hình thức thanh toán");if($("#tablePurchaseOrder tbody tr").map((function(){let t=$(this).find(".code").text(),a=$(this).find(".name").data("name"),n=parseFloat($(this).find(".quantity").val().replaceAll(",","")),i=parseFloat($(this).find(".price").val().replaceAll(",","")),o=parseFloat($(this).find(".discountpro").val().replaceAll(",","")),l=parseFloat($(this).find(".amount").val().replaceAll(",",""));if(n<=0)return void toastrcus.error("Số lượng phải lớn hơn không của hàng hóa: "+a);let r={};r.Code=t,r.Name=a,r.Quantity=n,r.Price=i,r.DiscountAmount=o,r.Total=l,e.push(r)})),0==e.length)return void toastrcus.error("Vui lòng lựa chọn hàng hóa cần nhập hàng");let a=$("form#create-formProduct"),n=parseFloat(a.find(".totalAll").data("value"))||0,i=parseFloat(a.find(".amountAll").data("value"))||0,o=parseFloat(a.find(".discount").data("discount"))||0,l=parseFloat(a.find(".quantityAll").data("value"))||0,r=parseFloat(a.find(".paymentSupplier").data("value"))||0,s=parseFloat(a.find(".paydebt").data("value"))||0,d=a.find(".notePurchaseOrder").val(),c=TypePurchaseOrder.NHAP_HANG,u=$("#CreateDate").val();$.ajax({type:"POST",url:"/Selling/PurchaseOrder/Create",data:{IdSuppliers:$(".Suppliersid").val(),IdPayment:$(".PaymentMethod").val(),JsonItem:JSON.stringify(e),Quantity:l,Total:n,DiscountAmount:o,Amount:i,AmountSuppliers:r,DebtAmount:s,Note:d,CreateDate:u,Type:c,Status:t},success:function(t){t.isValid&&Swal.fire({title:"Nhập hàng thành công?",text:"Bạn có muốn tiếp tục nhập đơn hàng mới không?",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Trở về danh sách nhập hàng!",cancelButtonText:"Đồng ý"}).then((t=>{if(t.isConfirmed)location.href="/selling/purchaseorder";else{let t=' <tr class="nodata">\n                                        <td colspan="7">Chưa có dữ liệu</td>\n                                    </tr>';$("#txtPurchaseOrderSearch").val(""),$("#tablePurchaseOrder tbody").html(t),PurchaseOrder.loadeventUpdateAmount()}}))},error:function(t){console.log(t)}})}},loadeventShowdetail:function(t,e){$.ajax({type:"GET",url:"/Selling/purchaseorder/View?secret="+t+"&Type="+e,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                                popupform-payment\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate animate__animated popupform-payment animate__fadeOutRight animate__faster"},showCloseButton:!0,title:"Chi tiết đơn hàng nhập",html:t.html,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='fas fa-cancel'></i>Hủy bỏ</button><button class='mr-3 btn btn-save btn-success'><i class='fas fa-check mr-2'></i>Lưu</button><button class='mr-3 btn btn-purchaseorder btn-warning'><i class='fas fa-undo-alt mr-2'></i>Trả hàng</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{loaddaterangepicker(!0),$(".number3").each((function(){let t=$(this).text().replaceAll(".","");$(this).html(parseFloat(t).format0VND(0,3,""))})),$(".btn-continue").click((function(){Swal.close()})),$(".btn-purchaseorder").click((function(){Swal.close(),location.href="/selling/PurchaseOrder/PurchaseReturns/"+$("#PurchaseOrderId").val()})),loaddataSelect2("/API/Handling/GetAllSupller",".Suppliersid",t.idSuppliers),loaddataSelect2("/API/Handling/GetAllPaymentMethod",".PaymentMethod",t.idPayment,"Chọn hình thức thanh toán"),$(".btn-save").data("id",t.idData),$(".btn-save").click((function(){PurchaseOrder.eventSaveIndetailt($(this).data("id"))}))}})},error:function(t){console.log(t)}})},eventSaveIndetailt:function(t){let e=$("#CreateDate").val();if(""==e.trim())return void toastrcus.error("Vui lòng chọn ngày nhận hàng");let a=$("#NotePurchaseReturns").val(),n=TypePurchaseOrder.NHAP_HANG;$.ajax({type:"POST",url:"/Selling/PurchaseOrder/Update",data:{IdSuppliers:$(".Suppliersid").val(),IdPayment:$(".PaymentMethod").val(),Id:t,Note:a,CreateDate:e,Type:n},success:function(t){t.isValid&&Swal.fire({title:"Cập nhật thành công?",icon:"success",showCancelButton:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Trở về danh sách nhập hàng!",cancelButtonText:"Đồng ý"}).then((t=>{t.isConfirmed&&(dataTableOut.draw("page"),Swal.close())}))},error:function(t){console.log(t)}})}},eventBanle={enableOrDisnableSancanbarCode:function(t){t?$(document).scannerDetection({timeBeforeScanTest:200,avgTimeByChar:100,onComplete:function(t,e){""==t?toastrcus.error("Không tìm thấy mã barcode"):eventBanle.eventAddProductBySancanBarcode(t)},onError:function(t,e){}}):$(document).scannerDetection(!1)},changeTypeInvoice:function(t){$.ajax({type:"POST",url:"/Selling/SaleRetail/ConvertInvoice",data:{IdOrder:$(t).parent().data("id")},success:function(t){t.isValid},error:function(t){console.log(t)}})},clearDataorder:function(){$(".action-inv li.active").data("id",0);$("#container-tableOder").html('<div  role="tabpanel">\n                             <div class="tab-pane " id="tab-order-0" role="tabpanel">\n                                <div class="no-order">\n                                    <img src="../images/shopping.png" />\n                                    <b>Chưa có hàng hóa nào được chọn</b>\n                                    <span>Vui lòng chọn hàng hóa</span>\n                                </div>\n                            </div>\n                        </div>'),$(".fullamount").html(0),$(".cuspayment").html(0),$(".amoutchange").html(0),$(".discountamount").val(0),$(".cussendamount").val(0),$(".VATAmount").length>0&&$(".VATAmount").val(0),$(".box-data-customer .btn-cleardata").trigger("click"),_classPosEvent.input_searchProduct.val("")},loadeventchangeclickprice:function(){$("#item-mon li .price").unbind(),$("#item-mon li .price").click((function(){let t=parseFloat($(this).data("price"))||0,e=parseFloat($(this).data("pricenew"))||0,a=parseFloat($(this).data("discountamount"))||0,n=parseFloat($(this).data("discount"))||0,i=parseInt($(this).data("typediscount"));1==i&&(a=n);let o='<div id="popupselectDiscount" class="popup-change-price">\n                                                   <div class="overlazy"></div>\n                                                   <div class="ele-discount ele-SaleRetail" id="ousSizeOutPopup">\n                                                        <div class="item">\n                                                            <span>Đơn giá bán: </span>\n                                                            <div class="content">\n                                                                <div class="text">\n                                                                    <input class="data-value form-control number3 giaban" placeholder="Nhập số tiền" value='+t+' />\n                                                                </div>\n                                                            </div>\n                                                         </div>\n                                                         <div class="item">\n                                                            <span>Giảm giá: </span>\n                                                            <div class="content">\n                                                                <div class="text">\n                                                                    <input class="data-value form-control number3 giamgia" value="'+a+'" data-value="'+a+'" data-type="'+i+'"/>\n                                                                    <button type="button" data-value="0" class="btn btn-action  btn-amountselect">VND</button>\n                                                                    <button type="button" data-value="1" class="btn btn-action btn-percent">%</button>\n                                                                </div>\n                                                            </div>\n                                                         </div>\n                                                         <div class="item">\n                                                            <span>Giá bán mới: </span>\n                                                            <div class="content">\n                                                                <div class="text">\n                                                                    <input class="data-value form-control number3 giamoi" placeholder="Nhập số tiền" value='+e+" />\n                                                                </div>\n                                                            </div>\n                                                         </div>\n                                                    </div>\n                                                </div>";$(this).after(o),0==i||-1==i?$(".btn-amountselect").addClass("btn-primary"):$(".btn-percent").addClass("btn-primary"),evetnFormatTextnumber3(),evetnFormatnumber3(!1),eventBanle.loadeventChangePricenewAndDiscountItem(),$(".popup-change-price").find("input.giamoi").select(),$(".popup-change-price").find("input.giamoi").select(),eventBanle.loadEventSelectInputPopupPrice()}))},loadEventSelectInputPopupPrice:function(){$(".popup-change-price").find("input.giamoi").click((function(){$(this).select()})),$(".popup-change-price").find("input.giaban").click((function(){$(this).select()})),$(".popup-change-price").find("input.giamgia").click((function(){$(this).select()}))},loadeventChangePricenewAndDiscountItem:function(){function t(t=-1){let e=parseFloat($(".giaban").val().replaceAll(",",""))||0,a=parseFloat($(".giamgia").val().replaceAll(",",""))||0,n=parseFloat($(".giamoi").val().replaceAll(",",""))||0,i=0,o=parseInt($("#ousSizeOutPopup .content button.btn-primary").data("value")),l=0;if(0==o)a>e&&($(".giamgia").val(e.format0VND(3,3)),toastrcus.error("Giá trị giảm giá không được vượt quá giá gốc"),a=e),l=e-a;else{if(1!=o)return void toastrcus.error("Giá trị không hợp lệ");a>100&&($(".giamgia").val(100),a=100,toastrcus.error("Giá trị % giảm giá không hợp lệ")),i=e*parseFloat(a/100),l=e-i}2==t||3==t?($(".giamoi").parents(".ele-price").find(".price").val(n.format0VND(3,3)),$(".giamoi").parents(".ele-price").find(".price").data("pricenew",n)):($(".giamoi").val(l.format0VND(3,3)),$(".giamoi").parents(".ele-price").find(".price").val(l.format0VND(3,3)),$(".giamoi").parents(".ele-price").find(".price").data("pricenew",l)),$(".giamoi").parents(".ele-price").find(".discountAmountItemPro").remove(),a>0||i>0?(htmldiscount="",0==o?(htmldiscount="<span class='discountAmountItemPro'>"+(-1*a).format0VND(0,3)+"</span>",$(".giamoi").parents(".ele-price").find(".price").data("discount",0),$(".giamoi").parents(".ele-price").find(".price").data("discountamount",a)):1==o&&(htmldiscount="<span class='discountAmountItemPro'>"+(-1*a).format0VND(0,3)+"%</span>",$(".giamoi").parents(".ele-price").find(".price").data("discount",a),$(".giamoi").parents(".ele-price").find(".price").data("discountamount",i)),$(".giamoi").parents(".ele-price").find(".price").after(htmldiscount)):($(".giamoi").parents(".ele-price").find(".price").data("discount",0),$(".giamoi").parents(".ele-price").find(".price").data("discountamount",0)),$(".giamoi").parents(".ele-price").find(".price").data("typediscount",o),function(){let t=parseFloat($(".giamoi").parents("li").find(".quantity").val().replaceAll(",",""))||0,e=parseFloat($(".giamoi").val().replaceAll(",",""))||0;$(".giamoi").parents("li").find(".total").children("b").html((t*e).format0VND(3,3)),$(".giamoi").parents("li").find(".total").children("b").data("total",t*e),eventBanle.loadChangeItemOrderLoca()}()}$("#ousSizeOutPopup .content button").on("click",(function(e){if(!$(this).hasClass("btn-primary")){$(this).parent().find(".btn-primary").toggleClass("btn-primary"),$(this).toggleClass("btn-primary");let e=parseInt($(this).data("value"))||0,a=parseFloat($(".giamgia").data("value"))||0,n=parseInt($(".giamgia").data("type")),i=0;if(0==e){let i=parseFloat($(".giamgia").val().replaceAll(",",""))||0;if(i>0){let o=0,l=parseFloat($(".giaban").val().replaceAll(",",""))||0;o=n==e?a:l*(i/100),$(".giamgia").val(o.format0VND(3,3)),t(3)}}else{if(1!=e)return void toastrcus.error("Giá trị không hợp lệ");{let o=parseFloat($(".giamgia").val().replaceAll(",",""))||0;if(o>0){let l=parseFloat($(".giaban").val().replaceAll(",",""))||0;if(i=n==e?a:parseFloat((100*parseFloat(o/l)).toFixed(2)),i>100)return $(".giamgia").val(100),t(),void toastrcus.error("Giá trị % không hợp lệ");$(".giamgia").val(i.format0VND(3,3)),t(3)}}}}})),$(".giamgia").change((function(){let e=parseInt($("#ousSizeOutPopup .content button.btn-primary").data("value")),a=parseFloat($(this).val().replaceAll(",",""));$(this).data("value",a),$(this).data("type",parseInt(e)),t()})),$(".giaban").change((function(){let e=parseFloat($(".giaban").val());$(".giamoi").val(parseFloat($(".giaban").val().replaceAll(",","")).format0VND(3,3)),$(".giamgia").val(""),$(".giamgia").data("value",0),$(".giamoi").parents(".ele-price").find(".price").data("price",e),t()})),$(".giamoi").keyup((function(){let e=parseFloat($(".giaban").val().replaceAll(",",""))||0,a=parseFloat($(this).val().replaceAll(",",""))||0,n=a-e;if(n>0)$(".giamgia").val(0),$(".giamgia").data("value",0),$(".giamoi").parents(".ele-price").find(".price").data("discount",0),$(".giamoi").parents(".ele-price").find(".price").data("discountamount",0),$(".giamoi").parents(".ele-price").find(".price").data("typediscount",-1);else{n*=-1;let t=parseInt($("#ousSizeOutPopup .content button.btn-primary").data("value"));if(0==t)$(".giamgia").val(n.format0VND(3,3)),$(".giamgia").data("value",n),$(".giamoi").parents(".ele-price").find(".price").data("discount",0);else{let t=parseFloat((n/e*100).toFixed(2));$(".giamgia").val(t.format0VND(3,3)),$(".giamgia").data("value",t),$(".giamoi").parents(".ele-price").find(".price").data("discount",t)}$(".giamoi").parents(".ele-price").find(".price").data("discountamount",n),$(".giamoi").parents(".ele-price").find(".price").data("typediscount",t)}$(".giamoi").parents(".ele-price").find(".price").val(a.format0VND(3,3)),t(2)})),$(".overlazy").on("click",(function(t){0===$(t.target).closest("#ousSizeOutPopup").length&&($("#popupselectDiscount").remove(),$(".overlazy").remove())}))},loadeventclickdiscount:function(){$(".discountamount").click((function(){$(".discountamount").after('<div id="popupselectDiscount">\n                                                   <div class="overlazy"></div>\n                                                   <div class="ele-discount" id="ousSizeOutPopup">\n                                                        <span> Giảm giá theo: </span>\n                                                        <div class="content">\n                                                            <div class="form-check-inline">\n                                                              <label class="form-check-label mr-3">\n                                                                <input type="radio" class="form-check-input" id="radio1" name="optradiocheckboxdis" value="2" checked> Số tiền (VND)\n                                                              </label>\n                                                              </div>\n                                                              <div class="form-check-inline">\n                                                              <label class="form-check-label">\n                                                                <input type="radio" class="form-check-input" id="radio2" name="optradiocheckboxdis" value="1"> Phần trăm (%)\n                                                              </label>\n                                                            </div>\n                                                            <div class="text">\n                                                                <input class="data-value form-control number3" id="discounttypevalue" placeholder="Nhập số tiền" />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>'),evetnFormatnumber3(!1),eventBanle.showPopupSelectDiscount()})),$(".overlazy").click()},showPopupSelectDiscount:function(){var t=TypeSelectDiscount.Cash;let e=0,a=0,n=parseInt($(".discountamount").data("discount"))||0;function i(){if(t==TypeSelectDiscount.Cash){let t=parseFloat($("#discounttypevalue").val().replaceAll(",",""))||0;e=t,$(".discountamount").val(t.format0VND(3,3)),$(".discountamount").data("value",t),$(".discountamount").data("discount",0)}else if(t==TypeSelectDiscount.Percent){let t=parseFloat($(".fullamount").text().replaceAll(",","")),e=parseFloat($("#discounttypevalue").val().replaceAll(",","")),n=Math.round(parseFloat(t*(e/100)));a=e,$(".discountamount").val(n.format0VND(3,3)),$(".discountamount").data("value",e),$(".discountamount").data("discount",e)}$(".discountamount").data("type",t),eventBanle.eventLoadCongThucTien(),eventBanle.saveUpdateAmountLoca(t)}void 0===$(".discountamount").data("type")&&(n>0?($(".discountamount").data("type",TypeSelectDiscount.Percent),$(".discountamount").data("value",n)):($(".discountamount").data("type",TypeSelectDiscount.Cash),$(".discountamount").data("value",$(".discountamount").val().replaceAll(",","")))),void 0!==$(".discountamount").data("type")&&(t=parseInt($(".discountamount").data("type"))||0,value=parseInt($(".discountamount").data("value"))||0,$("input:radio[value="+t+"][name='optradiocheckboxdis']").prop("checked",!0),$("#discounttypevalue").val(value),t==TypeSelectDiscount.Cash?e=value:t==TypeSelectDiscount.Percent&&(a=value)),$("input:radio[name=optradiocheckboxdis]").change((function(){let n=$("input[name='optradiocheckboxdis']:checked").val();n==TypeSelectDiscount.Cash?(t=TypeSelectDiscount.Cash,$("#discounttypevalue").val(e.format0VND(3,3))):n==TypeSelectDiscount.Percent&&(t=TypeSelectDiscount.Percent,$("#discounttypevalue").val(a.format0VND(3,3))),i(),$("#discounttypevalue").select(),setTimeout((()=>{$("#discounttypevalue").select()}),150)})),$("#discounttypevalue").keyup((function(){0==t&&(t=parseInt($(".discountamount").data("discount"))),i()})),$(".overlazy").on("click",(function(t){0===$(t.target).closest("#ousSizeOutPopup").length&&$("#popupselectDiscount").remove()})),setTimeout((()=>{$("#discounttypevalue").select()}),200)},eventLoadCongThucTien:function(){let t=$(".fullamount").text().replaceAll(",","")||0,e=$(".discountamount").val().replaceAll(",","")||0,a=parseFloat(t)-parseFloat(e)||0,n=0;$("#Vatrate").length>0&&(n=Math.round(a*(parseFloat($("#Vatrate").val()||0)/100)),$(".VATAmount").val(n.format0VND(0,3,"")));let i=a+n;$(".cuspayment").html(i.format0VND(0,3,""));let o=$(".cussendamount").val().replaceAll(",","")||0;1==$(".cussendamount").data("select")?(o=parseFloat(o.replaceAll(",","")),$(".cussendamount").html((o-i).format0VND(0,3,""))):($(".cussendamount").val(i.format0VND(0,3,"")),$(".cuspay").val(i.format0VND(0,3,"")),$(".amoutchange").html(0))},saveUpdateAmountLoca:function(t){let e=0;-1!=t&&(e=parseFloat($("#discounttypevalue").val().replaceAll(",",""))||0);let a=parseFloat($(".discountamount").val().replaceAll(",",""))||0,n=$("ul.action-inv li.active").data("id"),i=localStorage.getItem("ProductsArrays");if(void 0!==i&&null!=i){let o=JSON.parse(i);if(o.length>0){let i=o.findIndex((t=>t.Id==n));if(-1!=i){let n=0,l=0;$("#Vatrate").length>NOVATRate&&(n=parseFloat($(".VATAmount").val().replaceAll(",","")),l=parseFloat($("#Vatrate").val()));let r=o[i];r.VATAmount=n,r.VATRate=l,r.DiscountAmount=a,r.Amount=r.Total-a+n,-1!=t&&(t==TypeSelectDiscount.Percent?r.Discount=e:r.Discount=0),o[i]=r,localStorage.setItem("ProductsArrays",JSON.stringify(o))}else toastrcus.error("Đơn hàng không tồn tại vui lòng tải lại trang!")}else toastrcus.error("Chưa có đơn được tạo!")}else toastrcus.error("Lỗi hệ thống, vui lòng tải lại trang")},eventPaymentInvoice:async function(t){var e={};return $.ajax({type:"POST",global:!1,async:!1,url:"/Selling/OrderTable/PaymentSaleRatailt",data:{jsonData:JSON.stringify(t)},success:function(t){t.isValid?(e.Html=t.data,e.IsSuccess=!0):e.IsSuccess=!1},error:function(t){console.log(t)}}),e},paymentInoffline:function(){$(".btn-payment").click((function(){let t=$(".action-inv li.active").data("id");if("0"==t)return toastrcus.error("Chưa có đơn hàng nào để thanh toán!"),!1;let e=localStorage.getItem("ProductsArrays");if(void 0===e||null==e)return toastrcus.error("Chưa có đơn hàng nào để thanh toán!"),!1;{let a=JSON.parse(e);if(a.length>0){let e=parseFloat($(".cussendamount").val().replaceAll(",",""))||0,n=parseFloat($(".amoutchange").html().replaceAll(",",""))||0,i=a.findIndex((e=>e.Id==t));if(-1!=i){let t=a[i];t.CusSendAmount=e,t.AmountChangeCus=n,loadingStart(),t.VATMTT?$.ajax({type:"GET",url:"/Selling/Invoice/SuppliersEInvoice?SaleRetail=1",contentType:!1,processData:!1,success:function(e){e.isValid&&(footer="<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Tiếp tục</button>",e.nodata||(footer="<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Đã hiểu</button>"),Swal.fire({title:e.title,html:e.html,showClass:{popup:"popup-formcreate"},footer:footer,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{loadingStop(),$(".btn-continue").click((function(){Swal.close()})),$("#ManagerPatternEInvoices").select2({placeholder:{id:"",text:"Chọn mẫu số và ký hiệu hóa đơn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$(".btn-save").click((async function(){loadingStart();let e=$(".selectSupplerInoice").find("#ManagerPatternEInvoices").val();""!=e?(t.IdPattern=parseInt(e),Swal.close(),await eventBanle.eventPaymentInvoice(t).then((function(t){loadingStop(),t.IsSuccess&&(eventBanle.clearDataorder(),Swal.close(),""!=t.Html&&printDiv(t.Html),a.splice(i,1),localStorage.setItem("ProductsArrays",JSON.stringify(a)))}))):toastrcus.error("Vui lòng chọn mẫu số ký hiệu hóa đơn")}))}}))},error:function(t){console.log(t)}}):eventBanle.eventPaymentInvoice(t).then((function(t){loadingStop(),t.IsSuccess&&(eventBanle.clearDataorder(),Swal.close(),""!=t.Html&&printDiv(t.Html),a.splice(i,1),localStorage.setItem("ProductsArrays",JSON.stringify(a)))}))}else toastrcus.error("Đơn hàng không tồn tại vui lòng tải lại trang!")}else toastrcus.error("Đơn hàng không tồn tại vui lòng tải lại trang!")}}))},payment:function(){$(".btn-payment").click((function(){let t=$(".action-inv li.active").data("id");if("0"==t)return toastrcus.error("Chưa có đơn hàng nào để thanh toán!"),!1;let e=parseFloat($(".discountamount").val().replaceAll(",",""))||0,a=parseFloat($(".cuspayment").text().replaceAll(",",""))||0,n=parseFloat($(".cussendamount").val().replaceAll(",",""))||0,i=$("input[name=idPaymentMethod]:checked",".paymentMethod").data("id")||0;var o="",l=!1;if("true"==localStorage.getItem("VATMTT")&&(l=!0),l){let l=parseFloat($(".VATAmount").val().replaceAll(",",""))||0,r=parseFloat($("#Vatrate").val())||0;$.ajax({type:"GET",url:"/Selling/Invoice/SuppliersEInvoice?SaleRetail=1",contentType:!1,processData:!1,success:function(s){s.isValid&&(footer="<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",s.nodata||(footer="<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Đã hiểu</button>"),Swal.fire({title:s.title,html:s.html,showClass:{popup:"popup-formcreate"},footer:footer,allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".btn-continue").click((function(){Swal.close()})),$("#ManagerPatternEInvoices").select2({placeholder:{id:"",text:"Chọn mẫu số và ký hiệu hóa đơn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$(".btn-save").click((function(){let s=$(".selectSupplerInoice").find("#ManagerPatternEInvoices").val();""!=s?$.ajax({type:"POST",url:"/Selling/OrderTable/CheckOutOrder",data:{TypeUpdate:_TypeUpdatePos.CheckOutOrder,IdOrder:t,discountPayment:e,cuspayAmount:n,vat:!0,Vatrate:r,Amount:a,VATAmount:l,Idpayment:i,ManagerPatternEInvoices:s},success:function(t){t.isValid&&(eventBanle.clearDataorder(),Swal.close(),""!=(o=t.data)&&printDiv(o))},error:function(t){console.log(t)}}):toastrcus.error("Vui lòng chọn mẫu số ký hiệu hóa đơn")}))}}))},error:function(t){console.log(t)}})}else $.ajax({type:"POST",url:"/Selling/OrderTable/CheckOutOrder",data:{TypeUpdate:_TypeUpdatePos.CheckOutOrder,IdOrder:t,discountPayment:e,cuspayAmount:n,Idpayment:i},success:function(t){t.isValid&&(eventBanle.clearDataorder(),Swal.close(),""!=(o=t.data)&&printDiv(o))},error:function(t){console.log(t)}})}))},loadAddTabOrderInvoice:function(){$("#sellting-banle .btn-addInvoice").click((function(t){let e=!0;if($(".action-inv").find("li").not($(this)).map((function(t,a){"0"==$(this).data("id")&&(e=!1)})),!e)return!1;if($(".action-inv").find("li").not($(this)).length>4)return toastr.warning("Mỗi bàn tối đa 4 đơn chưa thanh toán, vui lòng thanh toán bớt để order thêm!"),!1;let a=makeid(5);var n=$(".action-inv li.item-order").length+1;$(".action-inv").find("li.active").removeClass("active"),0==$(".action-inv li.item-order").length?$(this).parents(".action-inv").find("li").before('<li data-id="0" class="active item-order '+a+'"><i class="fa fa-exchange"></i><span>Hóa đơn 1</span> <i class="fas fa-times"></i></li>'):$(this).parents(".action-inv").find("li:nth-child("+(n-1)+")").after('<li data-id="0" class="active item-order '+a+'"><i class="fa fa-exchange"></i><span>Hóa đơn '+n+'</span> <i class="fas fa-times"></i></li>');$("#container-tableOder").html('<div  role="tabpanel">\n                             <div class="tab-pane " id="tab-order-0" role="tabpanel">\n                                <div class="no-order">\n                                    <img src="../images/shopping.png" />\n                                    <b>Chưa có hàng hóa nào được chọn</b>\n                                    <span>Vui lòng chọn hàng hóa</span>\n                                </div>\n                            </div>\n                        </div>'),eventBanle.loadEventClickTabInvoiceShowData(a),eventBanle.loadEventRemoveTaborder(a,!0),eventBanle.loadEventResetCusomter(),eventBanle.loadAmoutAndQuantity(0,0),$(".discountamount").data("discount",0),$(".discountamount").data("value",0),$(".discountamount").data("type",TypeSelectDiscount.Cash)}))},loadEventClickTabInvoiceShowData:function(t){$(".action-inv").find("li."+t).click((async function(){if(!$(this).hasClass("active")){$(".action-inv").find("li.active").not($(this)).removeClass("active"),$(this).addClass("active");let t=$(this).data("id");await eventBanle.loadDataInvoiceOffline(t),localStorage.setItem("activeInvoicetab",$(this).index())}}))},loadEventRemoveTaborder:function(t,e=!0){e?$(".action-inv").find("li."+t).find("i:last-child").click((async function(){let t=$(this).parent("li.item-order").data("id");if("0"==t){$(this).parent("li.item-order").remove();let t='<div role="tabpanel">\n                             <div class="tab-pane " id="tab-order-0" role="tabpanel">\n                                <div class="no-order">\n                                    <img src="../images/shopping.png" />\n                                    <b>Chưa có hàng hóa nào được chọn</b>\n                                    <span>Vui lòng chọn hàng hóa</span>\n                                </div>\n                            </div>\n                        </div>';$("#container-tableOder").html(t),0==$(".action-inv").find(".item-order").length?$(".action-inv").find(".btn-addInvoice").trigger("click"):$(".action-inv li:first").trigger("click")}else eventBanle.removeOderOffline($(this),t)})):$(t).find("li").not(".add-tab").find("i:last-child").click((async function(){let t=$(this).parent("li.item-order").data("id");if("0"==t){$(this).parent("li.item-order").remove();let t='<div role="tabpanel">\n                             <div class="tab-pane " id="tab-order-0" role="tabpanel">\n                                <div class="no-order">\n                                    <img src="../images/shopping.png" />\n                                    <b>Chưa có hàng hóa nào được chọn</b>\n                                    <span>Vui lòng chọn hàng hóa</span>\n                                </div>\n                            </div>\n                        </div>';$("#container-tableOder").html(t),0==$(".action-inv").find(".item-order").length?$(".action-inv").find(".btn-addInvoice").trigger("click"):$(".action-inv li:first").trigger("click")}else eventBanle.removeOderOffline($(this),t)}))},removeOder:function(t,e){let a=e;Swal.fire({icon:"warning",title:"Bạn có chắc chắn muốn xóa đơn không?",showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Đóng"}).then((e=>{e.isConfirmed&&$.ajax({type:"POST",url:"/Selling/OrderTable/RemoveOderInvoice",data:{TypeUpdate:_TypeUpdatePos.RemoveOrder,IdOrder:a},success:function(e){e.isValid&&($(t).parent().remove(),0==$(".action-inv li:not(.add-tab)").length?$(".action-inv li.add-tab .btn-addInvoice").trigger("click"):$(".action-inv li:first").trigger("click"))},error:function(t){console.log(t)}})}))},loadEventCheckEnableBarcode:function(){1==localStorage.getItem("Barcode")&&($(".btn-barcode").addClass("active"),toastrcus.success("Bật chế độ quét mã QRcode/Barcode"),eventBanle.enableOrDisnableSancanbarCode(!0))},loadeventClickBarcode:function(){$(".btn-barcode").click((function(){$(this).hasClass("active")?(localStorage.setItem("Barcode",0),$(this).removeClass("active"),toastrcus.warning("Hủy chế độ quét mã QRcode/Barcode"),eventBanle.enableOrDisnableSancanbarCode(!1)):(localStorage.setItem("Barcode",1),$(this).addClass("active"),toastrcus.success("Bật chế độ quét mã QRcode/Barcode"),eventBanle.enableOrDisnableSancanbarCode(!0))}))},loadRemovetab:function(){0==$(".action-inv li:not(.add-tab):not(.active)").length?($(".action-inv li.active").data("id",0),eventBanle.loadDataInvoice(0)):($(".action-inv li.active").remove(),$(".action-inv li:first-child").trigger("click"))},eventresetpaymentinput:function(){$(".fullamount").html(0),$(".discountamount").val(0),$(".VATAmount").val(0),$(".cuspayment").html(0),$(".amoutchange").html(0),$(".cussendamount").val(0)},loadChangeItemOrderLoca:function(t){ProductsArrays=[],ProductsArray={},Products=[];var e=0,a=0,n=NOVATRate,i=0,o=0;if(0==$("ul#item-mon").find("li").length){html='<div role="tabpanel">\n                             <div class="tab-pane " id="tab-order-0" role="tabpanel">\n                                <div class="no-order">\n                                    <img src="/images/shopping.png">\n                                    <b>Chưa có hàng hóa nào được chọn</b>\n                                    <span>Vui lòng chọn hàng hóa</span>\n                                </div>\n                            </div>\n                        </div>',$("#container-tableOder").html(html),eventBanle.eventresetpaymentinput();let e=localStorage.getItem("ProductsArrays");if(void 0!==e&&null!=e){let a=JSON.parse(e);if(a.length>0){let e=t;var l=a.findIndex((t=>t.Id==e));a.splice(l,1),localStorage.setItem("ProductsArrays",JSON.stringify(a))}else localStorage.setItem("ProductsArrays","[]")}else localStorage.setItem("ProductsArrays","[]")}else{let t=$("ul.action-inv li.active").data("id");$("ul#item-mon").find("li").map((function(t,a){product={};let n=$(this).data("idpro"),i=$(this).data("code"),o=$(this).find(".name").data("name"),l=parseFloat($(this).find(".quantity").val())||0,r=parseFloat($(this).find(".price").data("price"))||0,s=parseFloat($(this).find(".price").data("pricenew"))||0,d=parseFloat($(this).find(".price").data("retailPrice"))||0,c=parseFloat($(this).find(".price").data("typediscount")),u=parseFloat($(this).find(".price").data("discountamount"))||0,p=parseFloat($(this).find(".price").data("discount"))||0,h=parseFloat($(this).find(".total").find("b").data("total"))||0;product.Id=n,product.Code=i,product.Name=o,product.Price=r,product.PriceNew=s,product.RetailPrice=d,product.Quantity=l,product.Typediscount=c,product.Discount=p,product.DiscountAmount=u,product.Amount=h,Products.push(product),e+=h})),$(".fullamount").html(e.format0VND(3,3));let r=parseFloat($(".discountamount").val().replaceAll(",",""))||0,s=parseFloat($(".discountamount").data("discount"))||0;r>0?a=e-r:($(".discountamount").val(0),a=e),$("#Vatrate").length>0&&(n=parseFloat($("#Vatrate").val()),i=a*parseFloat(n/100).toFixed(2),$(".VATAmount").val(i.format0VND(3,3))),o=i+a,$(".cuspayment").html(o.format0VND(3,3)),$(".cussendamount").val(o.format0VND(0,3,"")),$(".amoutchange").val(0);let d=$(".search-customer").val(),c="";""!=d.trim()?(d=d.split(" ")[0],name=d.split(" ")[1],c=$(".search-customer").data("id"),Customer={},Customer.Id=c,Customer.Name=name,Customer.CusCode=d):Customer={},"true"==localStorage.getItem("VATMTT")?ProductsArray.VATMTT=!0:ProductsArray.VATMTT=!1;let u=$("input[name=idPaymentMethod]:checked",".paymentMethod").data("id")||0;ProductsArray.IdPaymentMethod=u,ProductsArray.Customer=Customer,ProductsArray.Items=Products,ProductsArray.Total=e,ProductsArray.DiscountAmount=r,ProductsArray.Discount=s,ProductsArray.VATRate=n,ProductsArray.VATAmount=i,ProductsArray.Amount=o,ProductsArray.CusSendAmount=0,ProductsArray.Amoutchange=0,ProductsArray.IdPattern=null,ProductsArray.Id=t,ProductsArrays.push(ProductsArray);let p=localStorage.getItem("ProductsArrays");if(void 0!==p&&null!=p){let e=JSON.parse(p);if(e.length>0)-1!=(l=e.findIndex((e=>e.Id==t)))?(e[l]=ProductsArray,localStorage.setItem("ProductsArrays",JSON.stringify(e))):(e.push(ProductsArray),localStorage.setItem("ProductsArrays",JSON.stringify(e)));else localStorage.setItem("ProductsArrays",JSON.stringify(ProductsArrays))}else localStorage.setItem("ProductsArrays",JSON.stringify(ProductsArrays))}eventBanle.loadSugetionPayment()},eventUpdatedataItemMonOrder:function(){$("#container-tableOder ul#item-mon").children("li").map((function(){let t=$(this).data("idpro"),e=$(this).data("id"),a=$(this).data("sl"),n=$(this).data("slnotify");$(this).removeAttr("data-id"),$(this).removeAttr("data-idpro"),$(this).removeAttr("data-sl"),$(this).removeAttr("data-slnotify"),$(this).data("idpro",t),$(this).data("id",e),$(this).data("sl",a),$(this).data("slnotify",n)}))},loadEventCheckCodeItem:async function(t){let e=!1;return $("ul#item-mon").find("li").map((function(){($(this).data("code")||"")==t&&(e=!0,$(this).find(".item_action").find("i:last-child").trigger("click"))})),e},eventselectProductCompelteOffline:async function(t,e,a,n,i){if(!await eventBanle.loadEventCheckCodeItem(n)){let o='<ul id="item-mon"> ',l="";l+='<li data-code="'+n+'" data-idpro ="'+t+'" data-sl=1>\n                            <div  class="btn-remove" data-idquan="1"><i data-idquan="1" class="fas fa-trash-alt"></i></div>\n                            <div class="name" data-name="'+i+'"><b>'+i+'</b></div>\n                            <div class="item_action"><i class="fas fa-minus"></i><input data-quantity="1" class="quantity number3" value="1"><i class="fas fa-plus"></i></div>\n                            <div class="ele-price"><input type="text" class="form-control number3 price"  data-price="'+e+'" data-pricenew="'+e+'"  data-retailPrice="'+a+'" data-typediscount="-1" data-discountamount="0" data-discount="0" readonly value="'+e+'" /></div>\n                            <div class="total"><b class="number3" data-total="'+1*e+'">'+1*e+"</b></div>\n                        </li>",o+=l,o+="</ul>",$("ul#item-mon").length>0?$("ul#item-mon li:last-child").after(l):($(".action-inv").find("li.active").removeAttr("data-id"),$(".action-inv").find("li.active").data("id",GUID()),$("#container-tableOder").html(o))}eventBanle.loadeventchangeclickprice(),eventBanle.loadChangeItemOrderLoca(),evetnFormatTextnumber3(),eventBanle.loadEventClickIconAddAndMinusoffline(),""!=$(".search-customer").val()&&eventBanle.updateCustomerOrderOffline(0)},loadEventClickIconAddAndMinusoffline:function(){$("#item-mon  li .item_action").find("input.quantity").unbind(),$("#item-mon  li .item_action").find("input.quantity").change((function(){if($(this).val()<=0)return toastrcus.error("Số lượng không hợp lệ"),void $(this).val($(this).data("quantity"));let t=parseFloat($(this).val().replaceAll(",","")),e=parseFloat($(this).parents("li").find(".price").val().replaceAll(",",""));$(this).val(t.format0VND(3,3)),$(this).data("quantity",t),$(this).parents("li").find(".total").find("b").html((t*e).format0VND(3,3)),$(this).parents("li").find(".total").find("b").data("total",t*e),eventBanle.loadChangeItemOrderLoca()})),$("#item-mon  li .item_action").find("i").unbind(),$("#item-mon  li .item_action").find("i:first-child").click((function(){let t=parseFloat($(this).parent().find(".quantity").val().replaceAll(",",""));if(_quan=t-1,_quan<=0)return toastrcus.error("Số lượng không hợp lệ"),void $(this).val($(this).data("quantity"));let e=parseFloat($(this).parents("li").find(".price").val().replaceAll(",",""));$(this).parents("li").find(".quantity").val(_quan.format0VND(3,3)),$(this).parents("li").find(".quantity").data("quantity",_quan),$(this).parents("li").find(".total").find("b").html((_quan*e).format0VND(3,3)),$(this).parents("li").find(".total").find("b").data("total",_quan*e),eventBanle.loadChangeItemOrderLoca()})),$("#item-mon  li .item_action").find("i:last-child").click((function(){let t=parseFloat($(this).parent().find(".quantity").val().replaceAll(",",""));if(_quan=t+1,_quan<=0)return toastrcus.error("Số lượng không hợp lệ"),void $(this).val($(this).data("quantity"));let e=parseFloat($(this).parents("li").find(".price").val().replaceAll(",",""));$(this).parents("li").find(".quantity").val(_quan.format0VND(3,3)),$(this).parents("li").find(".quantity").data("quantity",_quan),$(this).parents("li").find(".total").find("b").html((_quan*e).format0VND(3,3)),$(this).parents("li").find(".total").find("b").data("total",_quan*e),eventBanle.loadChangeItemOrderLoca()})),$("#item-mon  li .btn-remove").unbind(),$("#item-mon  li .btn-remove").click((function(){$(this).parent("li").remove(),eventBanle.loadChangeItemOrderLoca()}))},loadAmoutAndQuantity:function(t=null,e=null){null!=t&&null!=e?($(".fullamount").html(parseFloat(t).format0VND(3,3,"")),""==$(".discountamount").val()&&$(".discountamount").val(0)):($(".fullamount").html(0),$(".discountamount").val(0)),eventBanle.eventLoadTFullAmount(),priceFormat(),numberFormat()},eventAddProductBySancanBarcode:function(t){let e=$(".search-customer").val();""!=e.trim()&&(e=e.split(" ")[0]),idProduct="";var a={CusCode:e,QuantityFloat:1,TypeUpdate:_TypeUpdatePos.AddProduct,IdRoomAndTableGuid:"-1",IsBringBack:!0,IdGuid:$(".action-inv").find("li.active").data("id"),IdProduct:idProduct,ProductCode:t};eventBanle.orderTable(a)},eventselectProductCompelte:function(t){let e=$(".search-product").val(),a=$(".search-customer").val();""!=a.trim()&&(a=a.split(" ")[0]),""!=e.trim()&&(e=e.split(" ")[0]);var n={CusCode:a,QuantityFloat:1,TypeUpdate:_TypeUpdatePos.AddProduct,IdRoomAndTableGuid:"-1",IsBringBack:!0,IdGuid:$(".action-inv").find("li.active").data("id"),IdProduct:t,ProductCode:e};eventBanle.orderTable(n)},loadEventChangePaumentDiscount:function(){var t=0;0==t&&(t=parseInt($(".cuspayment").html().replaceAll(",",""))),$(".cussendamount").keyup((function(){datathis=parseFloat($(this).val().replaceAll(",","")),t=parseFloat($(".cuspayment").html().replaceAll(",","")),$("ul.action-inv li.active").data("cussendamount",datathis);let e=(parseFloat($(".cussendamount").val().replaceAll(",",""))||0||0)-t;$(".amoutchange").html(e.format0VND(0,3,""))}))},loadEventChangeVATRateVATAmount:function(){$(".VATAmount").keyup((function(){let t=(parseFloat($(".fullamount").text().replaceAll(",",""))||0)-(parseFloat($(".discountamount").val().replaceAll(",",""))||0)+(parseFloat($(this).val().replaceAll(",",""))||0);$(".cuspayment").html(t.format0VND(3,3,""));let e=parseFloat($("ul.action-inv li.active").data("cussendamount"))||0;if(0!=e){let a=parseFloat(e)||0;$(".amoutchange").html((a-t).format0VND(3,3,""))}else $(".cuspayment").html(t.format0VND(3,3,"")),$(".cussendamount").val(t.format0VND(3,3,"")),$(".amoutchange").html(0);eventBanle.saveUpdateAmountLoca(-1),eventBanle.loadSugetionPayment()})),$("#Vatrate").change((function(){eventBanle.eventLoadTFullAmount(),eventBanle.saveUpdateAmountLoca(-1),eventBanle.loadSugetionPayment()}))},loadTienthuakhach:function(){amoutn=parseFloat($(".cuspayment").html().replaceAll(",",""));let t=(parseFloat($("ul.action-inv li.active").data("cussendamount"))||0||0)-amoutn;$(".amoutchange").html(t.format0VND(0,3,""))},loadEventChangeSelectAmoutpaycus:function(){$(".lst-amount-paycus span").click((function(){let t=parseInt($(this).data("value"));$(".cussendamount").val(t.format0VND(0,3,"")),$(".cussendamount").addClass("active"),$(".cussendamount").trigger("keyup")}))},loadSugetionPayment:function(){let t="",e=$(".cuspayment").text().replaceAll(",","");a=Math.ceil(parseFloat(e)),x=[...a.toString()].reverse().reduce(((t,e,a)=>(t[10**a]=e,t)),{}),x;var a;let n=0,i=Math.round(parseFloat(e));e=i.toString(),7===e.length?(n=Math.ceil(i/1e6),2==n||3==n||4==n?(1e6*n-5e5>=i&&(t+='<span class="priceFormat" data-value="'+(1e6*n-5e5)+'">'+(1e6*n-5e5)+"</span>"),t+='<span class="priceFormat" data-value="'+1e6*n+'">'+1e6*n+"</span>",t+='<span class="priceFormat" data-value="5000000">5000000</span>'):(1e6*n-5e5>=i&&(t+='<span class="priceFormat" data-value="'+(1e6*n-5e5)+'">'+(1e6*n-5e5)+"</span>"),t+='<span class="priceFormat" data-value="'+1e6*n+'">'+1e6*n+"</span>",1!=n&&(t+='<span class="priceFormat" data-value="10000000">10000000</span>'))):6===e.length?(n=Math.ceil(i/1e5),2==n||3==n||4==n?(1e5*n-5e4>=i&&(t+='<span class="priceFormat" data-value="'+(1e5*n-5e4)+'">'+(1e5*n-5e4)+"</span>"),t+='<span class="priceFormat" data-value="'+1e5*n+'">'+1e5*n+"</span>",t+='<span class="priceFormat" data-value="500000">500000</span>'):(1e5*n-5e4>=i&&(t+='<span class="priceFormat" data-value="'+(1e5*n-5e4)+'">'+(1e5*n-5e4)+"</span>"),t+='<span class="priceFormat" data-value="'+1e5*n+'">'+1e5*n+"</span>",t+='<span class="priceFormat" data-value="1000000">1000000</span>')):5===e.length&&(n=Math.ceil(i/1e4),2==n||3==n||4==n?(t+='<span class="priceFormat" data-value="'+1e6*n+'">'+1e4*n+"</span>",1e4*n-5e3>=i&&(t+='<span class="priceFormat" data-value="'+(1e4*n-5e3)+'">'+(1e4*n-5e3)+"</span>"),t+='<span class="priceFormat" data-value="50000">50000</span>',t+='<span class="priceFormat" data-value="100000">100000</span>',t+='<span class="priceFormat" data-value="200000">200000</span>',t+='<span class="priceFormat" data-value="500000">500000</span>'):(t+='<span class="priceFormat" data-value="'+1e4*n+'">'+1e4*n+"</span>",1e4*n-5e3>=i&&(t+='<span data-value="'+(1e4*n-5e3)+'">'+(1e4*n-5e3)+"</span>"),t+='<span class="priceFormat" data-value="100000">100000</span>',t+='<span class="priceFormat" data-value="200000">200000</span>',t+='<span class="priceFormat" data-value="500000">500000</span>')),$(".lst-amount-paycus").html(t),eventBanle.loadEventChangeSelectAmoutpaycus(),priceFormat()},loadAutocomplete:function(t=!0,e=!0){if(t){let t=0;_classPosEvent.input_searchProduct.blur((function(){$("#parentautocomplete").css({height:"0",top:"0","z-index":"0"})})),_classPosEvent.input_searchProduct.autocomplete({appendTo:"#parentautocomplete",autoFocus:!0,minLength:0,delay:0,source:function(t,e){$.ajax({global:!1,url:"/Selling/Pos/SearchProductPos",type:"GET",dataType:"json",data:{text:t.term,iSsell:!0},success:function(a){return e($.map(a,(function(e){let n=__highlight(e.name,t.term),i="<span class='quantity'>Tồn kho: <b>"+parseFloat(e.quantity).format0VND(3,3,"")+"</b></span>";return(a.isInventory||a.typeProductCategory==EnumTypeProductCategory.COMBO||a.typeProductCategory==EnumTypeProductCategory.SERVICE)&&(i="<span class='quantity'>Tồn kho: -- <span>"),{label:"<a href='javascript:void(0)'><div class='search-auto'><div class='img'><img src='../"+e.img+"'></div><div class='tk_name'><span>"+n+" ("+e.code+")</span><span class='price'> Giá: "+parseFloat(e.price).format0VND(3,3,"")+"</span>"+i+"</div></div></a>",value:e.code,idProduct:e.id,code:e.code,name:e.name,retailPrice:e.retailPrice,price:e.price}}))),{label:t.term,value:t.term}}})},html:!0,select:async function(e,a){$(this).val(a.item.value),$(this).data("price",parseFloat(a.item.price)),$(this).data("retailPrice",parseFloat(a.item.retailPrice)),$(this).data("code",a.item.code),$(this).data("name",a.item.name),$(this).select(),t=a.item.idProduct,await eventBanle.eventselectProductCompelteOffline(a.item.idProduct,parseFloat(a.item.price),parseFloat(a.item.retailPrice),a.item.code,a.item.name)},response:function(){}}).focus((function(){$("#parentautocomplete").css({height:"calc(100vh - 100px)",top:"52px","z-index":"5"}),$(this).autocomplete("search"),$(this).select()})),_classPosEvent.input_searchProduct.keypress((async function(e){let a=$(this).val();if(13==e.keyCode&&a.length>0){let e=$(this).data("price"),a=$(this).data("retailPrice"),n=$(this).data("code"),i=$(this).data("name");void 0!==n&&void 0!==e?await eventBanle.eventselectProductCompelteOffline(t,parseFloat(e),parseFloat(a),n,i):toastrcus.error("Dữ liệu không hợp lệ"),$(this).select()}else 0==a.length&&(t=0)}))}e&&(_classPosEvent.input_searchProduct.blur((function(){$("#parentautocomplete").css({height:"0",top:"0","z-index":"0"})})),_classPosEvent.input_searchCustomer.autocomplete({appendTo:"#parentautocomplete",autoFocus:!0,minLength:0,delay:0,source:function(t,e){$.ajax({global:!1,url:"/Selling/Customer/SearchCustomerPos",type:"GET",dataType:"json",data:{text:t.term},success:function(a){return e($.map(a,(function(e){let a=__highlight(e.name,t.term);return{label:"<a href='javascript:void(0)'><div class='search-auto'><div class='img'><img src='../"+e.img+"'></div><div class='tk_name'><span>"+a+"</span><span class='code'>Mã KH: "+e.code+" <br/> SĐT: "+e.phoneNumber+"</div></div></a>",value:e.name,idCus:e.id,code:e.code}}))),{label:t.term,value:t.term}}})},html:!0,select:async function(t,e){$(this).val(e.item.value),$(this).data("idCus",e.item.idCus),$(this).data("name",e.item.value),$(this).data("code",e.item.code),$(this).parents(".box-data-customer").find(".btn-cleardata").show(),$(this).parents(".box-data-customer").find(".btn-addCus").hide(),$(this).parents(".box-data-customer").find("input").attr("readonly","readonly"),$(this).parents(".box-data-customer").addClass("readonly");let a=$(".action-inv li.active").data("id");$("#item-mon").length>0&&void 0!==a&&await eventBanle.updateCustomerOrderOffline(0)}}).focus((function(){$("#parentautocomplete").css({height:"calc(100vh - 100px)",top:"52px","z-index":"5"}),$(this).autocomplete("search"),$(this).select()})))},eventLoadTFullAmount:async function(){let t=parseFloat($(".fullamount").text().replaceAll(",",""))||0,e=parseFloat($(".discountamount").val().replaceAll(",",""))||0;$(".discountamount").val(e.format0VND(3,3,""));let a=t-e,n=parseFloat($("#Vatrate").val())||0,i=parseFloat($(".VATAmount").data("VATAmount"))||0;0==i&&(i=Math.round(a*(n/100)));let o=a+i;$(".VATAmount").val(i.format0VND(3,3,"")),$(".cuspayment").html(o.format0VND(3,3,""));let l=parseFloat($("ul.action-inv li.active").data("cussendamount"))||0;if(0!=l){let t=parseFloat(l)||0;$(".amoutchange").html((t-o).format0VND(3,3,""))}else $(".cuspayment").html(o.format0VND(3,3,"")),$(".cussendamount").val(o.format0VND(3,3,"")),$(".amoutchange").html(0)},updateCustomerOrder:async function(t,e){(await axios({method:"post",url:"/Selling/OrderTable/UpdateCustomOrderTable",headers:{"Content-Type":"multipart/form-data"},data:{TypeUpdate:_TypeUpdatePos.ChangedCustomer,IdCustomer:t,IdGuid:e}})).data.isValid||$(".box-data-customer").find(".btn-cleardata").trigger("click")},updateCustomerOrderOffline:function(t=0){let e=parseInt($(".search-customer").data("idCus"))||0,a=$(".action-inv li.active").data("id");if(e>0&&0==t){let t=$(".search-customer").data("name"),n=$(".search-customer").data("code"),i=localStorage.getItem("ProductsArrays");if(void 0!==i&&null!=i){let o=JSON.parse(i);if(o.length>0){let i=o.findIndex((t=>t.Id==a));if(-1!=i){Customer={},Customer.Id=e,Customer.Name=t,Customer.Code=n;let a=o[i];a.Customer=Customer,o[i]=a,localStorage.setItem("ProductsArrays",JSON.stringify(o))}else toastrcus.error("Đơn hàng không tồn tại vui lòng tải lại trang!"),$(".box-data-customer").find(".btn-cleardata").trigger("click")}else toastrcus.error("Chưa có đơn được tạo!"),$(".box-data-customer").find(".btn-cleardata").trigger("click")}else toastrcus.error("Lỗi hệ thống, vui lòng tải lại trang"),$(".box-data-customer").find(".btn-cleardata").trigger("click")}else if(1==t){let t=localStorage.getItem("ProductsArrays");if(void 0!==t&&null!=t){let e=JSON.parse(t);if(e.length>0){let t=e.findIndex((t=>t.Id==a));if(-1!=t){Customer={};let a=e[t];a.Customer=Customer,e[t]=a,localStorage.setItem("ProductsArrays",JSON.stringify(e))}else toastrcus.error("Đơn hàng không tồn tại vui lòng tải lại trang!"),$(".box-data-customer").find(".btn-cleardata").trigger("click")}else toastrcus.error("Chưa có đơn được tạo!"),$(".box-data-customer").find(".btn-cleardata").trigger("click")}else toastrcus.error("Lỗi hệ thống, vui lòng tải lại trang"),$(".box-data-customer").find(".btn-cleardata").trigger("click")}},loadEventremoveCustomer:function(){$(".box-data-customer").find(".btn-cleardata").unbind(),$(".box-data-customer").find(".btn-cleardata").click((async function(){$(this).parents(".box-data-customer").find(".btn-cleardata").hide(),$(this).parents(".box-data-customer").find(".btn-addCus").show(),$(this).parents(".box-data-customer").find("input").removeAttr("readonly"),$(this).parents(".box-data-customer").removeClass("readonly"),$(this).parents(".box-data-customer").find("input").val(""),$(this).parents(".box-data-customer").find("input").focus();let t=$(".action-inv li.active").data("id");$("#item-mon").length>0&&void 0!==t&&await eventBanle.updateCustomerOrderOffline(1),$(this).parents(".box-data-customer").find("input").removeAttr("data-id")}))},removeCustomer:async function(t){(await axios({method:"post",url:"/Selling/OrderTable/UpdateCustomOrderTable",headers:{"Content-Type":"multipart/form-data"},data:{TypeUpdate:_TypeUpdatePos.ChangedCustomer,IsRemoveCustomer:!0,IdGuid:t}})).data.isValid},eventAddHtmlVAT:function(){0==$(".list-inputpayment .showselectboxvat").length&&($(".elemdiscount").after(' <div class="input-group mb-3 showselectboxvat selectbox">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text" id="basic-addon1" style="display: flex; white-space: nowrap;align-items: center;">Thuế GTGT:\n                                            <select id="Vatrate" name="Vatrate" class="Vatrate">\n                                                <option value="0">0%</option>\n                                                <option value="5">5%</option>\n                                                <option value="8">8%</option>\n                                                <option value="10" selected>10%</option>\n                                            </select>\n                                    </span>\n                                   \n                                </div>\n                                <input type="text" class="form-control VATAmount number3" placeholder="Tiền thuế" aria-label="" aria-describedby="basic-addon1">\n                            </div>'),loadFormatnumber(".showselectboxvat"))},eventChangeCheckboxHDDTVAT:function(){let t=!1;"undefined"!=typeof Storage||alert("Liên hệ đội ngủ hỗ  trợ lỗi trình duyệt của bạn không hỗ  trợ Storage"),t||($(".vatmtt-ele input.isCheckVAT").unbind(),$(".vatmtt-ele input.isCheckVAT").on("ifChecked",(function(t){localStorage.setItem("VATMTT",!0),eventBanle.eventAddHtmlVAT(),eventBanle.loadEventChangeVATRateVATAmount(),eventBanle.eventLoadTFullAmount(),eventBanle.saveUpdateDataVATMTT()})),$(".vatmtt-ele input.isCheckVAT").on("ifUnchecked",(function(t){localStorage.setItem("VATMTT",!1),$(".showselectboxvat").remove(),eventBanle.eventLoadTFullAmount(),eventBanle.saveUpdateDataVATMTT()})),void 0!==localStorage.getItem("VATMTT")&&"true"==localStorage.getItem("VATMTT")&&(eventBanle.eventAddHtmlVAT(),eventBanle.loadEventChangeVATRateVATAmount(),$(".vatmtt-ele input").iCheck("check"))),t=!0},loadEventChangePaymentMethod:function(){$("input.icheckpayment").unbind(),$("input.icheckpayment").on("ifChecked",(function(t){eventBanle.saveUpdateDataPaymentMethod()})),$(".input.icheckpayment").on("ifUnchecked",(function(t){}))},saveUpdateDataPaymentMethod:function(){var t=parseInt($("input[name=idPaymentMethod]:checked",".paymentMethod").data("id"));let e=$("ul.action-inv li.active").data("id"),a=localStorage.getItem("ProductsArrays");if(void 0!==a&&null!=a){let n=JSON.parse(a);if(n.length>0){let a=n.findIndex((t=>t.Id==e));if(-1!=a){let e=n[a];e.IdPaymentMethod=t,n[a]=e,localStorage.setItem("ProductsArrays",JSON.stringify(n))}else toastrcus.error("Đơn hàng không tồn tại vui lòng tải lại trang!")}else toastrcus.error("Chưa có đơn được tạo!")}else toastrcus.error("Lỗi hệ thống, vui lòng tải lại trang")},saveUpdateDataVATMTT:function(){let t=!1;"true"==localStorage.getItem("VATMTT")&&(t=!0);let e=$("ul.action-inv li.active").data("id"),a=localStorage.getItem("ProductsArrays");if(void 0!==a&&null!=a){let n=JSON.parse(a);if(n.length>0){let a=n.findIndex((t=>t.Id==e));if(-1!=a){let e=n[a];e.VATMTT=t,t?(e.VATRate=parseInt($("#Vatrate").val()),e.VATAmount=parseFloat($(".VATAmount").val().replaceAll(",",""))):(e.VATRate=NOVATRate,e.VATAmount=0),n[a]=e,localStorage.setItem("ProductsArrays",JSON.stringify(n))}else toastrcus.error("Đơn hàng không tồn tại vui lòng tải lại trang!")}else toastrcus.error("Chưa có đơn được tạo!")}else toastrcus.error("Lỗi hệ thống, vui lòng tải lại trang")},loadOtherTabInvoice:function(){let t=localStorage.getItem("ProductsArrays"),e=JSON.parse(t),a="";void 0!==e&&null!=e&&e.length>0?e.map((function(t,e){a+='<li data-id="'+t.Id+'" class="item-order">\n                            <i class="fa fa-exchange"></i>\n                            <span>Hóa đơn '+(e+1)+'</span>\n                            <i class="fas fa-times"></i>\n                        </li>'})):a+='<li data-id="0" class="active item-order">\n                        <i class="fa fa-exchange"></i>\n                        <span>Hóa đơn 1</span>\n                        <i class="fas fa-times"></i>\n                    </li>',$(".action-inv").find("li.add-tab").before(a),eventBanle.loadEventRemoveTaborderOffline()},removeOderOffline:function(t,e){let a=e;Swal.fire({icon:"warning",title:"Bạn có chắc chắn muốn xóa đơn không?",showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Đóng"}).then((e=>{e.isConfirmed&&($(t).parent().remove(),0==$(".action-inv li:not(.add-tab)").length?$(".action-inv li.add-tab .btn-addInvoice").trigger("click"):$(".action-inv li:first").trigger("click"),eventBanle.loadremoveDatalocaOffline(a))}))},loadremoveDatalocaOffline:function(t){let e=localStorage.getItem("ProductsArrays");if(void 0!==e&&null!=e){let n=JSON.parse(e);if(n.length>0){var a=n.findIndex((e=>e.Id==t));-1!=a&&(n.splice(a,1),localStorage.setItem("ProductsArrays",JSON.stringify(n))),0==n.length&&eventBanle.eventresetpaymentinput()}else localStorage.setItem("ProductsArrays","[]")}else localStorage.setItem("ProductsArrays","[]")},loadEventRemoveTaborderOffline:function(t){$(".action-inv").find("li").not(".add-tab").find("i:last-child").unbind(),$(".action-inv").find("li").not(".add-tab").find("i:last-child").click((async function(){let t=$(this).parent("li.item-order").data("id");"0"!=t?eventBanle.removeOderOffline($(this),t):$(".action-inv li:not(.add-tab)").not($(this).parent(".item-order")).length>0&&($(this).parent(".item-order").remove(),$(".action-inv li:first-child").trigger("click"))}))},loadClicktabInvoice:function(){eventBanle.loadOtherTabInvoice(),$(".cussendamount").focus((function(){$(this).select()})),$(".action-inv li.item-order").click((async function(){if(!$(this).hasClass("active")){$(".action-inv").find("li.active").not($(this)).removeClass("active"),$(this).addClass("active");let e=$(this).data("id");"0"!=e&&await eventBanle.loadDataInvoiceOffline(e),t=$(this).index(),"undefined"!=typeof Storage?localStorage.setItem("activeInvoicetab",t):alert("Liên hệ đội ngủ hỗ  trợ lỗi trình duyệt của bạn không hỗ  trợ Storage")}var t})),function(){if("undefined"!=typeof Storage){var t=localStorage.getItem("activeInvoicetab");if(isNaN(parseInt(t))){let t=$(".action-inv li.item-order:nth-child(1)");eventBanle.loadDatatableOffline(t)}else{t=parseInt(t)+1,$(".action-inv li").length<t&&(t=1);let e=$(".action-inv li.item-order:nth-child("+t+")");0==e.length&&(e=$(".action-inv li.item-order:nth-child(1)")),eventBanle.loadDatatableOffline(e)}}else alert("Liên hệ đội ngủ hỗ  trợ lỗi trình duyệt của bạn không hỗ  trợ Storage")}()},eventChangeCheckbocVAT:function(){$.ajax({type:"GET",global:!1,url:"/Selling/ConfigSaleParameters/GetConfigSell?key="+getObjectKey(EnumConfigParameters,EnumConfigParameters.AUTOVATINPAYMENT),success:function(t){t.isValid?t.data.typeValue==EnumTypeValue.BOOL&&"false"==t.data.value?$(".vatmtt-ele").length>0&&$(".vatmtt-ele").removeClass("d-none"):($(".vatmtt-ele").length>0&&$(".vatmtt-ele").remove(),localStorage.setItem("VATMTT","true")):$(".vatmtt-ele").length>0&&$(".vatmtt-ele").removeClass("d-none")},error:function(){alert("Error occured!!")}}),$(".isCheckVAT").click((function(){let t=$(this).is(":checked");localStorage.setItem("VATMTT",t)})),void 0!==localStorage.getItem("VATMTT")&&"true"==localStorage.getItem("VATMTT")&&$(".isCheckVAT").attr("checked","checked")},loadDatatable:async function(t){if(t.addClass("active"),id=$(t).data("id"),0==id)return eventBanle.loadAmoutAndQuantity(0,0),eventBanle.eventChangeCheckboxHDDTVAT(),!1;await eventBanle.loadDataInvoice(id),$(".search-customer").focus((function(){$(this).parent(".input-group").addClass("focus-input")})),$(".search-customer").blur((function(){$(this).parent(".input-group").removeClass("focus-input")}))},loadDatatableOffline:async function(t){if(t.addClass("active"),id=$(t).data("id"),0==id)return eventBanle.loadAmoutAndQuantity(0,0),eventBanle.eventChangeCheckboxHDDTVAT(),!1;await eventBanle.loadDataInvoiceOffline(id),$(".search-customer").focus((function(){$(this).parent(".input-group").addClass("focus-input")})),$(".search-customer").blur((function(){$(this).parent(".input-group").removeClass("focus-input")}))},loadDataInvoiceOffline:function(t){if(0==t){let t='<div role="tabpanel">\n                             <div class="tab-pane " id="tab-order-0" role="tabpanel">\n                                <div class="no-order">\n                                    <img src="../images/shopping.png" />\n                                    <b>Chưa có hàng hóa nào được chọn</b>\n                                    <span>Vui lòng chọn hàng hóa</span>\n                                </div>\n                            </div>\n                        </div>';return $("#container-tableOder").html(t),eventBanle.loadAmoutAndQuantity(0,0),$(".discountamount").data("discount",0),$(".discountamount").data("value",0),$(".discountamount").data("type",TypeSelectDiscount.Cash),!1}let e=localStorage.getItem("ProductsArrays"),a=JSON.parse(e);if(!(void 0!==a&&null!=a&&a.length>0))return eventBanle.loadAmoutAndQuantity(0,0),!1;{let e=a.findIndex((e=>e.Id==t));eventBanle.loadHtmloffline(a[e])}},loadHtmloffline:async function(t){let e=t.Items,a='<ul id="item-mon"> ';e.map((function(t,e){let n="",i=t.PriceNew;-1!=t.Typediscount&&t.DiscountAmount>0&&(n=1==t.Typediscount?"<span class='discountAmountItemPro'>"+-1*t.Discount+"%</span>":"<span class='discountAmountItemPro'>"+(-1*t.DiscountAmount).format0VND(0,3)+"</span>"),a+='<li data-code="'+t.Code+'" data-idpro ="'+t.Id+'" data-sl='+t.Quantity+'>\n                            <div  class="btn-remove" data-idquan="1"><i data-idquan="1" class="fas fa-trash-alt"></i></div>\n                            <div class="name" data-name="'+t.Name+'"><b>'+(e+1)+"."+t.Name+'</b></div>\n                            <div class="item_action"><i class="fas fa-minus"></i><input data-quantity="'+t.Quantity+'" class="quantity number3" value="'+t.Quantity+'"><i class="fas fa-plus"></i></div>\n                            <div class="ele-price"><input type="text" class="form-control number3 price"  data-price="'+t.Price+'"  data-pricenew="'+t.PriceNew+'"  data-retailPrice="'+t.RetailPrice+'" data-typediscount="'+t.Typediscount+'" data-discountamount="'+t.DiscountAmount+'" data-discount="'+t.Discount+'" readonly value="'+i+'" />'+n+'</div>\n                            <div class="total"><b class="number3" data-total="'+t.Amount+'">'+t.Amount.format0VND(0,3)+"</b></div>\n                        </li>"})),a+="</ul>",$("#container-tableOder").html(a),$(".fullamount").text(t.Total.format0VND(3,3)),$(".discountamount").val(t.DiscountAmount.format0VND(3,3)),$(".discountamount").data("discount",t.Discount),t.Discount>0?($(".discountamount").data("value",t.Discount),$(".discountamount").data("type",TypeSelectDiscount.Percent)):($(".discountamount").data("value",t.DiscountAmount),$(".discountamount").data("type",TypeSelectDiscount.Cash)),eventBanle.loadeventchangeclickprice(),evetnFormatTextnumber3(),eventBanle.loadEventClickIconAddAndMinusoffline(),eventBanle.eventChangeCheckboxHDDTVAT(),eventBanle.loadShowOrHideCheckVATMTT(t.VATMTT),$("#Vatrate option").each((function(t,e){e.selected=!1})),$("#Vatrate option[value='"+t.VATRate+"']").prop("selected","selected"),t.VATMTT&&$(".VATAmount").data("VATAmount",t.VATAmount),await eventBanle.eventLoadTFullAmount().then((()=>{t.VATMTT&&$(".VATAmount").removeData("VATAmount")})),parseInt($("input[name=idPaymentMethod]:checked",".paymentMethod").data("id"))!=t.IdPaymentMethod&&($("input[name=idPaymentMethod]:checked",".paymentMethod").iCheck("uncheck"),$("input[data-id="+t.IdPaymentMethod+"]",".paymentMethod").iCheck("check")),_classPosEvent={input_searchProduct:$(".search-product"),input_searchCustomer:$(".search-customer")},loadeventPos.loadEventkeyCode(),eventBanle.loadCustomerByOrderOfline(t.Customer),eventBanle.loadSugetionPayment()},loadShowOrHideCheckVATMTT:function(t=!0){t?$("input[name=isCheckVAT]").iCheck("check"):$("input[name=isCheckVAT]").iCheck("uncheck")},loadCustomerByOrderOfline:function(t){let e=$(".search-customer");""!=t.Id&&null!=t.Id?(e.val(t.Name),e.parents(".box-data-customer").find(".btn-cleardata").show(),e.parents(".box-data-customer").find(".btn-addCus").hide(),e.parents(".box-data-customer").find("input").attr("readonly","readonly"),e.parents(".box-data-customer").addClass("readonly"),e.parents(".box-data-customer").data("idCus",t.Id),e.parents(".box-data-customer").data("code",t.Code),e.parents(".box-data-customer").data("name",t.Name)):eventBanle.loadEventResetCusomter()},loadEventResetCusomter:function(){let t=$(".search-customer");t.val(""),t.parents(".box-data-customer").find(".btn-cleardata").hide(),t.parents(".box-data-customer").find(".btn-addCus").show(),t.parents(".box-data-customer").find("input").removeAttr("readonly"),t.parents(".box-data-customer").removeClass("readonly"),t.parents(".box-data-customer").data("idCus",0),t.parents(".box-data-customer").data("code",""),t.parents(".box-data-customer").data("name","")},loadDataInvoice:async function(t){if(0==t){let t='<div role="tabpanel">\n                             <div class="tab-pane " id="tab-order-0" role="tabpanel">\n                                <div class="no-order">\n                                    <img src="../images/shopping.png" />\n                                    <b>Chưa có hàng hóa nào được chọn</b>\n                                    <span>Vui lòng chọn hàng hóa</span>\n                                </div>\n                            </div>\n                        </div>';return $("#container-tableOder").html(t),eventBanle.loadAmoutAndQuantity(0,0),!1}var e=await axios.get("/Selling/OrderTable/LoadDataByOrderInvoice?idinvoice="+t);if(!e.data.isValid)return eventBanle.loadAmoutAndQuantity(0,0),!1;$("#container-tableOder").html(e.data.data),null!=e.data.dataCus&&""!=e.data.dataCus&&(CusByOrderIvnoice=e.data.dataCus),null!=e.data.dataNote&&""!=e.data.dataNote&&(NoteByOrderIvnoice=e.data.dataNote),eventBanle.loadAmoutAndQuantity(e.data.amount,e.data.quantity),eventBanle.loadTienthuakhach(),eventBanle.loadSugetionPayment(),eventBanle.loadeventchangeclickprice(),loadeventPos.loadEventAddCustomer(),_classPosEvent={input_searchProduct:$(".search-product"),input_searchCustomer:$(".search-customer")},eventBanle.loadEventClickIconAddAndMinusoffline(),loadeventPos.loadEventkeyCode(),eventBanle.loadAutocomplete(!1,!0),eventBanle.loadCustomerByOrder(),eventBanle.eventChangeCheckboxHDDTVAT()},loadCustomerByOrder:function(){let t=$(".search-customer");""!=CusByOrderIvnoice.idCustomer&&null!=CusByOrderIvnoice.idCustomer?(t.val(CusByOrderIvnoice.customerCode+" "+CusByOrderIvnoice.customerName),t.parents(".box-data-customer").find(".btn-cleardata").show(),t.parents(".box-data-customer").find(".btn-addCus").hide(),t.parents(".box-data-customer").find("input").attr("readonly","readonly"),t.parents(".box-data-customer").addClass("readonly"),t.parents(".box-data-customer").data("id",CusByOrderIvnoice.idCustomer)):(t.parents(".box-data-customer").find(".btn-cleardata").hide(),t.parents(".box-data-customer").find(".btn-addCus").show(),t.parents(".box-data-customer").find("input").removeAttr("readonly"),t.parents(".box-data-customer").removeClass("readonly"),t.parents(".box-data-customer").data("id",0))},loadEventAddCustomer:function(){$(".btn-addCus").click((function(){eventCreate.addOrEditCustomer("/Selling/Customer/Create?IsPos=true")}))}},loadeventPos={eventRealtimeOrdertable:function(t){json=JSON.parse(t),$("#lst-roomandtable li").filter((async function(){let t=$(this).data("id");if(json.IdRoomAndTableGuid==t&&(0==json.OrderTableItems.length||json.TypeProduct==_TypeUpdatePos.RemoveOrder?$(this).removeClass("CurentOrder"):$(this).hasClass("CurentOrder")||$(this).addClass("CurentOrder"),$(this).hasClass("active"))){let e=$(this).find("b").html();json.IsBringBack?await loadeventPos.loadOrderByTable("-1"):await loadeventPos.loadOrderByTable(json.IdRoomAndTableGuid),$(".btn-showttable").data("id",t),$(".btn-showttable").find(".showTableOrder").html(e)}}))},eventShowTabProductByCategory:function(){$.ajax({global:!1,type:"GET",url:"/Selling/Product/GetProductJson",dataType:"json",beforeSend:function(){},success:function(t){t.isValid&&(htmlcate='<ul class="ltscategoryProduct">',htmlcate+='<li class="active">\n                                   <a href="javascript:void(0)" data-id="0">\n                                        <b>'+t.jsonPro.length+"</b> <span>Tất cả</span>\n                                    </a>\n                                 </li>",t.jsoncate.forEach((function(t,e){htmlcate+='<li>\n                                         <a href="javascript:void(0)" data-id="'+t.id+'">\n                                             <b>'+t.countpro+"</b> <span>"+t.name+'</span>\n                            \n                                         </a>\n                                         <span class="tooltipshow">'+t.name+"</span>\n                                      </li>"})),htmlcate+="</ul>",$(".bodyDataproduct .leftcolumthucdon").html(htmlcate),htmlcate='<ul id="lst-product" class="ul-nonestyle">',t.jsonPro.forEach((function(t,e){htmlimg='<img src="../'+t.img+'">',""!=t.img&&null!=t.img||(htmlimg='<img class="ristorante" src="../images/ristorante_old.png">'),htmlcate+=' <li data-id="'+t.id+'" data-idcategory="'+t.idCategory+'">\n                                            <div class="head_pro">\n                                                    '+htmlimg+'\n                                                </div>\n                                             <div class="footer_pro">\n                                                 <span>'+t.name+'</span>\n                                                 <b class="required priceFormat">'+t.retailPrice+"</b>\n                                          </div>\n                                      </li>"})),htmlcate+="</ul>",$(".bodyDataproduct .rightcolumthucdon").html(htmlcate),$(".bodyDataproduct .leftcolumthucdon ul li").map((function(){let t=$(this).children("a").data("id");$(this).children("a").removeAttr("data-id"),$(this).children("a").data("id",t)})),$(".bodyDataproduct .rightcolumthucdon ul li").map((function(){let t=$(this).data("id"),e=$(this).data("idcategory");$(this).removeAttr("data-idcategory"),$(this).removeAttr("data-id"),$(this).data("idcategory",e),$(this).data("id",t)})),$(".bodyDataproduct .leftcolumthucdon ul.ltscategoryProduct a").click((function(){let t=$(this).data("id");$(".bodyDataproduct .rightcolumthucdon ul li").filter((function(){var e=$(this);let a=$(this).data("idcategory");t==a||0==t?e.css("display","flex"):e.css("display","none")})),$(this).parents("ul.ltscategoryProduct").find("li").removeClass("active"),$(this).parent("li").addClass("active")})),loadeventPos.loadClickItemProduct(),priceFormat())}})},updateChangetableOrder:function(){_dtselect=parseInt($("input[name=orderActions]:checked").data("id")),_dtIdTabale=$("#lstroomselect").val(),_dtOldIdTable=$("#OldIdTable").val(),isNaN(_dtselect)?toastrcus.error("Bạn chưa chọn bàn cần chuyển!"):1!=_dtselect||""!=_dtIdTabale.replaceAll(" ","")?(idOrder=$("#ul-tab-order a.active").data("id"),dataObject={IdOrder:idOrder,TypeSelectTable:_dtselect,IdTable:_dtIdTabale,OldIdTable:_dtOldIdTable,TypeUpdate:_TypeUpdatePos.UpdateRoomOrTableInOrder},$.ajax({type:"POST",url:"/Selling/OrderTable/ChangeTableInOrder",dataType:"json",data:dataObject,success:async function(t){if(t.isValid){if(checkRooom=0,$("#ul-tab-order li:not(.add-tab)").map((function(){$(this).children("a").hasClass("active")||void 0===$(this).children("a").data("id")||""==$(this).children("a").data("id")||(checkRooom+=1)})),checkRooom>0)$("#ul-tab-order li").filter((function(){var t=$(this);t.find("a").hasClass("active")&&(t.remove(),$("#ul-tab-order a:first").trigger("click"))})),$("#lst-roomandtable li").map((function(){idata=$(this).data("id"),idata==t.idTable&&$(this).addClass("CurentOrder")}));else{let e;$("#lst-roomandtable li.active").removeAttr("class"),$("#lst-roomandtable li").map((function(){idata=$(this).data("id"),idata==t.idTable&&(e=$(this))})),e.trigger("click")}loadeventPos.eventloadNumberStatusTable(),Swal.close()}},error:function(t){console.log(t)}})):toastrcus.warning("Vui lòng chọn bàn cần chuyển!")},loadeventChangetableOrder:function(){$(".btn-showttable").click((function(){idtable=$(this).data("id"),idOrder=$("#ul-tab-order a.active").data("id"),isbringback=!1,"-1"==idtable&&(isbringback=!0,idtable=""),""!=idOrder&&"undefined"!=typeof idOrder&&eventCreate.editTableInOrder("/Selling/OrderTable/ChangeTableInOrder?IdOrder="+idOrder+"&IdRoomAndTable="+idtable+"&isbringback="+isbringback)}))},loadAddOrRemoveCurentClassTable:function(t=!1){t?$("#lst-roomandtable li.active").hasClass("CurentOrder")||$("#lst-roomandtable li.active").addClass("CurentOrder"):$("#lst-roomandtable li.active").removeClass("CurentOrder"),loadeventPos.eventloadNumberStatusTable()},checkHighlightTableInOrder:function(){let t=!1;$("#ul-tab-order li:not(.add-tab)").map((function(e,a){let n=$(a).children("a").data("id");void 0!==n&&""!=n&&(t=!0)})),t||loadeventPos.loadAddOrRemoveCurentClassTable(!1)},eventUpdateQuantityItemMonOrder:function(){$(".tab-content-order .tab-pane.active ul#item-mon").children("li").map((function(){let t=$(this).data("sl");$(this).data("slnotify",t)})),$(".btn-notif").attr("disabled","disabled")},eventCheckBtnNotifyOrder:function(t){let e=!1,a=$(t).attr("href");$(a).find("ul#item-mon").children("li").map((function(){let t=$(this).data("sl");$(this).data("slnotify")!=t&&(e=!0)})),e?$(".btn-notif").removeAttr("disabled"):$(".btn-notif").attr("disabled","disabled")},eventUpdatedataItemMonOrder:function(){let t=!1;$("#container-tableOder ul#item-mon").children("li").map((function(){let e=$(this).data("idpro"),a=$(this).data("id"),n=$(this).data("sl"),i=$(this).data("slnotify");$(this).removeAttr("data-id"),$(this).removeAttr("data-idpro"),$(this).removeAttr("data-sl"),$(this).removeAttr("data-slnotify"),$(this).data("idpro",e),$(this).data("id",a),$(this).data("sl",n),$(this).data("slnotify",i),i!=n&&(t=!0);let o=$(this).find(".note").data("note");$(this).find(".note").removeAttr("data-note"),$(this).find(".note").data("note",o)})),t?$(".btn-notif").removeAttr("disabled"):$(".btn-notif").attr("disabled","disabled")},orderTable:function(t){$.ajax({type:"POST",url:"/Selling/OrderTable/AddOrderTable",dataType:"json",data:t,success:async function(e){if(e.isValid)if(e.isbaobep&&loadeventPos.eventinbaobep(e.dataHtml),0==e.data.orderTableItems.length){e.data.isBringBack&&(e.data.idRoomAndTableGuid="-1"),await loadeventPos.loadOrderByTable(e.data.idRoomAndTableGuid),loadeventPos.checkHighlightTableInOrder();let t=$("#lst-roomandtable").find("li.active");$(".btn-showttable").data("id",t.data("id")),$(".btn-showttable").find(".showTableOrder").html(t.find("b").html())}else{let n='<ul id="item-mon"> ';if(e.data.orderTableItems.forEach((function(t,e){e+=1,n+=' <li data-id="'+t.idGuid+'" data-idpro ="'+t.idProduct+'" data-slNotify='+t.quantityNotifyKitchen+" data-sl="+t.quantity+' >\n                                            <div  class="btn-remove" data-idquan="'+t.quantity+'"><i data-idquan="'+t.quantity+'" class="fas fa-trash-alt"></i></div>\n                                            <div class="name"><b>'+e+". "+t.name+'</b>\n                                            <button class="note'+(null!=t.note&&""!=t.note?" active":"")+'" data-note="'+(null!=t.note?t.note:"")+'"><i class="far fa-sticky-note"></i> <span class="text">'+(""!=t.note&&null!=t.note?t.note:"Thêm ghi chú")+'</span></button>\n                                            </div>\n                                            <div class="item_action"><i class="fas fa-minus"></i><input class="quantity numberformat" value="'+t.quantity+'"> <i class="fas fa-plus"></i></div>\n                                            <div><input type="text" class="form-control priceFormat" readonly value="'+t.price+'" /></div>\n                                            <div class="amount"><b class="priceFormat">'+t.total+'</b><button class="CloneItem"><i class="fas fa-plus"></i></button></div>\n                                        </li>'})),n+="</ul>",$("#ul-tab-order").find("a.active").data("id",e.data.idGuid),$("#ul-tab-order").find("a.active").parent("li").data("title",""),$("#ul-tab-order").find("a.active").find("span.orderCode").html(e.data.orderCode),$(".tab-content-order").find(".tab-pane.active").html(n),loadeventPos.loadeventAddNote(),loadeventPos.loadCloneitem(),loadeventPos.eventUpdatedataItemMonOrder(),$(".tab-content-order").find(".tab-pane.active").attr("data-id",e.data.idGuid),loadeventPos.loadAmoutAndQuantity(e.data.amount,e.data.quantity),loadeventPos.loadEventClickIconAddAndMinus(),loadeventPos.loadAddOrRemoveCurentClassTable(!0),t.TypeUpdate==_TypeUpdatePos.CloneItemOrder){const n=e.data.orderTableItems.map((t=>t.id)),i=Math.max(...n);var a=e.data.orderTableItems.find((e=>e.idProduct==t.IdProduct&&e.id==i));loadeventPos.loadactiveClickItemMon(a.idGuid,t.IdProduct)}else loadeventPos.loadactiveClickItemMon(t.IdOrderItem,t.IdProduct);if(t.TypeUpdate==_TypeUpdatePos.AddProduct&&void 0===t.IdGuid){let t=ListCusByOrderPos.find((t=>t.idOrder==e.data.idGuid)),a=$(".search-customer").val();if(void 0===t&&""!=a){let t={};t.idOrder=e.data.idGuid,t.customerCode=a.split(" ")[0],t.customerName=e.data.buyer,ListCusByOrderPos.push(t)}}}},error:function(t){console.log(t)}})},loadCloneitem:function(){$("ul#item-mon").children("li").find("button.CloneItem").unbind(),$("ul#item-mon").children("li").find("button.CloneItem").click((function(){let t=$(".btn-showttable").data("id"),e=$(this).parents("li").data("id");var a={QuantityFloat:1,TypeUpdate:_TypeUpdatePos.CloneItemOrder,IdRoomAndTableGuid:"-1"!=t?t:"",IsBringBack:"-1"==t,IdGuid:$("#ul-tab-order").find("a.active").data("id"),IdOrderItem:e,IdProduct:$(this).parents("li").data("idpro")};loadeventPos.orderTable(a)}))},loadeventAddNote:function(){$("ul#item-mon").children("li").find("button.note").unbind(),$("ul#item-mon").children("li").find("button.note").click((function(){if(parseFloat($(this).parents("li").data("slnotify").toString().replaceAll(",",""))>0)return void toastrcus.error("Món đã thông báo chế biến, không thể điều chỉnh ghi chú");var t=$(this);let e=$(this).parents("li").data("id"),a=$("#ul-tab-order a.active").data("id"),n=$(this).data("note");htmlcontent=' <textarea class="form-control addnoteitem"  placeholder="Nhập ghi chú">'+n+"</textarea>",Swal.fire({title:'Nhập ghi chú cho sản phẩm: <b class="red">'+$(this).parents("li").find(".name").find("b").html()+"</b>",customClass:{container:"Swalcontainer-small",title:"title-swal-small"},allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,confirmButtonText:"Lưu",html:htmlcontent,cancelButtonText:"Hủy bỏ",footer:"<button class='swal2-cancel swal2-styled btn-cancel mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='swal2-styled btn btn-success btn-save'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",showLoaderOnConfirm:!0,didRender:()=>{$(".addnoteitem").select(),$(".btn-cancel").click((function(){Swal.close()})),$(".btn-save").click((function(){""!=$(".addnoteitem").val().trim()?$.ajax({type:"POST",url:"/Selling/OrderTable/AddNoteAndToppingItemOrder",data:{IdOrderItem:e,IdOrder:a,Note:$(".addnoteitem").val().trim()},success:function(e){e.isValid&&(t.addClass("active"),t.data("note",$(".addnoteitem").val().trim()),t.find("span.text").html($(".addnoteitem").val().trim()),Swal.close())},error:function(t){console.log(t)}}):toastrcus.error("Vui lòng nhập ghi chú")}))},preConfirm:t=>{console.log(t)},allowOutsideClick:()=>!Swal.isLoading()})}))},loadactiveClickItemMon:function(t,e){$("ul#item-mon").children("li").map((function(){$(this).data("id")==t&&($(this).addClass("animatino"),$(this).addClass("active"),sel=$(this),setTimeout((function(){$(sel).removeClass("animatino")}),300))}))},loadeventclickitemmon:function(){$("#item-mon li").click((function(){$("#item-mon li.active").removeClass("active"),$(this).addClass("active")}))},loadEventClickIconAddAndMinus:function(){$("#item-mon  li .item_action").find("i").unbind(),$("#item-mon  li .item_action").find("i:first-child").click((function(){let t=$(this).parent().parent("li").data("id"),e=$(".btn-showttable").data("id"),a=$(".search-customer").val(),n=$(this).parent().parent("li").data("sl"),i=$(this).parent().parent("li").data("slnotify"),o="";if(""!=a.trim()&&(a=a.split(" ")[0],o=$(".search-customer").data("id")),parseFloat(i)>parseFloat(n)-1){let n='\n                            <div class="form-confirmremoveitem">\n                                <span>Bạn có chắc chắn muốn hủy món <b>'+$(this).parents("li").find(".name").find("b").html()+'</b> không?</span>\n                                <div class="slminus">\n                                    <span>Số lượng hủy/giảm</span>\n                                    <div class="item_action"><i class="fas fa-minus"></i><span data-slhuy="1" class="quantitynew">1</span><span class="quantityold">/'+parseFloat(i)+'</span> <i class="fas fa-plus"></i></div>\n                                </div>\n                                <div class="input-note">\n                                    <span class="text">Lý do: </span>\n                                     <input type="text" id="noteminus" class="form-control"/>\n                                </div>\n                            </div>\n                            ';Swal.fire({title:"Xác nhận giảm / Hủy món",html:n,showClass:{popup:"popup-formcreate"},footer:"<button class='swal2-cancel swal2-styled btn-cancel mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='swal2-styled btn btn-success btn-save'><i class='icon-cd icon-doneAll icon'></i>Đồng ý</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".form-confirmremoveitem .item_action i:first-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t=parseDecimal(t>=0&&t<1?t-.1:t-1),t<=0)return toastr.error("Sô lượng hủy/giảm phải lớn hơn 0"),!1;$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".form-confirmremoveitem .item_action i:last-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t>=parseFloat(i))return toastr.error("Sô lượng hủy/giảm không vượt quá số lượng gốc"),!1;t=parseDecimal(t>=0&&t<1?t+.1:t+1),$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".btn-cancel").click((function(){Swal.close()})),$(".btn-save").click((function(){let n=parseFloat($(".form-confirmremoveitem .item_action").children(".quantitynew").data("slhuy"));var i={Note:$(".form-confirmremoveitem").find("#noteminus").val(),IsCancel:!0,IdOrderItem:t,CusCode:a,IdCustomer:o,QuantityFloat:-1*n,TypeUpdate:_TypeUpdatePos.UpdateQuantity,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#ul-tab-order").find("a.active").data("id")};loadeventPos.orderTable(i),Swal.close()}))}})}else{var l={IdOrderItem:t,CusCode:a,IdCustomer:o,QuantityFloat:-1,TypeUpdate:_TypeUpdatePos.UpdateQuantity,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#ul-tab-order").find("a.active").data("id")};loadeventPos.orderTable(l)}})),$("#item-mon  li input.quantity").unbind(),$("#item-mon  li .item_action").find("input.quantity").change((function(){let t=$(this),e=$(this).parent().parent("li").data("id"),a=$(".btn-showttable").data("id"),n=$(".search-customer").val(),i=$(this).parent().parent("li").data("sl"),o=$(this).val(),l=$(this).parent().parent("li").data("slnotify"),r="";if(""!=n.trim()&&(n=n.split(" ")[0],r=$(".search-customer").data("id")),parseFloat(o)<=0)return $(this).val(i),void toastrcus.error("Số lượng không hợp lệ phải lớn hơn 0");if(parseFloat(l)>parseFloat(o)){let s=parseFloat((parseFloat(i)-parseFloat(o)).toFixed(3)),d=(parseFloat(l),parseFloat(o),'\n                            <div class="form-confirmremoveitem">\n                                <span>Bạn có chắc chắn muốn hủy món <b>'+$(this).parents("li").find(".name").find("b").html()+'</b> không?</span>\n                                <div class="slminus">\n                                    <span>Số lượng hủy/giảm</span>\n                                    <div class="item_action"><i class="fas fa-minus"></i><span data-slhuy="'+s+'" class="quantitynew">'+s+'</span><span class="quantityold">/'+l+'</span> <i class="fas fa-plus"></i></div>\n                                </div>\n                                <div class="input-note">\n                                    <span class="text">Lý do: </span>\n                                    <input type="text" id="noteminus" class="form-control"/>\n                                </div>\n                            </div>\n                            ');Swal.fire({title:"Xác nhận giảm / Hủy món",html:d,showClass:{popup:"popup-formcreate"},footer:"<button class='swal2-cancel swal2-styled btn-cancel mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='swal2-styled btn btn-success btn-save'><i class='icon-cd icon-doneAll icon'></i>Đồng ý</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".form-confirmremoveitem .item_action i:first-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t=parseDecimal(t>=0&&t<1?t-.1:t-1),t<=0)return toastr.error("Số lượng hủy/giảm còn ít nhất là 0"),!1;$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".form-confirmremoveitem .item_action i:last-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t>=parseFloat(l))return toastr.error("Sô lượng hủy/giảm không vượt quá số lượng gốc"),!1;t=parseDecimal(t>=0&&t<1?t+.1:t+1),$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".btn-cancel").click((function(){$(t).val(i),Swal.close()})),$(".btn-save").click((function(){let t=parseFloat($(".form-confirmremoveitem .item_action").children(".quantitynew").data("slhuy"));var i={Note:$(".form-confirmremoveitem").find("#noteminus").val(),IsCancel:!0,IdOrderItem:e,CusCode:n,IdCustomer:r,QuantityFloat:(-1*t).toString(),TypeUpdate:_TypeUpdatePos.UpdateQuantity,IdRoomAndTableGuid:"-1"!=a?a:"",IsBringBack:"-1"==a,IdGuid:$("#ul-tab-order").find("a.active").data("id")};loadeventPos.orderTable(i),Swal.close()}))}})}else{let t=parseFloat((parseFloat(o)-parseFloat(i)).toFixed(3));if(0!=t){var s={IdOrderItem:e,CusCode:n,IdCustomer:r,QuantityFloat:t.toString(),TypeUpdate:_TypeUpdatePos.UpdateQuantity,IdRoomAndTableGuid:"-1"!=a?a:"",IsBringBack:"-1"==a,IdGuid:$("#ul-tab-order").find("a.active").data("id")};loadeventPos.orderTable(s)}else 0==t||toastrcus.warning("Số lượng không hợp lệ")}})),$("#item-mon  li .item_action").find("i:last-child").click((function(){let t=$(this).parent().parent("li").data("id"),e=$(".btn-showttable").data("id"),a=$(".search-customer").val(),n="";""!=a.trim()&&(a=a.split(" ")[0],n=$(".search-customer").data("id"));var i={IdOrderItem:t,CusCode:a,IdCustomer:n,QuantityFloat:1,TypeUpdate:_TypeUpdatePos.UpdateQuantity,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#ul-tab-order").find("a.active").data("id")};loadeventPos.orderTable(i)})),$("#item-mon  li .btn-remove").unbind(),$("#item-mon  li .btn-remove").click((function(){let t=$(this).parent("li").data("id"),e=$(this).data("idquan"),a=$(".btn-showttable").data("id"),n=$(this).parent("li").data("sl"),i=$(this).parent("li").data("slnotify");if(parseFloat(i)>0){let e='\n                            <div class="form-confirmremoveitem">\n                                <span>Bạn có chắc chắn muốn hủy món <b>'+$(this).parents("li").find(".name").find("b").html()+'</b> không?</span>\n                                <div class="slminus">\n                                    <span>Số lượng hủy/giảm</span>\n                                    <div class="item_action"><i class="fas fa-minus"></i><span data-slhuy="'+i+'" data-goc="'+n+'" data-slnotify="'+i+'" class="quantitynew">'+n+'</span><span class="quantityold">/'+n+'</span> <i class="fas fa-plus"></i></div>\n                                </div>\n                                <div class="input-note">\n                                    <span class="text">Lý do: </span>\n                                     <input type="text" id="noteminus" class="form-control"/>\n                                </div>\n                            </div>\n                            ';Swal.fire({title:"Xác nhận giảm / Hủy món",html:e,showClass:{popup:"popup-formcreate"},footer:"<button class='swal2-cancel swal2-styled btn-cancel mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='swal2-styled btn btn-success btn-save'><i class='icon-cd icon-doneAll icon'></i>Đồng ý</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{$(".form-confirmremoveitem select").prepend("<option selected></option>").select2({placeholder:{id:"",text:"Chọn bàn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$(".form-confirmremoveitem .item_action i:first-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t=parseDecimal(t>=0&&t<1?t-.1:t-1),t<=0)return toastr.error("Sô lượng hủy/giảm phải lớn hơn 0"),!1;$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".form-confirmremoveitem .item_action i:last-child").click((function(){let t=parseFloat($(this).parent().children(".quantitynew").data("slhuy"));if(t>=parseFloat(i))return toastr.error("Sô lượng hủy/giảm không vượt quá số lượng gốc"),!1;t=parseDecimal(t>=0&&t<1?t+.1:t+1),$(this).parent().children(".quantitynew").data("slhuy",t),$(this).parent().children(".quantitynew").html(t)})),$(".btn-cancel").click((function(){Swal.close()})),$(".btn-save").click((function(){let e=parseFloat($(".form-confirmremoveitem .item_action").children(".quantitynew").data("slgoc")),n=parseFloat($(".form-confirmremoveitem .item_action").children(".quantitynew").data("slhuy")),i=parseFloat($(".form-confirmremoveitem .item_action").children(".quantitynew").data("slnotify")),o=$(".form-confirmremoveitem").find("#noteminus").val(),l=e-i,r=_TypeUpdatePos.UpdateQuantity,s=!1;n==e&&(r=_TypeUpdatePos.RemoveRowItem),l!=n&&(s=!0);var d={Note:o,IsCancel:s,IdOrderItem:t,QuantityFloat:-1*n,TypeUpdate:r,IdRoomAndTableGuid:"-1"!=a?a:"",IsBringBack:"-1"==a,IdGuid:$("#ul-tab-order").find("a.active").data("id")};loadeventPos.orderTable(d),Swal.close()}))}})}else{var o={QuantityFloat:e,IdOrderItem:t,TypeUpdate:_TypeUpdatePos.RemoveRowItem,IdRoomAndTableGuid:"-1"!=a?a:"",IsBringBack:"-1"==a,IdGuid:$("#ul-tab-order").find("a.active").data("id")};loadeventPos.orderTable(o)}})),$("#item-mon li").unbind(),loadeventPos.loadeventclickitemmon()},loadeventselectautocompleteproduct:function(t){let e=$(".search-customer").val();""!=e.trim()&&(e=e.split(" ")[0]);let a=$(".btn-showttable").data("id");var n={CusCode:e,QuantityFloat:1,TypeUpdate:_TypeUpdatePos.AddProduct,IdRoomAndTableGuid:"-1"!=a?a:"",IsBringBack:"-1"==a,IdGuid:$("#ul-tab-order").find("a.active").data("id"),IdProduct:t};loadeventPos.orderTable(n)},loadClickItemProduct:function(){$("#lst-product li").click((function(){let t=$(".search-customer").val();""!=t.trim()&&(t=t.split(" ")[0]);let e=$(".btn-showttable").data("id");var a={CusCode:t,QuantityFloat:1,TypeUpdate:_TypeUpdatePos.AddProduct,IdRoomAndTableGuid:"-1"!=e?e:"",IsBringBack:"-1"==e,IdGuid:$("#ul-tab-order").find("a.active").data("id"),IdProduct:$(this).data("id")};loadeventPos.orderTable(a)}))},loadAmoutAndQuantity:function(t=null,e=null,a=""){null!=t&&null!=e?($(".fullamount").html(t),$(".quantitySum").html(e)):(t=0,e=0,""!=a?$(".tab-content-order").find("div[data-id="+a+"]").find("ul").find("li").map((function(a,n){t+=parseFloat($(this).find(".amount").find(".priceFormat").html().replaceAll(",","")),e+=parseFloat($(this).find(".quantity").val().replaceAll(",",""))})):$(".tab-content-order").find(".tab-pane.active").find("ul").find("li").map((function(a,n){t+=parseFloat($(this).find(".amount").find(".priceFormat").html().replaceAll(",","")),e+=parseFloat($(this).find(".quantity").val().replaceAll(",",""))})),$(".fullamount").html(t),$(".quantitySum").html(e)),priceFormat()},loadAutocomplete:function(t=!0,e=!0){t&&(_classPosEvent.input_searchProduct.blur((function(){$("#parentautocomplete").css({height:"0",top:"0","z-index":"0"})})),_classPosEvent.input_searchProduct.autocomplete({appendTo:"#parentautocomplete",autoFocus:!0,minLength:0,delay:0,source:function(t,e){$.ajax({global:!1,url:"/Selling/Pos/SearchProductPos",type:"GET",dataType:"json",data:{text:t.term,iSsell:!0},success:function(a){return e($.map(a,(function(e){let a=__highlight(e.name,t.term);var n="<span>Tồn kho: <b>"+parseFloat(e.quantity).format0VND(3,3,"")+"</b></span>";return(e.isInventory||e.typeProductCategory==EnumTypeProductCategory.COMBO||e.typeProductCategory==EnumTypeProductCategory.SERVICE)&&(n="<span>Tồn kho: <b>--</b></span>"),{label:"<a href='javascript:void(0)'><div class='search-auto'><div class='img'><img src='../"+e.img+"'></div><div class='tk_name'><span>"+a+" ("+e.code+")</span><span class='price'>"+parseFloat(e.price).format0VND(3,3,"")+"</span>"+n+"</div></div></a>",value:e.code,idProduct:e.id}}))),{label:t.term,value:t.term}}})},html:!0,select:function(t,e){$(this).val(e.item.value),$(this).select(),_varIdGuidSelectproductAutocomplete=e.item.idProduct,loadeventPos.loadeventselectautocompleteproduct(_varIdGuidSelectproductAutocomplete)}}).focus((function(){$("#parentautocomplete").css({height:"calc(100vh - 100px)",top:"52px","z-index":"5"}),$(this).autocomplete("search"),$(this).select()})),_classPosEvent.input_searchProduct.keypress((function(t){let e=$(this).val();13==t.keyCode&&e.length>0?$("#lst-product li").map((function(){$(this).data("id")==_varIdGuidSelectproductAutocomplete&&$(this).trigger("click")})):0==e.length&&(_varIdGuidSelectproductAutocomplete="")}))),e&&(_classPosEvent.input_searchCustomer.blur((function(){$("#parentautocomplete").css({height:"0",top:"0","z-index":"0"})})),_classPosEvent.input_searchCustomer.autocomplete({appendTo:"#parentautocomplete",autoFocus:!0,minLength:0,delay:0,source:function(t,e){$.ajax({global:!1,url:"/Selling/Customer/SearchCustomerPos",type:"GET",dataType:"json",data:{text:t.term},success:function(a){return e($.map(a,(function(e){let a=__highlight(e.name,t.term);return{label:"<a href='javascript:void(0)'><div class='search-auto'><div class='img'><img src='../"+e.img+"'></div><div class='tk_name'><span>"+a+"</span><span class='code'>Mã KH: "+e.code+" <br/> SĐT: "+e.phoneNumber+"</div></div></a>",value:e.code+" "+e.name,idCus:e.id}}))),{label:t.term,value:t.term}}})},html:!0,select:async function(t,e){$(this).val(e.item.value),$(this).attr("data-id",e.item.idCus),$(this).parents(".box-data-customer").find(".btn-cleardata").show(),$(this).parents(".box-data-customer").find(".btn-addCus").hide(),$(this).parents(".box-data-customer").find("input").attr("readonly","readonly"),$(this).parents(".box-data-customer").addClass("readonly");let a=$("#ul-tab-order li a.active").data("id");$("#item-mon").length>0&&void 0!==a&&await loadeventPos.updateCustomerOrder(e.item.value)}}).focus((function(){$("#parentautocomplete").css({height:"calc(100vh - 100px)",top:"52px","z-index":"5"}),$(this).autocomplete("search"),$(this).select()})))},updateCustomerOrder:async function(t){cusocde="";let e=$("#ul-tab-order").find("a.active").data("id");""!=t&&(cusocde=t.split(" ")[0]);let a=$("#ul-tab-order a.active").data("id");const n=await axios({method:"post",url:"/Selling/OrderTable/UpdateCustomOrderTable",headers:{"Content-Type":"multipart/form-data"},data:{TypeUpdate:_TypeUpdatePos.ChangedCustomer,CusCode:cusocde,IdGuid:e}});if(n.data.isValid){let t=ListCusByOrderPos.find((t=>t.idOrder==a)),e=$(".search-customer").val();if(void 0===t&&""!=e){let t={};t.idOrder=a,t.customerCode=e.split(" ")[0],t.customerName=n.data.data,ListCusByOrderPos.push(t)}else if(t&&""==e){let t=ListCusByOrderPos.findIndex((t=>t.idOrder==a));ListCusByOrderPos.splice(t,1)}}},loadEventClose:function(){$(".box-data-customer").find(".btn-cleardata").unbind(),$(".box-data-customer").find(".btn-cleardata").click((async function(){$(this).parents(".box-data-customer").find(".btn-cleardata").hide(),$(this).parents(".box-data-customer").find(".btn-addCus").show(),$(this).parents(".box-data-customer").find("input").removeAttr("readonly"),$(this).parents(".box-data-customer").removeClass("readonly"),$(this).parents(".box-data-customer").find("input").val(""),$(this).parents(".box-data-customer").find("input").focus();let t=$("#ul-tab-order li a.active").data("id");$("#item-mon").length>0&&void 0!==t&&await loadeventPos.updateCustomerOrder(""),$(this).parents(".box-data-customer").find("input").removeAttr("data-id")}))},loadEventAddCustomer:function(){$(".btn-addCus").click((function(){eventCreate.addOrEditCustomer("/Selling/Customer/Create?IsPos=true")}))},loadEventkeyCode:function(){document.onkeyup=function(t){var e=window.event?event.keyCode:t.keyCode;113==e&&_classPosEvent.input_searchProduct.focus();115==e&&_classPosEvent.input_searchCustomer.focus();81==e&&$(".btn-payment").length>0&&$(".btn-payment").trigger("click");66==e&&$(".btn-barcode").length>0&&($(".btn-barcode").hasClass("active")?(localStorage.setItem("Barcode",0),$(".btn-barcode").removeClass("active"),toastrcus.warning("Hủy chế độ quét mã QRcode/Barcode"),eventBanle.enableOrDisnableSancanbarCode(!1)):(localStorage.setItem("Barcode",1),$(".btn-barcode").addClass("active"),toastrcus.success("Bật chế độ quét mã QRcode/Barcode"),eventBanle.enableOrDisnableSancanbarCode(!0)));119==e&&($(".btn-payment").trigger("click"),$(".discountamount").length>0&&($(".discountamount").focus(),$(".discountamount").select()));120==e&&($(".cussendamount").focus(),$(".cussendamount").select())}},loadDatatable:async function(t){t.addClass("active"),id=$(t).data("id"),await loadeventPos.loadOrderByTable(id);let e=$(t).find("b").text();$(".btn-showttable").attr("data-id",id),$(".btn-showttable").find(".showTableOrder").html(e),$(".search-customer").focus((function(){$(this).parent(".input-group").addClass("focus-input")})),$(".search-customer").blur((function(){$(this).parent(".input-group").removeClass("focus-input")}))},loadClickTableroom:function(){$("#lst-roomandtable li").click((async function(){if(!$(this).hasClass("active")){$("#lst-roomandtable").find("li.active").not($(this)).removeClass("active"),$(this).addClass("active");let e=$(this).data("id");await loadeventPos.loadOrderByTable(e);let a=$(this).find("b").text();$(".btn-showttable").attr("data-id",e),$(".btn-showttable").find(".showTableOrder").html(a),t=$(this).index(),"undefined"!=typeof Storage?localStorage.setItem("activeTable",t):alert("Liên hệ đội ngủ hỗ  trợ lỗi trình duyệt của bạn không hỗ  trợ Storage"),$(".search-customer").focus((function(){$(this).parent(".input-group").addClass("focus-input")})),$(".search-customer").blur((function(){$(this).parent(".input-group").removeClass("focus-input")}))}var t;let e=localStorage.getItem("showMenuInSelectTable");void 0!==e&&1==parseInt(e)&&($(".ele-tab-leftRoomMenu .tab-menuOrder a").trigger("click"),localStorage.setItem("menuOrderShow",1))})),function(){if("undefined"!=typeof Storage){var t=localStorage.getItem("activeTable");if(isNaN(parseInt(t))){let t=$("#lst-roomandtable li:nth-child(1)");loadeventPos.loadDatatable(t)}else{t=parseInt(t)+1,$("#lst-roomandtable li").length<t&&(t=1);let e=$("#lst-roomandtable li:nth-child("+t+")");loadeventPos.loadDatatable(e)}}else alert("Liên hệ đội ngủ hỗ  trợ lỗi trình duyệt của bạn không hỗ  trợ Storage")}()},loadEventActiveTabMenuLeft:function(){"1"==localStorage.getItem("menuOrderShow")&&$(".ele-tab-leftRoomMenu li.tab-menuOrder a").trigger("click"),$(".ele-tab-leftRoomMenu li").click((function(){$(this).hasClass("tab-menuOrder")?localStorage.setItem("menuOrderShow",1):localStorage.setItem("menuOrderShow",0)}))},loadClicktabOrder:function(){$("#ul-tab-order li a").unbind(),$("#ul-tab-order li a").click((function(){let t=$(this).data("id");void 0!==ListNoteOrder.find((e=>e.idOrder==t))?loadeventPos.eventUpdateClassNote(!0):loadeventPos.eventUpdateClassNote(!1);let e=ListCusByOrderPos.find((e=>e.idOrder==t)),a=$(".search-customer");void 0!==e?(a.val(e.customerCode+" "+e.customerName),a.parents(".box-data-customer").find(".btn-cleardata").show(),a.parents(".box-data-customer").find(".btn-addCus").hide(),a.parents(".box-data-customer").find("input").attr("readonly","readonly"),a.parents(".box-data-customer").addClass("readonly")):(a.parents(".box-data-customer").find(".btn-cleardata").hide(),a.parents(".box-data-customer").find(".btn-addCus").show(),a.parents(".box-data-customer").find("input").removeAttr("readonly"),a.parents(".box-data-customer").removeClass("readonly"),a.parents(".box-data-customer").find("input").val("")),void 0===t?loadeventPos.loadAmoutAndQuantity(0,0):loadeventPos.loadAmoutAndQuantity(null,null,t),loadeventPos.eventCheckBtnNotifyOrder($(this))}))},loadOrderByTable:async function(t){var e=await axios.get("/Selling/OrderTable/LoadDataOrder?idtable="+t);if(!e.data.isValid)return!1;$("#container-tableOder").html(e.data.data),loadeventPos.loadeventAddNote(),loadeventPos.loadCloneitem(),loadeventPos.eventUpdatedataItemMonOrder(),e.data.dataCus.length>0&&(ListCusByOrderPos=e.data.dataCus),e.data.dataNote.length>0&&(ListNoteOrder=e.data.dataNote),e.data.active&&$("#lst-roomandtable li.active").addClass("CurentOrder"),numberFormat(),loadeventPos.loadEventAddCustomer(),_classPosEvent={input_searchProduct:$(".search-product"),input_searchCustomer:$(".search-customer")},loadeventPos.loadeventChangetableOrder(),loadeventPos.loadEventClickIconAddAndMinus(),loadeventPos.loadEventkeyCode(),loadeventPos.loadAddTabOrder(),loadeventPos.loadAutocomplete(!1,!0),loadeventPos.loadEventClose(),loadeventPos.loadClicktabOrder(),$("#ul-tab-order a:first").trigger("click"),loadeventPos.loadAmoutAndQuantity(),loadEventadmin.evnetFullscreen()},loadAddTabOrder:function(){$(".add-tab").click((function(t){let e=!0;if($("#ul-tab-order").find("li").not($(this)).map((function(t,a){"newtab"==$(this).data("title")&&(e=!1)})),!e)return!1;if($("#ul-tab-order").find("li").not($(this)).length>6)return toastr.warning("Mỗi bàn tối đa 6 đơn chưa thanh toán, vui lòng thanh toán bớt để order thêm!"),!1;let a=makeid(5);var n=$("#ul-tab-order li.nav-item").length+1;0==$("#ul-tab-order li.nav-item").length?$(this).parents("ul#ul-tab-order").find("li").before('<li class="nav-item"><a class="nav-link" href="#tab'+n+'" data-toggle="tab"><span class="orderCode">OD-New</span> <span class="btn-removeTab '+a+'"><i class="fas fa-times"></i></span></a></li>'):$(this).parents("ul#ul-tab-order").find("li:nth-child("+(n-1)+")").after('<li class="nav-item"><a class="nav-link" href="#tab'+n+'" data-toggle="tab"><span class="orderCode">OD-New</span> <span class="btn-removeTab '+a+'"><i class="fas fa-times"></i></span></a></li>'),$('<div class="tab-pane" id="tab'+n+'" role="tabpanel">\n                             <div class="tab-pane " id="tab-order-0" role="tabpanel">\n                                <div class="no-order">\n                                    <img src="../images/ristorante_old.png" />\n                                    <b>Chưa có món nào được chọn</b>\n                                    <span>Vui lòng chọn món trong thực đơn</span>\n                                </div>\n                            </div>\n                        </div>').appendTo(".tab-content-order"),loadeventPos.loadClicktabOrder(),$("#ul-tab-order a:last").trigger("click"),$("#ul-tab-order a:last").parent("li").data("title","newtab"),loadeventPos.loadEventRemoveTaborder("."+a)})),loadeventPos.loadEventRemoveTaborder()},loadeventShowactionmobi:function(){$(".btn-moreaction-pos").click((function(){html="<div class='showindex'></div>",$(".action-left-footer").after(html),$(".action-left-footer").toggleClass("show"),$(".action-left-footer").hasClass("show")||$(".showindex").remove(),$(".showindex").click((function(){$(".action-left-footer").toggleClass("show"),$(".showindex").remove()}))}))},loadEventRemoveTaborder:function(t=""){""==t&&(t=$("#ul-tab-order .btn-removeTab")),$(t).click((function(){"newtab"==$(t).parent().parent().data("title")?($(this).parents(".nav-item").remove(),$(".tab-content-order > div.active").remove(),0==$("#ul-tab-order").find(".nav-item").length?$("#ul-tab-order").find(".add-tab").trigger("click"):$("#ul-tab-order a:first").trigger("click"),loadeventPos.checkHighlightTableInOrder()):loadeventPos.removeOder($(this).parents(".nav-item"))}))},CheckOutOrder:async function(){let t=parseInt($("#discountPayment").data("type")),e=parseInt($("#discountPayment").data("value")),a=0;t==TypeSelectDiscount.Percent&&(a=e);let n=$("#dataTablePayment").data("id"),i=$("#discountPayment").val().replaceAll(",",""),o=$(".cuspay").val().replaceAll(",","")||0,l=$("input[name=idPaymentMethod]:checked",".paymentMethod").data("id")||0;var r="",s=$("#Vatrate").val(),d=$(".VATAmount").text().replaceAll(",","")||0,c=$(".amountPayment").text().replaceAll(",","")||0;let u=!1;"true"==localStorage.getItem("VATMTT")&&(u=!0),$.ajax({type:"POST",async:!0,url:"/Selling/OrderTable/CheckOutOrder",data:{TypeUpdate:_TypeUpdatePos.CheckOutOrder,IdOrder:n,VATAmount:d,Amount:c,discountPayment:i,discount:a,cuspayAmount:o,Idpayment:l,vat:u,Vatrate:s,ManagerPatternEInvoices:$("#ManagerPatternEInvoices").val()},success:async function(t){if(isValid=t.isValid,t.isValid){Swal.close(),r=t.data;let e=$("#lst-roomandtable li.active");await loadeventPos.loadOrderByTable(e.data("id"));let a=$(e).find("b").text();$(".btn-showttable").attr("data-id",e.data("id")),$(".btn-showttable").find(".showTableOrder").html(a),loadeventPos.checkHighlightTableInOrder(),""!=r&&printDiv(r)}},error:function(t){console.log(t)}})},eventChangeCheckbocVAT:function(){$.ajax({type:"GET",global:!1,url:"/Selling/ConfigSaleParameters/GetConfigSell?key="+getObjectKey(EnumConfigParameters,EnumConfigParameters.AUTOVATINPAYMENT),success:function(t){t.isValid?t.data.typeValue==EnumTypeValue.BOOL&&"false"==t.data.value?$(".actionpaymentMTTpos").length>0&&$(".actionpaymentMTTpos").removeClass("d-none"):($(".actionpaymentMTTpos").length>0&&$(".actionpaymentMTTpos").remove(),localStorage.setItem("VATMTT","true")):$(".actionpaymentMTTpos").length>0&&$(".actionpaymentMTTpos").removeClass("d-none")},error:function(){alert("Error occured!!")}}),$(".paymentvatmtt").click((function(){let t=$(this).is(":checked");localStorage.setItem("VATMTT",t)})),void 0!==localStorage.getItem("VATMTT")&&"true"==localStorage.getItem("VATMTT")&&$(".paymentvatmtt").attr("checked","checked")},eventLoadCongThucTien:function(){let t=$(".totalPayment").text().replaceAll(",","")||0,e=$("#discountPayment").val().replaceAll(",","")||0,a=parseFloat(t)-parseFloat(e)||0,n=0;if($(".ele-vatrate").hasClass("d-none"))$("#dataTablePayment").data("isVat",0);else if(parseInt($("#errVATrate").val())>0){var i=0;$("table#dataTablePayment tbody tr").map((function(){let t=parseFloat($(this).find(".totalpro").html().replaceAll(",",""))||0;if(i+=t,$(this).find(".vatratepro").length>0){parseFloat($(this).find(".vatratepro").html().replaceAll(",",""));let t=parseFloat($(this).find(".vatratepro").data("vatamount"))||0;n+=t}else{let e=parseFloat($("#Vatrate").val())||0,a=t*parseFloat(e/100);n+=a}})),a=i,$(".VATAmount").html(Math.round(n).format0VND(0,3,"")),$("#dataTablePayment").data("isVat",1)}else n=Math.round(a*(parseFloat($("#Vatrate").val()||0)/100)),$(".VATAmount").html(n.format0VND(0,3,"")),$("#dataTablePayment").data("isVat",1);let o=a+n;parseInt($("#errVATrate").val())>0&&(o-=e),o=Math.round(o),$(".amountPayment").html(o.format0VND(0,3,""));let l=$(".cuspay").val().replaceAll(",","");1==$(".cuspay").data("select")?(l=parseFloat(l.replaceAll(",","")),$(".amoutchange").html((l-o).format0VND(0,3,""))):($(".cuspay").val(o.format0VND(0,3,"")),$(".amoutchange").html(0))},eventprint:function(){$(".btn-printbill").click((function(){let t=!1;"true"==localStorage.getItem("VATMTT")&&(t=!0);let e=$("#ul-tab-order > li").find("a.active").data("id");if(t){let a='<select id="Vatrate" name="Vatrate" class="form-control Vatrate">\n                                        <option value="0">0%</option>\n                                        <option value="5">5%</option>\n                                        <option value="8">8%</option>\n                                        <option value="10" selected>10%</option>\n                                    </select>';Swal.fire({icon:"warning",title:"Lựa chọn thuế suất?",html:a,showCancelButton:!0,confirmButtonText:'<i class="fas fa-print"></i> Tiếp tục in',cancelButtonText:'<i class="fas fa-power-off"></i> Hủy bỏ không in nữa'}).then((a=>{if(a.isConfirmed){let a=parseInt($("#Vatrate").val())||-1;$.ajax({type:"GET",async:!0,url:"/Selling/OrderTable/PrintOrderTale",data:{id:e,vat:t,Vatrate:a},success:function(t){t.isValid&&printDiv(t.html)},error:function(t){console.log(t)}})}}))}else{let a=-1;$.ajax({type:"GET",async:!0,url:"/Selling/OrderTable/PrintOrderTale",data:{id:e,vat:t,Vatrate:a},success:function(t){t.isValid&&printDiv(t.html)},error:function(t){console.log(t)}})}}))},eventPayment:function(){$(".btn-payment").click((function(){let t=$("#ul-tab-order > li").find("a.active").data("id"),e=!1;"true"==localStorage.getItem("VATMTT")&&(e=!0),$.ajax({type:"GET",url:"/Selling/OrderTable/Payment",data:{TypeUpdate:_TypeUpdatePos.Payment,vat:e,IdOrder:t},success:function(t){t.isValid&&Swal.fire({title:t.title,html:t.data,showClass:{popup:"popup-formcreate popupform-payment"},onOpen:()=>Swal.getConfirmButton().focus(),footer:"<button class='btn btn-primary btn-continue mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='btn btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Thanh toán</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didOpen:()=>{Swal.getHtmlContainer().querySelector(".cuspay").select()},didRender:()=>{document.onkeyup=function(t){13==(window.event?event.keyCode:t.keyCode)&&loadeventPos.CheckOutOrder()},$("select#ManagerPatternEInvoices").on("change",(function(){var t=this.options[this.selectedIndex].text;type=parseInt(t.split("/")[0]),type==TypeEInvoice.GTGT?($("#dataTablePayment").data("isVat",1),$(".table-info-pay tr.ele-vatrate").removeClass("d-none")):($("#dataTablePayment").data("isVat",0),$(".table-info-pay tr.ele-vatrate").hasClass("d-none")||$(".table-info-pay tr.ele-vatrate").addClass("d-none")),loadeventPos.eventLoadCongThucTien()})),$("select#Vatrate").on("change",(function(){if(parseInt($("#errVATrate").val())>0&&parseFloat($(this).val())!=parseFloat($("#errVATrate").data("vatrate")))return toastrcus.error("Giá trị thuế suất bạn chọn không phù hợp với thuế suất trong chi tiết đơn"),void $("#Vatrate option[value='"+parseFloat($("#errVATrate").data("vatrate"))+"']").prop("selected","selected");loadeventPos.eventLoadCongThucTien()})),$("input.icheckpayment").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"}),priceFormat(),$(".number3").each((function(){let t=$(this).text().replaceAll(",",".");$(this).html(parseFloat(t).format0VND(0,3,""))})),$("#dataTablePayment").data("id",t.idOrder);var e=0;$("#discountPayment").click((function(){$("#discountPayment").after('<div id="popupselectDiscount">\n                                                   <div class="overlazy"></div>\n                                                   <div class="ele-discount" id="ousSizeOutPopup">\n                                                        <span> Giảm giá theo: </span>\n                                                        <div class="content">\n                                                            <div class="form-check-inline">\n                                                              <label class="form-check-label mr-3">\n                                                                <input type="radio" class="form-check-input" id="radio1" name="optradiocheckboxdis" value="2" checked> Số tiền (VND)\n                                                              </label>\n                                                              </div>\n                                                              <div class="form-check-inline">\n                                                              <label class="form-check-label">\n                                                                <input type="radio" class="form-check-input" id="radio2" name="optradiocheckboxdis" value="1"> Phần trăm (%)\n                                                              </label>\n                                                            </div>\n                                                            <div class="text">\n                                                                <input class="data-value form-control number3" id="discounttypevalue" placeholder="Nhập số tiền" />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>'),evetnFormatnumber3(),loadeventPos.showPopupSelectDiscount()})),$(".overlazy").click(),0==e&&(e=parseInt($(".amountPayment").html().replaceAll(",",""))||0),$(".lst-amount-paycus span").click((function(){let t=parseInt($(this).data("value"));$(".cuspay").val(t.format0VND(0,3,"")),$(".cuspay").data("select",1),$(".cuspay").trigger("keyup")})),$(".cuspay").keyup((function(){e=parseInt($(".amountPayment").html().replaceAll(",",""));let t=parseInt($(this).val().replaceAll(",",""))||0;cuspayamount=t;let a=t-e;$(".amoutchange").html(a.format0VND(0,3,""))})),loadeventPos.eventLoadCongThucTien(),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){parseInt($("#errVATrate").val())>1?toastrcus.error("Hàng hóa trên đơn này có nhiều hơn một thuế suất, không thế thanh toán xuất hóa đơn!"):loadeventPos.CheckOutOrder()}))}})},error:function(t){toastr.error(t),console.log(t)}})}))},showPopupSelectDiscount:function(){let t=TypeSelectDiscount.Cash,e=0,a=0;function n(){if(t==TypeSelectDiscount.Cash){let t=parseFloat($("#discounttypevalue").val().replaceAll(",",""));e=t,$("#discountPayment").val(t.format0VND(3,3)),$("#discountPayment").data("value",t)}else if(t==TypeSelectDiscount.Percent){let t=parseFloat($(".totalPayment").text().replaceAll(",","")),e=parseFloat($("#discounttypevalue").val().replaceAll(",","")),n=Math.round(parseFloat(t*(e/100)));a=e,$("#discountPayment").val(n.format0VND(3,3)),$("#discountPayment").data("value",e)}$("#discountPayment").data("type",t),loadeventPos.eventLoadCongThucTien()}void 0!==$("#discountPayment").data("type")&&(t=parseInt($("#discountPayment").data("type")),value=parseInt($("#discountPayment").data("value")),$("input:radio[value="+t+"][name='optradiocheckboxdis']").prop("checked",!0),$("#discounttypevalue").val(value),t==TypeSelectDiscount.Cash?e=value:t==TypeSelectDiscount.Percent&&(a=value)),$("input:radio[name=optradiocheckboxdis]").change((function(){let i=$("input[name='optradiocheckboxdis']:checked").val();i==TypeSelectDiscount.Cash?(t=TypeSelectDiscount.Cash,$("#discounttypevalue").val(e.format0VND(3,3))):i==TypeSelectDiscount.Percent&&(t=TypeSelectDiscount.Percent,$("#discounttypevalue").val(a.format0VND(3,3))),n(),$("#discounttypevalue").select(),setTimeout((()=>{$("#discounttypevalue").select()}),150)})),$("#discounttypevalue").keyup((function(){n()})),$(".overlazy").on("click",(function(t){0===$(t.target).closest("#ousSizeOutPopup").length&&$("#popupselectDiscount").remove()})),setTimeout((()=>{$("#discounttypevalue").select()}),200)},NotifyChitken:function(){let t=$("#ul-tab-order a.active").data("id");$(".btn-notif").attr("disabled","disabled"),$.ajax({type:"POST",traditional:!0,async:!0,url:"/Selling/OrderTable/NotifyKitChen",data:{IdOrder:t},success:function(t){t.isValid?(loadeventPos.eventUpdateQuantityItemMonOrder(),t.isNotPrint||loadeventPos.eventinbaobep(t.html)):$(".btn-notif").removeAttr("disabled")},error:function(t){console.log(t)}})},eventinbaobep:function(t){dataObject={},dataObject.type=TypeEventWebSocket.PrintBep,dataObject.html=t,sposvietplugin.sendConnectSocket(listport[0]).then((function(t){console.log(t),sposvietplugin.connectSignatureWebSocket(listport[0],JSON.stringify(dataObject)).then((function(t){"-1"==t&&toastrcus.error("Có lỗi xảy raaaaaaaa")}))}))},eventShowHistory:function(){$(".btn-history").click((async function(){let t=$("#ul-tab-order a.active").data("id");jQueryModalGetRightToLeft("/Selling/OrderTable/GetHistoryOrder?IdOrder="+t,"Lịch sử gọi món (Đã thông báo bếp)")}))},eventSplitOrder:function(){$(".btn-splitOder").click((async function(){if(0==$(".tab-content-order .tab-pane.active").find("#item-mon").length)return toastr.error("Bàn chưa có món nào không thể tách đơn"),!1;let t=$("#ul-tab-order a.active").data("id"),e=$(".btn-showttable").data("id");e=e=!1,lstRom=[],$("#lst-roomandtable li.CurentOrder").map((function(){let t={};t.id=$(this).data("id"),t.text=$(this).find("b").html(),lstRom.push(t)}));const a="/Selling/OrderTable/SplitOrder?TypeUpdate="+_TypeUpdatePos.SplitOrder+"&IdOrder="+t+"&IsBringBack="+e;var n=await axios.get(a);await Swal.fire({html:n.data,showClass:{popup:"popup-formcreate popupform-payment"},footer:"<button class='swal2-cancel swal2-styled btn-continue swal2-styled mr-3'><i class='icon-cd icon-add_cart icon'></i>Hủy bỏ</button><button class='swal2-confirm swal2-styled btn-save btn-success'><i class='icon-cd icon-doneAll icon'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,closeOnConfirm:!1,confirmButtonText:'<i class="fa fa-save"></i> Lưu',cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didOpen:()=>{},didRender:async()=>{let e=$("#lst-roomandtable li.active").data("id"),a=!1;"-1"==e&&(a=!0),lstRomAll=[],$("#lst-roomandtable li").map((function(){let t={};t.id=$(this).data("id"),t.text=$(this).find("b").html(),lstRomAll.push(t)})),$("#lstroomselectTach").prepend("<option selected></option>").select2({data:lstRomAll,placeholder:{id:"",text:"Chọn bàn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}),$("#lstroomselect").prepend("<option selected></option>").select2({data:lstRom,placeholder:{id:"",text:"Chọn bàn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}).on("change",(async function(e){var n=$(this).val();a="-1"==n;var i=await axios.get("/Selling/OrderTable/LoadDataOrderByTableInSplit?idtable="+n+"&IdOrder="+t+"&Type="+_TypeSpitOrderPos.Graft+"&IsBringBack="+a);$(".tableOrderRoom").html(i.data.html),evetnFormatTextnumber3decimal(),$(".tableOrderRoom input.icheck").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"})})),$("#flexCheckDefault").on("ifChanged",(function(t){$(".tabtachdon").toggleClass("d-none"),$(".tabghepdon").toggleClass("d-none")}));var n=await axios.get("/Selling/OrderTable/LoadDataOrderByTableInSplit?idtable="+e+"&IdOrder="+t+"&Type="+_TypeSpitOrderPos.Separate+"&IsBringBack="+a);$(".table-tachdon").html(n.data.html);var i=await axios.get("/Selling/OrderTable/GetOrderStatusNew?Status=0&NotOrder="+t);$("#listOrderNew").prepend('<option value="0">Tạo đơn mới</option>').select2({data:i.data.json,placeholder:{id:"",text:"Chọn đơn"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}).on("change",(async function(t){"0"==$(this).val()?$(".elepaternlstroomselectTach").show():$(".elepaternlstroomselectTach").hide()})),evetnFormatTextnumber3decimal(),loadeventPos.eventSpitQuntity(),$(".form-splitOrder input.icheck").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"}),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){lstdataOrderNew=[],lstdataOrderOld=[];let e=$('input[name="orderActions"]:checked').val();if(e==_TypeSpitOrderPos.Separate){let e=!1,a=$("#listOrderNew").val();"0"==a&&(e=!0);let n=!1,i=$("#lstroomselectTach").val();if(""==a)return void toastr.error("Vui lòng chọn bàn cần tách đến!");if("0"==a&&""==i)return void toastr.error("Vui lòng chọn bàn cần tách, khi tạo đơn mới!");if("-1"==i&&(n=!0),$(".table-tachdon table tr").map((function(){let t=$(this).children("td.quantity").data("id"),e=$(this).children("td.quantitySplit").find(".quantyti-new").data("id");parseInt(e)>0&&(dataOrderNew={},dataOrderNew.quantity=e,dataOrderNew.idOrderitem=$(this).data("id"),lstdataOrderNew.push(dataOrderNew)),parseInt(t)>0&&(dataOrderNewold={},dataOrderNewold.quantity=t,lstdataOrderOld.push(dataOrderNewold))})),0==lstdataOrderNew.length)return void toastr.error("Vui lòng chọn món cần tách!");if(0==lstdataOrderOld.length)return void toastr.error("Đơn gốc còn lại có ít nhất một món hàng!");things=JSON.stringify(lstdataOrderNew),$.ajax({type:"POST",traditional:!0,url:"/Selling/OrderTable/SplitOrder",data:{TypeUpdate:_TypeSpitOrderPos.Separate,IsNewOrder:e,IdOrderOld:t,IdOrderNew:a,IdTable:i,IsBringBack:n,json:things},success:function(t){if(isValid=t.isValid,t.isValid){Swal.close();let t=$("#lst-roomandtable li.active").data("id");$("#lst-roomandtable li.active").removeClass("active"),$("#lst-roomandtable li:not(.CurentOrder)").map((function(){$(this).data("id")==i&&$(this).addClass("CurentOrder")})),$("#lst-roomandtable li.CurentOrder").map((function(){$(this).data("id")==t&&$(this).trigger("click")}))}},error:function(t){console.log(t)}})}else if(e==_TypeSpitOrderPos.Graft){let e=[],a=$("#lstroomselect").val();if(""==a)return void toastr.error("Vui lòng chọn bàn cần ghép");if($(".tableOrderRoom table tbody tr").map((function(){$(this).find('input[name="orderName"]:checked').length>0&&void 0!==$(this).data("id")&&(item={},item.idOrder=$(this).data("id"),e.push(item))})),0==e.length)return void toastr.error("Vui lòng chọn đơn cần ghép!");things=JSON.stringify(e),$.ajax({type:"POST",traditional:!0,url:"/Selling/OrderTable/SplitOrder",data:{TypeUpdate:_TypeSpitOrderPos.Graft,IdOrderOld:t,json:things},success:function(t){isValid=t.isValid,t.isValid&&(Swal.close(),$("#lst-roomandtable li.active").removeClass("CurentOrder"),$("#lst-roomandtable li.CurentOrder").map((function(){$(this).data("id")==a&&$(this).trigger("click")})))},error:function(t){console.log(t)}})}}))}})}))},eventSpitQuntity:function(){$(".table-tachdon table tr .lst-action i:last-child").click((function(){let t=$(this).parents("tr"),e=t.children("td.quantity").data("old"),a=t.children("td.quantity").data("id"),n=t.children("td.quantitySplit").find(".quantyti-new").data("id");if(0==parseInt(a));else{let e=parseInt(n)+1;n=e,t.children("td.quantitySplit").find(".quantyti-new").data("id",e),t.children("td.quantitySplit").find(".quantyti-new").html(e);let i=parseInt(a)-1;a=i,t.children("td.quantity").data("id",i),t.children("td.quantity").html(i)}parseInt(e)!=parseInt(a)?t.addClass("change-quantity"):t.removeClass("change-quantity")})),$(".table-tachdon table tr .lst-action i:first-child").click((function(){let t=$(this).parents("tr"),e=t.children("td.quantity").data("old"),a=t.children("td.quantity").data("id"),n=t.children("td.quantitySplit").find(".quantyti-new").data("id");if(0==parseInt(n));else{let e=parseInt(n)-1;n=e,t.children("td.quantitySplit").find(".quantyti-new").data("id",e),t.children("td.quantitySplit").find(".quantyti-new").html(e);let i=parseInt(a)+1;a=i,t.children("td.quantity").data("id",i),t.children("td.quantity").html(i)}parseInt(e)!=parseInt(a)?t.addClass("change-quantity"):t.removeClass("change-quantity")}))},eventloadNumberStatusTable:function(){let t=0,e=0,a=0;$("#lst-roomandtable li").map((function(){t+=1;var n=$(this);n.hasClass("CurentOrder")?e+=1:n.not(".CurentOrder")&&(a+=1)})),$('.list-other-table input[name="optiontablename"]').map((function(){let n=$(this);switch(parseInt(n.val())){case _TypeSelectTableRadio.All:n.parents(".form-check").find(".value").html(t);break;case parseInt(_TypeSelectTableRadio.IsActive):n.parents(".form-check").find(".value").html(e);break;case _TypeSelectTableRadio.No:n.parents(".form-check").find(".value").html(a)}})),$('.list-other-table input[name="optiontablename"]:checked').trigger("ifChecked")},eventLoadCheckradiotable:function(){$('.list-other-table input[name="optiontablename"]').on("ifChecked",(function(t){switch(parseInt(t.target.value)){case _TypeSelectTableRadio.All:$("#lst-roomandtable li").filter((function(){$(this).css("display","flex")}));break;case parseInt(_TypeSelectTableRadio.IsActive):$("#lst-roomandtable li").filter((function(){var t=$(this);t.hasClass("CurentOrder")?t.css("display","flex"):t.css("display","none")}));break;case _TypeSelectTableRadio.No:$("#lst-roomandtable li").filter((function(){var t=$(this);t.hasClass("CurentOrder")?t.css("display","none"):t.css("display","flex")}));break;default:console.log(_TypeSelectTableRadio.All)}}))},eventAddNoteOrder:function(){$(".btn-noteOder").click((function(){if(0==$(".tab-content-order .tab-pane.active").find("#item-mon").length)return toastr.error("Bàn chưa có món nào không thể tạo ghi chú"),!1;let t=$("#ul-tab-order a.active").data("id"),e="",a=ListNoteOrder.find((e=>e.idOrder==t));void 0!==a&&(e=a.note),Swal.fire({title:"Nhập ghi chú đơn",input:"textarea",inputValue:e,inputPlaceholder:"Nhập ghi chú đơn",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Lưu ghi chú",cancelButtonText:"Đóng",showLoaderOnConfirm:!0,inputValidator:e=>{if(void 0===ListNoteOrder.find((e=>e.idOrder==t))&&!e)return"Vui lòng nhập ghi chú!"},preConfirm:e=>{$.ajax({type:"POST",url:"/Selling/OrderTable/AddNote",data:{TypeUpdate:_TypeUpdatePos.AddNoteOrder,IdOrder:t,Note:e},success:function(a){if(a.isValid){let a=ListNoteOrder.findIndex((e=>e.idOrder==t));if(ListNoteOrder.splice(a,1),""==e)loadeventPos.eventUpdateClassNote(!1);else{let a={};a.idOrder=t,a.note=e,ListNoteOrder.push(a),loadeventPos.eventUpdateClassNote(!0)}}},error:function(t){console.log(t)}})},allowOutsideClick:()=>!Swal.isLoading()})}))},eventUpdateClassNote:function(t=!0){t?$(".btn-noteOder").hasClass("curent-note")||$(".btn-noteOder").addClass("curent-note"):$(".btn-noteOder").removeClass("curent-note")},removeOder:function(t){let e=$(t).children("a").data("id");Swal.fire({icon:"warning",title:"Bạn có chắc chắn muốn xóa đơn không?",showCancelButton:!0,confirmButtonText:"Đồng ý",cancelButtonText:"Đóng"}).then((a=>{a.isConfirmed&&$.ajax({type:"POST",url:"/Selling/OrderTable/RemoveOder",data:{TypeUpdate:_TypeUpdatePos.RemoveOrder,IdOrder:e},success:function(a){if(a.isValid){$(t).remove(),$(".tab-content-order > div.active").remove(),0==$("#ul-tab-order").find(".nav-item").length?$("#ul-tab-order").find(".add-tab").trigger("click"):$("#ul-tab-order a:first").trigger("click"),loadeventPos.checkHighlightTableInOrder();let a=ListNoteOrder.findIndex((t=>t.idOrder==e));ListNoteOrder.splice(a,1)}},error:function(t){console.log(t)}})}))},loadActiveTableInOrder:async function(){var t=await axios.get("/Selling/OrderTable/LoadCheckOrderInTable");t.data.isValid&&($("#lst-roomandtable li").map((function(e,a){let n=$(this).data("id");if("-1"==n){let e=t.data.data.find((t=>t.isBringBack));void 0!==e&&e.isOrder&&$(this).addClass("CurentOrder")}else{let e=t.data.data.find((t=>t.idtable==n));void 0!==e&&e.isOrder&&$(this).addClass("CurentOrder")}})),loadeventPos.eventloadNumberStatusTable())},loadDataAttributeProductAndTable:function(){$("#lst-product li").map((function(){let t=$(this).data("id");$(this).removeAttr("data-id"),$(this).data("id",t)})),$("#lst-roomandtable li").map((function(){let t=$(this).data("id");$(this).removeAttr("data-id"),$(this).data("id",t)}))},loadEventCheckbox:function(){let t=localStorage.getItem("showMenuInSelectTable");void 0!==t&&1==parseInt(t)&&$(".showmenuClickroom input").iCheck("check"),$(".showmenuClickroom input").on("ifChecked",(function(t){localStorage.setItem("menuOrderShow",1),"undefined"!=typeof Storage?localStorage.setItem("showMenuInSelectTable",1):alert("Liên hệ đội ngủ hỗ  trợ lỗi trình duyệt của bạn không hỗ  trợ Storage")})),$(".showmenuClickroom input").on("ifUnchecked",(function(t){localStorage.setItem("menuOrderShow",0),"undefined"!=typeof Storage?localStorage.setItem("showMenuInSelectTable",0):alert("Liên hệ đội ngủ hỗ  trợ lỗi trình duyệt của bạn không hỗ  trợ Storage")}))}},loadEventadmin={evnetFullscreen:function(){$(".btnfullScreen").click((function(){$(this).find("i").toggleClass("fa-compress"),$(this).find("i").toggleClass("fa-expand"),toggleFullScreen()}))},eventShowformAddPostOne:function(){loadevent();loaddataSelect2CustomsTempalte("/Api/Handling/GetAllCategoryPost","#IdCategory",$("#Category").val(),"Tất cả"),$("#elfinder-input").change((function(){$("#Imgdata").attr("src","/"+$(this).val())})),CKEDITOR.replace("Decription",{}),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){jQueryModalPost($("form#PostOnePage")[0])}))},event_removerowsortable:function(t){$(t).find(".fa-trash").click((function(){$(this).parents(".input-addcontent").remove(),""==$("#items-input-addcontent").html().trim()&&$("input[id=IsAddingOptions]").iCheck("uncheck"),$("#items-input-addcontent").find(".input-addcontent").length<2&&$(".btn-addoption").hasClass("disabled")&&$(".btn-addoption").removeClass("disabled"),loadEventadmin.eventGenerateDataPriceproduct($("#add-option-body"))}))},event_loadajaxdataselect2:async function(t,e=""){var a=await axios.get("/API/Handling/GetDataJsonStypeProduct?idselectd="+e);$(t).prepend("<option selected></option>").select2({data:a.data,placeholder:{id:"",text:"Chọn giá trị"},allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}}).on("change",(function(t){var e=$(this),a=!1;$($(this).parents("#items-input-addcontent").find("select").not($(this))).each((function(){e.val()!=$(this).val()||(a=!0)})),a?(e.parents(".input-addcontent").find(".validate-select").length>0&&e.parents(".input-addcontent").find(".validate-select").remove(),$(e).parent(".header-select").after("<div class='validate-select'><label class='isvalid'>Tên tùy chọn này đã được sử dụng</label></div>"),e.parents(".input-addcontent").find("input").attr("readonly","readonly").attr("disabled","disabled"),$(t.currentTarget).data().select2.$container.addClass("isvalid")):(e.parents(".input-addcontent").find("input").removeAttr("readonly").removeAttr("disabled"),e.parents(".input-addcontent").find(".validate-select").remove(),$(t.currentTarget).data().select2.$container.removeClass("isvalid"))}))},eventupdatesortableproduct:function(t){$(t).sortable("destroy"),$(t).sortable({handle:"button.Sortable-body-addoption",items:"div:not(.hidden-Sortable)",cancel:"textarea",axis:"y",zIndex:9999,distance:10,scrollSpeed:0,cursor:"move",tolerance:"pointer",connectWith:".m-card-sortable",cancel:".tile-option-choose",start:function(t,e){$(e.item).addClass("active-sortable")},stop:function(t,e){$(e.item).removeClass("active-sortable")},change:function(t,e){},update:function(t,e){loadEventadmin.eventGenerateDataPriceproduct($("#add-option-body"))}})},eventaddstypeoptionproduct:function(t){$(t.find("input")).keyup((function(){let t=!1,e=$(this),a=makeid(6),n='<div class="item-grid-sort hidden-Sortable '+a+'">\n                                    <button type="button" class="Sortable-body-addoption" role="button"><svg viewBox="0 0 20 20" class="Polaris-Icon__Svg_375hu" focusable="false" aria-hidden="true"><path d="M7 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm6-8a2 2 0 1 0-.001-4.001 2 2 0 0 0 .001 4.001zm0 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001z"></path></svg></button>\n                                    <input type="text" class="form-control" name="" data-id="0" placeholder="Nhập giá trị" />\n                                    <i class="fa fa-trash"></i>\n                               </div>';if($(this).val().length>0){e.parents(".item-grid-sort").hasClass("data-success")||(e.parents(".item-grid-sort").addClass("data-success"),e.parents(".item-grid-sort").find(".fa-trash").click((function(){$(this).parents(".item-grid-sort.data-success").remove(),loadEventadmin.eventGenerateDataPriceproduct($("#add-option-body"))}))),e.parents(".item-grid-sort").hasClass("hidden-Sortable")&&(e.parents(".item-grid-sort").removeClass("hidden-Sortable"),loadEventadmin.eventupdatesortableproduct("#items-input-addcontent .body-addoption"));let i=0;$($(this).parents(".body-addoption").find("input").not($(this))).each((function(){if(0==$(this).val().length)i+=1;else if($(this).val()==e.val())return void(t=!0)})),t?(e.removeClass("is-valid"),e.addClass("isvalid"),$(this).parents(".body-addoption").find("span.isvalid").length>0&&$(this).parents(".body-addoption").find("span.isvalid").remove(),e.after("<span class='isvalid'>Tên đã bị trùng</span>")):($(this).parents(".body-addoption").find("span.isvalid").remove(),e.removeClass("isvalid")),0==i&&($(this).parents(".body-addoption").append(n),loadEventadmin.eventaddstypeoptionproduct($("."+a)))}else e.parents(".item-grid-sort").removeClass("data-success"),e.parents(".item-grid-sort").hasClass("hidden-Sortable")||(e.parents(".item-grid-sort").addClass("hidden-Sortable"),loadEventadmin.eventupdatesortableproduct("#items-input-addcontent .body-addoption")),$($(this).parents(".body-addoption").find("input").not($(this))).each((function(){0==$(this).val().length&&$(this).parents(".item-grid-sort").remove()}));loadEventadmin.eventGenerateDataPriceproduct($(this))})),$("#add-option-body input").blur((function(){if($(this).hasClass("isvalid")){let t=$(this).val();$(this).parents(".body-addoption").find("span.isvalid").remove(),""==t.substring(0,t.length-1)?$(this).parents(".item-grid-sort").remove():($(this).val(t.substring(0,t.length-1)),$(this).removeClass("isvalid"))}}))},eventGenerateDataPriceproduct:function(t){var e=[],a="",n="",i=[],o=[],l=!1;if($("#items-input-addcontent").find(".input-addcontent").each((function(t,o){0==t?(a=$(this).find("select").val(),$(this).find("input").each((function(){var t={};""!=this.value.trim()&&(t.name=this.value,e.push(t))}))):1==t&&(n=$(this).find("select").val(),$(this).find("input").each((function(){var t={};""!=this.value.trim()&&(t.name=this.value,i.push(t))})))})),""!=a&&e.length>0&&(e.forEach((function(t){var e=t.name,l=a+"$"+removeVietnameseTones(t.name).replaceAll(" ","-").toLowerCase(),r={};i.length>0&&""!=n?i.forEach((function(t){var a={},i=e+"/"+t.name,r=l+"_"+n+"$"+removeVietnameseTones(t.name).replaceAll(" ","-").toLowerCase();a.name=i,a.code=r,o.push(a)})):(r.name=e,r.code=l,o.push(r))})),o.length>0)){let e="",a=[];if(ListArrNameStyleProductinDb.length>0&&(a=ListArrNameStyleProductinDb.filter((function(t){return void 0===o.find((e=>e.name==t.name))}))),o.forEach((function(t){let a="",n="";var i=t.name;let o="",r="",s="",d="0",c="",u="",p='<button type="button" class="btn btn-sm btn-primary mr-2 btn-edit">Sửa</button>\n                                  <button type="button" class="btn btn-sm btn-danger btn-delete">Xóa</button>';if(ListArrNameStyleProductinDb.length>0){void 0===ListArrNameStyleProductinDb.find((t=>t.name.toLowerCase()==i.toLowerCase()))&&(n='<span class="newrowedit">Mới</span>',a="newrowedit")}if(ListArrNameStyleProduct.length>0){let t=ListArrNameStyleProduct.find((t=>t.Name.toLowerCase()==i.toLowerCase()));if(void 0!==t&&(o=t.ClassName,r=t.Name,s=t.Code,c=t.Price,d=t.Id,u=t.Quantity,o.includes(_classremoteTr))){l=!0,p='<button type="button" class="btn btn-sm btn-danger btn-rollback '+makeid(5)+'">Khôi phục</button>'}}o.includes(a)&&(a=""),e+='\n                                    <tr class="'+o+" "+a+'" data-id="'+d+'">\n                                      <td><input type="checkbox" class="icheck item-check" /></td>\n                                      <td>\n                                         <div class="imgstypedetailt"></div>\n                                      </td>\n                                      <td><span class="name">'+i+"</span>"+n+'</td>\n                                      <td><input type="text" '+(o.includes(_classremoteTr)?"disabled readonly":"")+' class="form-control code" value="'+s+'" /></td>\n                                      <td><input type="text" '+(o.includes(_classremoteTr)?"disabled readonly":"")+' class="form-control price priceFormat" value="'+c+'"/></td>\n                                      <td><input type="text" '+(o.includes(_classremoteTr)?"disabled readonly":"")+' class="form-control quantity priceFormat" value="'+u+'"/></td>\n                                      <td>\n                                         <div class="lst-button">\n                                           '+p+"\n                                         </div>\n                                      </td>\n                                   </tr>\n                            "})),a.length>0){l=!0;let t=makeid(5);_lstbtnRemove='<button type="button" class="btn btn-sm btn-danger btn-rollback '+t+'">Khôi phục</button>',a.forEach((function(t,a){e+='\n                                    <tr class="readData '+_classremoteTr+'"  data-id="'+t.id+'">\n                                      <td><input type="checkbox" disabled class="icheck item-check" /></td>\n                                      <td>\n                                         <div class="imgstypedetailt"></div>\n                                      </td>\n                                      <td><span class="name">'+t.name+'</td>\n                                      <td><input type="text" disabled readonly class="form-control code" value="'+t.sku+'" /></td>\n                                      <td><input type="text" disabled readonly class="form-control price priceFormat" value="'+t.price+'"/></td>\n                                      <td><input type="text" disabled readonly class="form-control quantity priceFormat" value="'+t.quantity+'"/></td>\n                                      <td>\n                                         <div class="lst-button">\n                                           '+_lstbtnRemove+"\n                                         </div>\n                                      </td>\n                                   </tr>"}))}let n='<div class="pt-3 pb-3 w-100" id="add-table-styleproduct" style= "background-color: #f3f3f6;" >\n                            <div class="card" style="box-shadow:none">\n                                <div class="card-header">\n                                    <div>\n                                        <h3 style="font-size: 18px;font-weight:bold" class="mb-0">Mẫu mã</h3>\n                                    </div>\n                                </div>\n                                <div class="card-body">\n                                    <table class="table table-bordered" id="tableStylePrice">\n                                        <thead>\n                                            <tr>\n                                                <th><input type="checkbox" class="icheck" id="check-all" /></th>\n                                                <th>Hình ảnh</th>\n                                                <th>Mẫu mã</th>\n                                                <th>Mã hàng</th>\n                                                <th>Giá</th>\n                                                <th style="width:100px">Số lượng</th>\n                                                <th>Công cụ</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                            '+e+"\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                           </div >\n    ";loadEventadmin.enventloadeventTablestyleproduct(t,n,l)}},eventBtnRollbackItemtableStyleProduct:function(t){if($(t).parent().parents("tr."+_classremoteTr).find("input").removeAttr("readonly"),$(t).parent().parents("tr."+_classremoteTr).find("input").removeAttr("disabled"),$(t).parents("tr").find(".item-check").iCheck("enable"),$(t).parents("tr").removeClass(_classremoteTr),loadEventadmin.eventdeletebtnStyletableproduct($(t).parents("tr")),ListArrNameStyleProductinDb.length>0&&$(t).parents("tr").hasClass(_classloadTrDb)){let e=$(t).parents("tr").find(".name").text(),a="",n="";-1!=e.indexOf("/")?(a=e.split("/")[0],n=e.split("/")[1]):a=e,$("#items-input-addcontent").find(".input-addcontent").each((function(t,e){if(0==t){if(isValid=!1,$(this).find("input").each((function(){this.value==a&&(isValid=!0)})),!isValid){let t=makeid(5);htmlInput='<div class="item-grid-sort data-success '+t+'" >\n                                           <button type="button" class="Sortable-body-addoption" role="button"><svg viewBox="0 0 20 20" class="Polaris-Icon__Svg_375hu" focusable="false" aria-hidden="true"><path d="M7 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm6-8a2 2 0 1 0-.001-4.001 2 2 0 0 0 .001 4.001zm0 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001z"></path></svg></button>\n                                           <input type="text" class="form-control" name="" data-id="" placeholder="Nhập giá trị" value="'+a+'" />\n                                           <i class="fa fa-trash"></i>\n                                        </div>',$(this).find(".body-addoption").find("div.item-grid-sort.data-success").last().after(htmlInput),loadEventadmin.eventaddstypeoptionproduct($("."+t)),loadEventadmin.eventupdatesortableproduct($(this).find(".body-addoption")),loadEventadmin.eventGetDataStyletable(),loadEventadmin.eventGenerateDataPriceproduct($("#add-option-body"))}}else if(1==t&&(isValid=!1,$(this).find("input").each((function(){this.value==n&&(isValid=!0)})),!isValid)){let t=makeid(5);htmlInput='<div class="item-grid-sort data-success '+t+'" >\n                                           <button type="button" class="Sortable-body-addoption" role="button"><svg viewBox="0 0 20 20" class="Polaris-Icon__Svg_375hu" focusable="false" aria-hidden="true"><path d="M7 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm6-8a2 2 0 1 0-.001-4.001 2 2 0 0 0 .001 4.001zm0 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001z"></path></svg></button>\n                                           <input type="text" class="form-control" name="" data-id="" placeholder="Nhập giá trị" value="'+n+'" />\n                                           <i class="fa fa-trash"></i>\n                                        </div>',$(this).find(".body-addoption").find("div.item-grid-sort.data-success").last().after(htmlInput),loadEventadmin.eventaddstypeoptionproduct($("."+t)),loadEventadmin.eventupdatesortableproduct($(this).find(".body-addoption")),loadEventadmin.eventGetDataStyletable(),loadEventadmin.eventGenerateDataPriceproduct($("#add-option-body"))}}))}},loadEventBtnRollBack:function(t){let e=makeid(5);var a='<button type="button" class="btn btn-sm btn-danger btn-rollback '+e+'">Khôi phục</button>';$(t).parent(".lst-button").html(a),$("."+e).click((function(t){e=makeid(5),a='<button type="button" class="btn btn-sm btn-primary mr-2 btn-edit">Sửa</button>\n                                         <button type="button" class="btn btn-sm btn-danger btn-delete '+e+'">Xóa</button>',$(this).parent(".lst-button").html(a),loadEventadmin.eventBtnRollbackItemtableStyleProduct($("."+e))}))},eventdisabledRow:function(t){$(t).parents("tr").addClass(_classremoteTr),$(t).parents("tr").find("input").attr("readonly","readonly").attr("disabled","disabled"),$(t).parents("tr").find(".item-check").iCheck("uncheck"),$(t).parents("tr").find(".item-check").iCheck("disable")},eventdeletebtnStyletableproduct:function(t){$(t).find(".btn-delete").click((function(){var t=$(this).parents("tr"),e=$(this).parents("tr").find(".name").html().trim();if(-1==e.indexOf("/"))$(this).parents("tr").remove(),$("#items-input-addcontent").find(".body-addoption").find("input").each((function(t,a){this.value!=e||$(this).parents(".item-grid-sort").remove()}));else{var a=e.split("/"),n=!1,i=!1;$(this).parents("table#tableStylePrice").find("tbody").find("tr").not($(this).parents("tr")).not("tr.remove").each((function(t,e){var o=$(this).find(".name").html().split("/");o[1]==a[1].trim()&&(n=!0),o[0]==a[0].trim()&&(i=!0)})),n?(loadEventadmin.eventdisabledRow($(this)),loadEventadmin.loadEventBtnRollBack($(this))):(ListArrNameStyleProductinDb.length>0?(t.parents("table#tableStylePrice").find("tbody").find("tr.newrowedit").filter((function(){return $(this).find(".name").html().split("/")[1]==a[1]})).remove(),t.parents("table#tableStylePrice").find("tbody").find("tr.readData").not("."+_classremoteTr).each((function(){$(this).find(".name").html().split("/")[1]==a[1]&&(loadEventadmin.eventdisabledRow($(this).find(".btn-delete")),loadEventadmin.loadEventBtnRollBack($(this).find(".btn-delete")))}))):t.parents("table#tableStylePrice").find("tbody").find("tr").filter((function(){return $(this).find(".name").html().split("/")[1]==a[1]})).remove(),$("#items-input-addcontent").find(".input-addcontent").each((function(t,e){1==t&&$(this).find("input").each((function(){this.value==a[1]&&$(this).parents(".item-grid-sort").remove()}))}))),i||(ListArrNameStyleProductinDb.length>0?(t.parents("table#tableStylePrice").find("tbody").find("tr.newrowedit").filter((function(){return $(this).find(".name").html().split("/")[0]==a[0]})).remove(),t.parents("table#tableStylePrice").find("tbody").find("tr.readData").not("."+_classremoteTr).each((function(){$(this).find(".name").html().split("/")[0]==a[0]&&($(this).addClass(_classremoteTr),loadEventadmin.eventdisabledRow($(this).find(".btn-delete")),loadEventadmin.loadEventBtnRollBack($(this).find(".btn-delete")))}))):t.parents("table#tableStylePrice").find("tbody").find("tr").filter((function(){return $(this).find(".name").html().split("/")[0]==a[0]})).remove(),$("#items-input-addcontent").find(".input-addcontent").each((function(t,e){0==t&&$(this).find("input").each((function(){this.value==a[0]&&$(this).parents(".item-grid-sort").remove()}))})))}ListArrNameStyleProduct=[],0==$("#add-table-styleproduct").find("table").find("tbody").find("tr").length||$("#add-table-styleproduct").find("table").find("tbody").find("tr."+_classremoteTr).length==$("#add-table-styleproduct").find("table").find("tbody").find("tr").length?($("#add-table-styleproduct").remove(),loadEventadmin.eventRemoveAllStyle()):loadEventadmin.eventGetDataStyletable()}))},eventRemoveAllStyle:function(){$("input#IsAddingOptions").iCheck("uncheck")},eventGetDataStyletable:function(t=!1){ListArrNameStyleProduct=[],$("table#tableStylePrice").find("tbody").find("tr").each((function(t,e){let a=$(this).attr("class"),n=$(this).data("id"),i=$(this).find(".name").text(),o=$(this).find(".code").val(),l=$(this).find(".price").val().replaceAll(".",""),r=$(this).find(".quantity").val().replaceAll(".","");var s={};s.Name=i,s.Id=n,s.Code=o,s.Price=l,s.Quantity=r,s.ClassName=a,ListArrNameStyleProduct.push(s)})),t&&(ListArrNameStyleProductinDb=ListArrNameStyleProduct)},eventloadremovetablestyleproduct:function(){$("#add-table-styleproduct").remove()},eventloadIcheck:function(){var t=!1;$("#add-table-styleproduct .dataTables_scrollHead #check-all").on("ifChecked",(function(e){!0,$(this).parents("#add-table-styleproduct").find(".dataTables_scrollBody").find("tbody").find(".item-check").each((function(){$(this).iCheck("check")})),t=!1,!1})),$("#add-table-styleproduct .dataTables_scrollHead #check-all").on("ifUnchecked",(function(e){!0,t||$(this).parents("#add-table-styleproduct").find(".dataTables_scrollBody").find("tbody").find(".item-check").each((function(){$(this).iCheck("uncheck")})),!1,t=!1})),$("#add-table-styleproduct").find(".dataTables_scrollBody").find("tbody").find(".item-check").on("ifUnchecked",(function(e){t=!0,$(this).parents("#add-table-styleproduct").find(".dataTables_scrollHead #check-all").iCheck("uncheck")})),$("#add-table-styleproduct").find(".dataTables_scrollBody").find("tbody").find(".item-check").on("ifChecked",(function(e){t=!0;var a=$(this).parents("#add-table-styleproduct").find(".dataTables_scrollBody").find("tbody").find(".item-check").length,n=0;$(this).parents("#add-table-styleproduct").find(".dataTables_scrollBody").find("tbody").find(".item-check").each((function(){$(this).is(":checked")&&(n+=1)})),n==a&&$(this).parents("#add-table-styleproduct").find(".dataTables_scrollHead #check-all").iCheck("check")}))},eventbtnaddstypeoptionproduct:function(){$(".btn-addoption").click((async function(){if($("#items-input-addcontent").find(".input-addcontent").length>1)return void $(this).addClass("disabled");$(this).hasClass("disabled")&&$(this).removeClass("disabled");let t=makeid(5),e='<div class="input-addcontent pr-3 pt-3 pb-3 '+t+'">\n                                                       <div class="header-select mb-3 item-grid-sort">\n                                                            <label for="">Tên tùy chọn<span class="required">(*)</span></label>\n\n                                                            <button type="button" class="Sortable" role="button"><svg viewBox="0 0 20 20" class="Polaris-Icon__Svg_375hu" focusable="false" aria-hidden="true"><path d="M7 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm6-8a2 2 0 1 0-.001-4.001 2 2 0 0 0 .001 4.001zm0 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001z"></path></svg></button>\n                                                              \n                                                                <select class="form-control">\n                                                                    <opiton></opiton>\n                                                                </select>\n                                                            <i class="fa fa-trash"></i>\n                                                        </div>\n                                                        <div class="body-addoption">\n                                                            <div class="tile-option-choose hidden-Sortable">\n                                                                <label for="">Giá trị tùy chọn<span class="required">(*)</span></label>\n                                                            </div>\n                                                           <div class="item-grid-sort">\n                                                               <button type="button" class="Sortable-body-addoption" role="button"><svg viewBox="0 0 20 20" class="Polaris-Icon__Svg_375hu" focusable="false" aria-hidden="true"><path d="M7 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm6-8a2 2 0 1 0-.001-4.001 2 2 0 0 0 .001 4.001zm0 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001z"></path></svg></button>\n                                                               <input type="text" class="form-control" name="" data-id="" placeholder="Nhập giá trị" />\n                                                               <i class="fa fa-trash"></i>\n                                                            </div>\n                                                        </div>\n                                                        <button class="btn btn-success" type="button" data-style="expand-left">\n                                                            <span class="ladda-label"><i class="fas fa-check"></i> Xong</span>\n                                                        </button>\n                                                    </div>\n                                              ';$(".card-style-option").append(e),$("."+t+" .header-select").addClass("new-input-data"),loadEventadmin.eventaddstypeoptionproduct($("."+t)),loadEventadmin.eventsortableproduct(),loadEventadmin.event_removerowsortable($(".header-select")),await loadEventadmin.event_loadajaxdataselect2($("."+t+" .header-select select")),$("#items-input-addcontent").find(".input-addcontent").length>1&&($(".btn-addoption").hasClass("disabled")||$(".btn-addoption").addClass("disabled"))}))},enventloadeventTablestyleproduct:async function(t,e,a){loadEventadmin.eventloadremovetablestyleproduct(),$(t).parents(".option-add").after(e),priceFormat(),a&&$("table#tableStylePrice").find("tbody").find("tr").find(".btn-rollback").click((function(t){let e=makeid(5);htmllstbutton='<button type="button" class="btn btn-sm btn-primary mr-2 btn-edit">Sửa</button>\n                                         <button type="button" class="btn btn-sm btn-danger btn-delete '+e+'">Xóa</button>',$(this).parent(".lst-button").html(htmllstbutton),loadEventadmin.eventBtnRollbackItemtableStyleProduct($("."+e))})),$("#add-table-styleproduct input.icheck").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"}),loadEventadmin.eventdeletebtnStyletableproduct($("#add-table-styleproduct")),$("#tableStylePrice").DataTable({scrollY:"300px",scrollX:!0,scrollCollapse:!0,paging:!1,searching:!1,ordering:!1,info:!1,fixedColumns:{left:2}}),loadEventadmin.eventloadIcheck(),loadEventadmin.eventGetDataStyletable()},InitloadStyleproduct:async function(t){var e=await axios.get(t);if(e.data.isValid){let t='<div class="card-style-option" id="items-input-addcontent">';e.data.data.styleProductModels.forEach((async function(e,a){let n="";""!=$("#add-option-body").html().trim()&&(t=""),e.optionsNames.forEach((function(t,e){n+='<div class="item-grid-sort data-success">\n                                    <button type="button" class="Sortable-body-addoption" role="button"><svg viewBox="0 0 20 20" class="Polaris-Icon__Svg_375hu" focusable="false" aria-hidden="true"><path d="M7 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm6-8a2 2 0 1 0-.001-4.001 2 2 0 0 0 .001 4.001zm0 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001z"></path></svg></button>\n                                     <input type="text" class="form-control" name="" placeholder="Nhập giá trị" data-id="'+t.id+'" value="'+t.name+'" />\n                                     <i class="fa fa-trash"></i>\n                                 </div>'})),n+='<div class="item-grid-sort hidden-Sortable">\n                                    <button type="button" class="Sortable-body-addoption" role="button"><svg viewBox="0 0 20 20" class="Polaris-Icon__Svg_375hu" focusable="false" aria-hidden="true"><path d="M7 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm6-8a2 2 0 1 0-.001-4.001 2 2 0 0 0 .001 4.001zm0 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001z"></path></svg></button>\n                                     <input type="text" class="form-control" data-id="" name="" placeholder="Nhập giá trị"  />\n                                     <i class="fa fa-trash"></i>\n                                 </div>';let i=makeid(5);t+='<div class="input-addcontent pr-3 pt-3 pb-3">\n                           <div class="header-select mb-3 item-grid-sort '+i+'">\n                              <label for="">Tên tùy chọn<span class="required">(*)</span></label>\n                              <button type="button" class="Sortable" role="button">\n                                 <svg viewBox="0 0 20 20" class="Polaris-Icon__Svg_375hu" focusable="false" aria-hidden="true">\n                                    <path d="M7 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm6-8a2 2 0 1 0-.001-4.001 2 2 0 0 0 .001 4.001zm0 2a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001zm0 6a2 2 0 1 0 .001 4.001 2 2 0 0 0-.001-4.001z"></path>\n                                 </svg>\n                              </button>\n                              <select class="form-control">\n                                 <opiton></opiton>\n                              </select>\n                              <i class="fa fa-trash"></i>\n                           </div>\n                           <div class="body-addoption">\n                              <div class="tile-option-choose hidden-Sortable">\n                                 <label for="">Giá trị tùy chọn<span class="required">(*)</span></label>\n                              </div>\n                              '+n+'\n                           </div>\n                           <button class="btn btn-success" type="button" data-style="expand-left">\n                           <span class="ladda-label"><i class="fas fa-check"></i> Xong</span>\n                           </button>\n                        </div>',""==$("#add-option-body").html().trim()?(t+="</div>",$("#add-option-body").append(t)):$("#items-input-addcontent").append(t),$("#items-input-addcontent ."+i).addClass("new-input-data"),loadEventadmin.event_removerowsortable($("."+i)),$("#items-input-addcontent").find(".item-grid-sort.data-success").find(".fa-trash").click((function(){$(this).parents(".item-grid-sort.data-success").remove(),loadEventadmin.eventGenerateDataPriceproduct($("#add-option-body"))})),await loadEventadmin.event_loadajaxdataselect2($("."+i+" select"),e.idStyleOptionsProduct)})),loadEventadmin.eventsortableproduct();let a='<div class="card-footer">\n                                   <div class="btn-addoption">\n                                        <i class="fas fa-solid fa-plus mr-2"></i> Thêm tùy chọn khác\n                                  </div>\n                             </div>';if($(".option-add .card").append(a),$("#items-input-addcontent").find(".input-addcontent").length>1&&($(".btn-addoption").hasClass("disabled")||$(".btn-addoption").addClass("disabled")),loadEventadmin.eventaddstypeoptionproduct($("#items-input-addcontent")),loadEventadmin.eventbtnaddstypeoptionproduct(),e.data.data.optionsDetailtProductModels.length>0){let t="";ListArrNameStyleProductinDb=e.data.data.optionsDetailtProductModels,e.data.data.optionsDetailtProductModels.forEach((function(e,a){t+='\n                                <tr class="'+_classloadTrDb+'" IdOptionsName="'+e.idOptionsName+'" data-id="'+e.id+'">\n                                      <td><input type="checkbox" class="icheck item-check" /></td>\n                                      <td>\n                                         <div class="imgstypedetailt"></div>\n                                      </td>\n                                      <td class="name">'+e.name+'</td>\n                                      <td><input type="text"  class="form-control code" value="'+e.sku+'" /></td>\n                                      <td><input type="text" class="form-control price priceFormat" value="'+e.price+'"/></td>\n                                      <td><input type="text" class="form-control quantity priceFormat" value="'+e.quantity+'"/></td>\n                                      <td>\n                                         <div class="lst-button">\n                                            <button type = "button" class="btn btn-sm btn-primary mr-2 btn-edit"> Sửa</button >\n                                            <button type="button" class="btn btn-sm btn-danger btn-delete">Xóa</button>\n                                         </div>\n                                      </td>\n                                </tr>\n                            '}));let a='<div class="pt-3 pb-3 w-100" id="add-table-styleproduct" style="background-color:#f3f3f6;">\n                               <div class="card" style="box-shadow:none">\n                                   <div class="card-header">\n                                      <div>\n                                       <h3 style="font-size: 18px;font-weight:bold" class="mb-0">Mẫu mã</h3>\n                                     </div>\n                                  </div>\n                                <div class="card-body">\n                                <table class="table table-bordered" id="tableStylePrice">\n                                    <thead>\n                                       <tr>\n                                          <th><input type="checkbox" class="icheck" id="check-all" /></th>\n                                          <th>Hình ảnh</th>\n                                          <th>Mẫu mã</th>\n                                          <th>Mã hàng</th>\n                                          <th>Giá</th>\n                                          <th style="width:100px">Số lượng</th>\n                                          <th>Công cụ</th>\n                                       </tr>\n                                    </thead>\n                                    <tbody>\n                                        '+t+"\n                                    </tbody>\n                                 </table>\n                               </div>\n                              </div>\n                           </div>\n                           ";loadEventadmin.enventloadeventTablestyleproduct($("#items-input-addcontent"),a,!1)}}},eventsortableproduct:function(){$("#items-input-addcontent .body-addoption").sortable({handle:"button.Sortable-body-addoption",items:"div:not(.hidden-Sortable)",cancel:"textarea",axis:"y",zIndex:9999,distance:10,scrollSpeed:0,cursor:"move",tolerance:"pointer",connectWith:".m-card-sortable",cancel:".tile-option-choose",start:function(t,e){$(e.item).addClass("active-sortable")},stop:function(t,e){$(e.item).removeClass("active-sortable")},change:function(t,e){},update:function(t,e){loadEventadmin.eventGenerateDataPriceproduct($("#add-option-body"))}}),$("#items-input-addcontent").sortable({handle:"button.Sortable",cancel:"textarea",axis:"y",zIndex:9999,distance:10,scrollSpeed:0,cursor:"move",tolerance:"pointer",connectWith:".m-card-sortable",cancel:".m-add-card, .modal",start:function(t,e){$(e.item).addClass("active-sortable")},stop:function(t,e){$(e.item).removeClass("active-sortable")},change:function(t,e){},update:function(t,e){loadEventadmin.eventGenerateDataPriceproduct($("#add-option-body"))}})}},supplierEInvoice={eventcheckConnect:function(){$(".btn-checkconncetinview").click((function(){let t=$(this).data("id");$.ajax({type:"POST",url:"/Selling/SupplierEInvoice/CheckConnectWebservice?secret="+t,success:function(t){t.isValid},error:function(t){console.log(t)}})}))},removeSupplierEInvoice:function(){$(".btn-removeSupplierEInvoice").click((function(){let t=$(this).data("id");sel=$(this).parents("li.item-infoEinvoice"),Swal.fire({title:"Bạn có chắc chắn muốn gỡ bỏ nhà cung cấp không?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Đồng ý",cancelButtonText:"Hủy bỏ",showLoaderOnConfirm:!0,preConfirm:e=>{$.ajax({type:"POST",url:"/Selling/SupplierEInvoice/Remove?secret="+t,success:function(t){t.isValid&&(html='<img class="disnable" src="../images/VNPT_Logo.png" />\n                                <p class="mt-3">Của hàng của bạn chưa kết nối hóa đơn điện tử VNPT với SposViet</p>\n                                <button class="btn btn-primary btn-addeinvoice" data-id="'+ENumSupplierEInvoice.VNPT+'">Kết nối</button>',sel.html(html),addevincoie=$(".btn-addeinvoice"),supplierEInvoice.eventaddEinvoice())},error:function(t){console.log(t)}})}})}))},loadeventremoveidatata:function(t){$(".lstSuplerinvoice li").each((function(){$(this).find("button").filter((function(t){let e=$(this).data("id");$(this).removeAttr("data-id"),$(this).data("id",e)}))}))},eventaddEinvoice:function(){addevincoie.click((function(){sel=$(this).parents("li.item-infoEinvoice");let t=$(this).data("id");$.ajax({type:"GET",url:"/Selling/SupplierEInvoice/Create?TypeSupplierEInvoice="+t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,title:"Cấu hình kết nối hóa đơn điện tử VNPT",html:t.html,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='fas fa-cancel'></i>Hủy bỏ</button><button class='mr-3 btn btn-save btn-success'><i class='fas fa-check mr-2'></i>Lưu</button><button class='btn btn-checkconncet btn-success'><i class='fas fa-check mr-2'></i>Kiểm tra kết nối</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{validateForm.formEivnoiceVNPT(),loadEventIcheck(),$(".btn-continue").click((function(){Swal.close()})),$(".btn-checkconncet").click((function(){$("form#create-form").valid()&&$.ajax({type:"POST",url:"/Selling/SupplierEInvoice/CheckConnectWebservice",data:$("#create-form").serialize(),success:function(t){t.isValid},error:function(t){console.log(t)}})})),$(".btn-save").click((function(){$("form#create-form").valid()&&$.ajax({type:"POST",url:$("form#create-form")[0].action,data:$("#create-form").serialize(),success:function(t){t.isValid&&(DomainName=$("#DomainName").val(),UserNameAdmin=$("#UserNameAdmin").val(),PassWordAdmin=$("#PassWordAdmin").val(),UserNameService=$("#UserNameService").val(),PassWordService=$("#PassWordService").val(),htmlws=" <span><b>Tài khoản webservice:</b> "+UserNameService+"/******</span>",$("#IsHKD").prop("checked")&&(htmlws=""),html='<div class="row">\n                                                                    <div class="col-md-5">\n                                                                        <img class="" src="../images/VNPT_Logo.png" />\n                                                                        <p class="mt-3 text-success">Của hàng của bạn  kết nối thành công hóa đơn điện tử VNPT với SposViet</p>\n                      \n                                                                    </div>\n                                                                    <div class="col-md-7 infoaccount">\n                                                                        <label><a target="_blank" href="'+DomainName+'">'+DomainName+"</a></label>\n                                                                        <span><b>Tài khoản admin:</b> "+UserNameAdmin+"/******</span>\n                                                                       "+htmlws+'\n                                                                        <a href="/Selling/ManagerPatternEInvoice?secret='+t.secrettype+'" class="btn btn-success btn-sm">Quản lý mẫu số ký hiệu hóa đơn VNPT</a>\n                                                                    </div>\n                                                                    <div class="col-md-12 text-center">\n                                                                          <div class="sltbtn">\n                                                                            <button class="btn btn-danger btn-removeSupplierEInvoice" data-id="'+t.secret+'"><i class="fas fa-trash mr-2"></i>Gỡ bỏ</button>\n                                                                            <button class="btn btn-primary btn-editeinvoice" data-id="'+t.secret+'"><i class="fas fa-edit mr-2"></i>Chỉnh sửa</button>\n                                                                            <button class="btn btn-info btn-checkconncetinview" data-id="'+t.secret+'"><i class="fas fa-wifi mr-2"></i>Kiểm tra kết nối</button>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            ',sel.html(html),editeinvoice=$(".btn-editeinvoice"),supplierEInvoice.showViewConnect(),supplierEInvoice.eventcheckConnect(),supplierEInvoice.removeSupplierEInvoice(),Swal.close())},error:function(t){console.log(t)}})}))}})},error:function(t){console.log(t)}})}))},showViewConnect:function(){supplierEInvoice.loadeventremoveidatata(),editeinvoice.click((function(){sel=$(this).parents("li.item-infoEinvoice");let t=$(this).data("id");$.ajax({type:"GET",url:"/Selling/SupplierEInvoice/Edit?secret="+t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,title:"Cấu hình kết nối hóa đơn điện tử VNPT",html:t.html,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='fas fa-cancel'></i>Hủy bỏ</button><button class='mr-3 btn btn-save btn-success'><i class='fas fa-check mr-2'></i>Lưu</button><button class='btn btn-checkconncet btn-success'><i class='fas fa-check mr-2'></i>Kiểm tra kết nối</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{validateForm.formEivnoiceVNPT(),loadEventIcheck(),$("input#IsHKD").on("ifChanged",(function(t){1==$(this).prop("checked")?($(".accountWebservice").toggleClass("d-none"),$(".txtexempal").toggleClass("d-none"),$(".accountWebservice").find("input.form-control").attr("disabled","disabled"),$(".txtdomain").html("Link domain hệ thống hộ kinh doanh (HKD)"),$("#DomainName").attr("placeholder","https://hkd.vnpt.vn")):0==$(this).prop("checked")&&($(".accountWebservice").toggleClass("d-none"),$(".txtexempal").toggleClass("d-none"),$(".accountWebservice").find("input.form-control").removeAttr("disabled"),$(".txtdomain").html("Link phát hành hóa đơn VNPT"),$("#DomainName").attr("placeholder","https://xxxx-tt78admin.vnpt-invoice.com.vn"))})),$(".btn-continue").click((function(){Swal.close()})),$(".btn-checkconncet").click((function(){$("form#create-form").valid()&&$.ajax({type:"POST",url:"/Selling/SupplierEInvoice/CheckConnectWebservice",data:$("#create-form").serialize(),success:function(t){t.isValid},error:function(t){console.log(t)}})})),$(".btn-save").click((function(){$("form#create-form").valid()&&$.ajax({type:"POST",url:$("form#create-form")[0].action,data:$("#create-form").serialize(),success:function(t){t.isValid&&(DomainName=$("#DomainName").val(),UserNameAdmin=$("#UserNameAdmin").val(),PassWordAdmin=$("#PassWordAdmin").val(),UserNameService=$("#UserNameService").val(),PassWordService=$("#PassWordService").val(),htmlws=" <span><b>Tài khoản webservice:</b> "+UserNameService+"/******</span>",$("#IsHKD").prop("checked")&&(htmlws=""),html='<div class="row">\n                                                                    <div class="col-md-5">\n                                                                        <img class="" src="../images/VNPT_Logo.png" />\n                                                                        <p class="mt-3 text-success">Của hàng của bạn  kết nối thành công hóa đơn điện tử VNPT với SposViet</p>\n                      \n                                                                    </div>\n                                                                    <div class="col-md-7 infoaccount">\n                                                                        <label><a target="_blank" href="'+DomainName+'">'+DomainName+"</a></label>\n                                                                        <span><b>Tài khoản admin:</b> "+UserNameAdmin+"/******</span>\n                                                                       "+htmlws+'\n                                                                        <a href="/Selling/ManagerPatternEInvoice?secret='+t.secrettype+'" class="btn btn-success btn-sm">Quản lý mẫu số ký hiệu hóa đơn VNPT</a>\n                                                                    </div>\n                                                                    <div class="col-md-12 text-center">\n                                                                          <div class="sltbtn">\n                                                                            <button class="btn btn-danger btn-removeSupplierEInvoice" data-id="'+t.secret+'"><i class="fas fa-trash mr-2"></i>Gỡ bỏ</button>\n                                                                            <button class="btn btn-primary btn-editeinvoice" data-id="'+t.secret+'"><i class="fas fa-edit mr-2"></i>Chỉnh sửa</button>\n                                                                            <button class="btn btn-info btn-checkconncetinview" data-id="'+t.secret+'"><i class="fas fa-wifi mr-2"></i>Kiểm tra kết nối</button>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            ',sel.html(html),editeinvoice=$(".btn-editeinvoice"),supplierEInvoice.showViewConnect(),supplierEInvoice.eventcheckConnect(),supplierEInvoice.removeSupplierEInvoice(),Swal.close())},error:function(t){console.log(t)}})})),$("#SelectlistSeri").select2({dropdownParent:$("#create-form"),placeholder:"Chọn loại chữ ký số",allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}})}})},error:function(t){console.log(t)}})}))}},ManagerPatternEInvoice={addOredit:function(t){$.ajax({type:"GET",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&Swal.fire({position:"top-end",showClass:{popup:"\n                              popup-formcreate\n                               animate__animated\n                              animate__fadeInRight\n                              animate__faster\n                            "},hideClass:{popup:"popup-formcreate animate__animated animate__fadeOutRight animate__faster"},showCloseButton:!0,title:t.title,html:t.html,footer:"<button class='btn btn-primary btn-continue mr-3'><i class='fas fa-cancel'></i>Hủy bỏ</button><button class='mr-3 btn btn-save btn-success'><i class='fas fa-check mr-2'></i>Lưu</button>",allowOutsideClick:!0,showConfirmButton:!1,showCancelButton:!1,cancelButtonText:'<i class="fa fa-window-close"></i> Đóng',didRender:()=>{validateForm.addOrEditMangerPatternEInvoice(),$(".btn-continue").click((function(){Swal.close()})),$(".btn-save").click((function(){$("form#create-form").valid()&&jQueryModalPost($("form#create-form")[0])}))}})},error:function(t){console.log(t)}})}},commonfunc={cancelOrder:function(t){var e=$(t).parent("form#form_delete")[0];Swal.fire({title:"Bạn có chắc chắn muốn hủy không?",input:"textarea",inputPlaceholder:"Vui lòng nhập lý do bạn muốn hủy, nội dung này sẽ được gửi đến khách hàng...",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Đồng ý",cancelButtonText:"Hủy bỏ",showLoaderOnConfirm:!0,inputValidator:t=>{if(!t)return"Vui lòng nhập lý do!"},preConfirm:t=>{try{var a=new FormData(e);a.append("content",t),$.ajax({type:"POST",url:e.action,data:a,contentType:!1,processData:!1,success:function(t){t.isValid&&(t.loadTable?dataTableOut.ajax.reload(null,!1):t.loadTreeview?loadData():$("#viewAll").html(t.html))},error:function(t){console.log(t)}})}catch(t){console.log(t)}}})},confirmDelete:function(t){Swal.fire({title:"Bạn có chắc chắn muốn tiếp tục không?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Đồng ý",cancelButtonText:"Hủy bỏ",showLoaderOnConfirm:!0,preConfirm:e=>{try{new FormData;$.ajax({type:"POST",url:t,contentType:!1,processData:!1,success:function(t){t.isValid&&(t.loadTable?dataTableOut.ajax.reload(null,!1):$("#viewAll").html(t.html))},error:function(t){console.log(t)}})}catch(t){console.log(t)}}})}};function makeid(t){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,i=0;i<t;i++)e+=a.charAt(Math.floor(Math.random()*n));return e}function popupCenter(t,e,a,n){var i=screen.width/2-a/2,o=screen.height/2-n/2;window.open(t,e,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+a+", height="+n+", top="+o+", left="+i)}function elFinderBrowser(t,e,a){return tinymce.activeEditor.windowManager.openUrl({title:"Custom Dialog",url:"/tiny-mce/browse",width:920,height:540,oninsert:function(e,a){t(e,a)},onselect:function(e,n){var i,o;i=n.convAbsUrl(e.url),o=e.name+" ("+n.formatSize(e.size)+")","file"==a.filetype&&t(i,{text:o,title:o}),"image"==a.filetype&&t(i,{alt:o}),"media"==a.filetype&&t(i)}},{oninsert:function(e){t(e)}}),!1}function loadeventnotecontetn(){var t=$("#contentnote"),e=$(".iserror");t.keyup((function(){return""==$.trim(t.val())?(e.show(),!1):(e.hide(),!0)}))}function removeVietnameseTones(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a")).replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e")).replace(/ì|í|ị|ỉ|ĩ/g,"i")).replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o")).replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u")).replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y")).replace(/đ/g,"d")).replace(/À|Á|Ạ|Ả|Ã|Â|Ầ|Ấ|Ậ|Ẩ|Ẫ|Ă|Ằ|Ắ|Ặ|Ẳ|Ẵ/g,"A")).replace(/È|É|Ẹ|Ẻ|Ẽ|Ê|Ề|Ế|Ệ|Ể|Ễ/g,"E")).replace(/Ì|Í|Ị|Ỉ|Ĩ/g,"I")).replace(/Ò|Ó|Ọ|Ỏ|Õ|Ô|Ồ|Ố|Ộ|Ổ|Ỗ|Ơ|Ờ|Ớ|Ợ|Ở|Ỡ/g,"O")).replace(/Ù|Ú|Ụ|Ủ|Ũ|Ư|Ừ|Ứ|Ự|Ử|Ữ/g,"U")).replace(/Ỳ|Ý|Ỵ|Ỷ|Ỹ/g,"Y")).replace(/Đ/g,"D")).replace(/\u0300|\u0301|\u0303|\u0309|\u0323/g,"")).replace(/\u02C6|\u0306|\u031B/g,"")).replace(/ + /g," ")).trim()).replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'|\"|\&|\#|\[|\]|~|\$|_|`|-|{|}|\||\\/g," ")}function templateSelect2(t){let e="<span class='select-option-noParent-"+t.Level+"'>"+t.text+"</span>";return t.isParent&&(e="<span class='select-option-isParent'>"+t.text+"</span>"),e}function loaddataSelect2Tempalte(t,e,a,n="",i="",o=!1){IsPos=!1,t.includes("IsPos")&&(IsPos=!0),$.ajax({global:!1,async:!0,type:"GET",dataType:"JSON",url:t,data:{IsPos:IsPos,idselectd:a,iddata:i,iscreateCategory:o},success:function(t){$(e).append("<opiton value=''></opiton>").select2({data:t,placeholder:""!=n?n:"Chọn giá trị",allowClear:!0,language:{noResults:function(){return"Không tìm thấy dữ liệu"}}})}})}function loaddataSelect2CustomsTempalte(t,e,a,n="",i="",o=!1){IsPos=!1,t.includes("IsPos")&&(IsPos=!0),$.ajax({global:!1,async:!0,type:"GET",dataType:"JSON",url:t,data:{IsPos:IsPos,idselectd:a,iddata:i,iscreateCategory:o},success:function(t){$(e).append("<opiton></opiton>").select2({data:t,placeholder:""!=n?n:"Chọn giá trị",allowClear:!0,templateResult:templateSelect2,escapeMarkup:function(t){return t},language:{noResults:function(){return"Không tìm thấy dữ liệu"}}})}})}function checkform(){$("#fomrvalid").validate({rules:{},messages:{Name:{required:"Vui lòng nhập tên",maxlength:"Hãy nhập ít nhất 8 ký tự"},Code:{required:"Vui lòng nhập mã",minlength:"Hãy nhập ít nhất 8 ký tự"}}})}function updateSatusContractFinal(t,e,a){return confirms("Xác nhận","Bạn có chắc chắn muốn cập nhật hay không?","<i class='far fa-times-circle'></i> Hủy","<i class='fas fa-check-circle'></i> Đồng ý",(function(){try{$.ajax({async:!1,type:"POST",url:"/admin/order/UpdateSatusContractFinal",data:{idOrder:t,check:e},success:function(t){t.isValid&&$(a).attr("disabled","disabled")},error:function(t){console.log(t)}})}catch(t){console.log(t)}}),(function(){$(a).prop("checked",!1)})),!1}function readURL(t){if(t.files&&t.files[0]){var e=new FileReader;e.onload=function(e){$(".image-upload-wrap").hide(),$(".file-upload-image").attr("src",e.target.result),$(".file-upload-content").show(),$(".image-title").html(t.files[0].name)},e.readAsDataURL(t.files[0])}else removeUpload()}function printDiv(t){$("#printDocx").remove(),Be=document.createElement("div"),Be.setAttribute("id","printDocx"),Be.style.display="none",document.body.appendChild(Be),$("#printDocx").html(t);var e=document.getElementById("printDocx");$(e).printArea({mode:"iframe",popWd:900,popHt:600,tagPrint:"#printDocx",popClose:!1}),window.onafterprint=function(){console.log("Printing completed...")}}function __highlight(t,e){var a=new RegExp("("+$.ui.autocomplete.escapeRegex(e)+")","ig");return t.replace(a,"<strong>$1</strong>")}function evetnFormatTextnumber3(t=!1){$(".number3").each((function(){if($(this).is("input:text")){if(t)var e=$(this).val().replaceAll(",",".");else e=$(this).val().replaceAll(",","");$(this).val(parseFloat(e).format0VND(0,3,""))}else{if(t)e=$(this).html().replaceAll(",",".");else e=$(this).html().replaceAll(",","");$(this).html(parseFloat(e).format0VND(0,3,""))}}))}function eventUnFormatTextnumber3(){$(".number3").each((function(){if($(this).is("input:text")){let t=$(this).val().replaceAll(",","")||0;$(this).val(parseFloat(t))}}))}function evetnFormatTextnumber3decimal(){$(".number3").each((function(){let t=$(this).text().replaceAll(",",".");$(this).html(parseFloat(t).format0VND(0,3,""))}))}function evetnFormatnumber3(t=!0){$("input.number3").each((function(e,a){if(t){var n=$(this).val().replaceAll(",",".");$(this).val(n)}fnInitialFormatNumber(this)})).ForceNumericOnly().focus((function(){var t=$(this).val();$(this).val(t.replaceAll(",",""))})).focusout((function(){fnFocusOut(this)}))}function loadFormatnumber(t=""){""!=t?$(t).find(".number3").each((function(t,e){fnInitialFormatNumber(this)})).ForceNumericOnly().focus((function(){var t=$(this).val();$(this).val(t.replaceAll(",",""))})).focusout((function(){fnFocusOut(this)})):$(".number3").each((function(t,e){var a=$(this).val().replaceAll(",",".");$(this).val(a),fnInitialFormatNumber(this)})).ForceNumericOnly().focus((function(t,e){var a=$(this).val();$(this).val(a.replaceAll(",",""))})).focusout((function(t,e){fnFocusOut(this)}))}function removeUpload(){$(".file-upload-input").replaceWith($(".file-upload-input").val("").clone(!0)),$(".file-upload-content").hide(),$(".image-upload-wrap").show()}$(document).on("click","#btnsubmitcancelorder",(function(t){var e=$("#contentnote"),a=$(".iserror");if(""==$.trim(e.val()))return a.show(),!1;$(this).parent("form").submit()})),$(document).on("click","#btnupdatepayment",(function(t){return null==$("#updatepayment input[type='radio']:checked").val()?(toastr.error("Bạn chưa chọn loại thanh toán hay đặt cọc"),!1):""==$("#Amount").val()?(toastr.error("Bạn chưa nhập số tiền"),!1):void $(this).parents("form").submit()})),$(document).on("click","#btnsaveStatus",(function(t){var e=$(".litsstep").find(".active").data("id"),a=$(".litsstep").find(".active").data("status"),n=$(".litsstep").find(".active").data("code"),i=$(".bodyContentStatus").find("#step-"+a).find("#note").val();$('input[name="checknew"]').is(":checked"),$.ajax({global:!1,type:"POST",url:"/Admin/Order/UpdateStatus",async:!0,data:{status:a,code:n,note:i,idorder:e},success:function(t){if(t.isValid){4==a&&($(".bodyContentStatus").find("#step-"+a).find("textarea").attr("disabled","disabled").attr("readonly","readonly").removeClass("textcurrent"),$(".btnsaveStatus").remove());var e=$(".bodyContentStatus").find("#step-"+a).find(".listdata");e.find("li.active").removeClass("active"),e.find("li.nodata").remove();let o='<li  data-id="'+t.idnote+'" class="active">\n                                            <img src="../images/logo.png"/>\n                                            <div class="content">\n                                                 <span class="create-user"> '+t.fullname+"</span>    <span>- "+t.note+"</span><br />\n                                                <small>("+t.date+")</small>\n                                                </div>\n                                        </li>";e.prepend(o),$(".bodyContentStatus").find("#step-"+a).find("#note").attr("data-id",t.idnote);var n=$(".bodyContentStatus").find("#step-"+a).find("#note").clone();$(".bodyContentStatus").find("#step-"+a).find(".bodytextarea").html(n),$(".litsstep").find(".active").addClass("datastatus");var i=$(".bodyContentStatus").find(".textcurrent");if($(".bodyContentStatus").find("#step-"+a).find(".checkAddnew").removeClass("d-none"),i.data("status")!=a){$(".litsstep").find(".currentOrder").removeClass("currentOrder"),$(".litsstep").find(".status-"+a).children("a.nav-link").addClass("currentOrder");let t=i.data("status");i.attr("disabled","disabled").attr("readonly","readonly").removeClass("textcurrent"),$(".bodyContentStatus").find("#step-"+a).find("textarea").addClass("textcurrent"),$(".bodyContentStatus").find("#step-"+t).find(".checkAddnew").remove(),$(".bodyContentStatus").removeAttr("style"),$(".bodyContentStatus").animate({height:$(".bodyContentStatus").height()},400)}}}})})),$(search).click((function(){loadLadda(),dataTableOut.draw(),Ladda.stopAll()})),$(".image-upload-wrap").bind("dragover",(function(){$(".image-upload-wrap").addClass("image-dropping")})),$(".image-upload-wrap").bind("dragleave",(function(){$(".image-upload-wrap").removeClass("image-dropping")})),loadFormatnumber(),loaddaterangepicker(),CheckExpired(),$.validator.addMethod("minStrict",(function(t,e,a){return(t=parseInt(t.replaceAll(",","")))>a}));const startbtn=document.getElementById("startbtnaudio"),audio=document.getElementById("audio");function playaudioNotifyChitchen(){startbtn.click()}function checkautido(){Swal.fire({title:"Nhấn Ok để kiểm tra chuông báo!",showDenyButton:!1,showCancelButton:!1,confirmButtonText:"OK"}).then((t=>{t.isConfirmed&&(Swal.close(),startbtn.click())}))}function testConnetWebSocket(){sposvietplugin.sendConnectSocket(listport[0]).then((function(t){console.log(t)}))}async function CheckExpired(){try{let e=localStorage.getItem("CheckExpired");if(void 0!==e&&null!=e){e=JSON.parse(e);var t=moment(e.date,"DD/MM/YYYY HH:mm");if(t.format("DD-MM-YYYY")==moment().format("DD-MM-YYYY"))if(e.IsExpired){if(0==e.numdate){await axios.get("/Identity/Account/logout")&&(window.location.href="/Selling/Error/ExpiredStort")}else if(e.numdate>0){let t="<div class='ExpiredStort'><b class='red'>Hệ thống sắp hết hạn sử dụng, thời hạn còn "+e.numdate+" ngày, đến ngày: "+e.datesExpired+" </b> <i class='fas fa-sync-alt checkagin'></i> </div>";$(".ExpiredStort").length>0&&$(".ExpiredStort").remove(),$(".app-footer-right").length>0&&$(".app-footer-right .nav").before(t),$(".checkagin").click((function(){localStorage.removeItem("CheckExpired"),getCheckExpired()}))}}else{$(".ExpiredStort").length>0&&$(".ExpiredStort").remove();let e=parseInt(t.format("HH"));parseInt(moment().format("HH"))-e>=1&&getCheckExpired()}else getCheckExpired()}else getCheckExpired()}catch(t){console.log(t)}}async function getCheckExpired(){let t=await axios.get("/API/Handling/CheckExpired");if(null!=t.data)if("undefined"!=typeof Storage){let e={};e.date=t.data.todate,e.numdate=t.data.numdate,e.datesExpired=t.data.datesExpired,e.IsExpired=t.data.isExpired,localStorage.setItem("CheckExpired",JSON.stringify(e)),CheckExpired()}else alert("Liên hệ đội ngủ hỗ  trợ lỗi trình duyệt của bạn không hỗ  trợ Storage")}function parseDecimal(t,e=9){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function GUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}startbtn.addEventListener("click",(()=>{audio.play().then((()=>{}))}));