var timer,timeOut=2e3,webSocket=null,IdPort=0;function getbrowse(){var e,n=navigator.userAgent,t=n.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(t[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(n)||[])[1]||""):"Chrome"===t[1]&&null!=(e=n.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=n.match(/version\/(\d+)/i))&&t.splice(1,1,e[1]),{name:t[0],version:t[1]})}function getosname(){var e="Unknown";return console.log(window.navigator.userAgent),-1!=window.navigator.userAgent.indexOf("Windows NT 10.0")&&(e="Windows 10"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.2")&&(e="Windows 8"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.1")&&(e="Windows 7"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.0")&&(e="Windows Vista"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.1")&&(e="Windows XP"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.0")&&(e="Windows 2000"),-1!=window.navigator.userAgent.indexOf("Mac")&&(e="MAC"),-1!=window.navigator.userAgent.indexOf("X11")&&(e="UNIX"),-1!=window.navigator.userAgent.indexOf("Linux")&&(e="Linux"),e}function getOS(){var e=window.navigator.userAgent,n=window.navigator.platform,t=null;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(n)?t="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(n)?t="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(n)?t="Windows":/Android/.test(e)?t="Android":!t&&/Linux/.test(n)&&(t="Linux"),t}var sposvietplugin={sendConnectSocket:function(e){data={},data.type=TypeEventWebSocket.SendTestConnect,data.hash="";var n=JSON.stringify(data);return sposvietplugin.connectSignatureWebSocket(e,n)},againConnect:function(e,n,t){IdPort<5?sposvietplugin.connectSignatureWebSocket(e,n).then((function(e){t(e)})):clearTimeout(timer)},connectSignatureWebSocket:function(e,n){return new Promise(((t,i)=>{null==webSocket?(webSocket=new WebSocket("ws://127.0.0.1:"+e+"/SposVietPlugin"),timer=setTimeout((function(){IdPort++,sposvietplugin.againConnect(e,n,t)}),timeOut)):webSocket.send(n),webSocket.onopen=function(){StatusSposVietPlugin=1,clearTimeout(timer),webSocket.send(n)},webSocket.onclose=function(){StatusSposVietPlugin=0,webSocket=null},webSocket.onmessage=function(e){var n=JSON.parse(e.data);n.isSuccess?(console.log(n.Message),parseInt(n.type)==TypeEventWebSocket.SignEInvoice?(""==n.Data&&(toastrcus.error("Không ký số được dữ liệu hash"),t("-1")),t(n.Data)):parseInt(n.type)==TypeEventWebSocket.PrintInvoice?t("In hóa đơn bán hàng (bill)"):parseInt(n.type)==TypeEventWebSocket.PrintBep?t("In bêp OK"):parseInt(n.type)==TypeEventWebSocket.SendTestConnect&&t("test")):"-1"==n.Message&&parseInt(n.type)==TypeEventWebSocket.SignEInvoice?(toastrcus.warning("Người dùng hủy bỏ"),t("-1")):(toastrcus.error(n.Message),t("-1"))},webSocket.onerror=function(){StatusSposVietPlugin=0,loadingStop(),t("-1"),webSocket.close()}}))}};